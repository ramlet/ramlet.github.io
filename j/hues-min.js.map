{"version":3,"sources":["HuesCanvas.js","HuesCore.js","HuesEditor.js","HuesInfo.js","HuesSettings.js","HuesUI.js","HuesWindow.js","ResourceManager.js","ResourcePack.js","SoundManager.js","string_score.min.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","window","document","HuesCanvas","root","soundManager","core","this","audio","addEventListener","resetEffects","bind","setImage","setColour","beat","setInvert","settingsUpdated","animationLoop","needsRedraw","colour","image","smartAlign","animTimeout","animFrame","lastBeat","blurDecay","blurAmount","blurIterations","blurDelta","blurAlpha","blurStart","blurDistance","xBlur","yBlur","sliceDistance","sliceStart","slices","x","makeSliceObj","y","trippyStart","trippyRadii","trippyOn","trippyRadius","blackout","blackoutColour","blackoutTimeout","lastBlackout","currentBlackout","lastFrameBlack","invert","colourFade","colourFadeStart","colourFadeLength","oldColour","newColour","blendMode","setBlurAmount","setBlurQuality","setBlurDecay","canvas","createElement","context","getContext","width","height","className","appendChild","offCanvas","offContext","resize","value","avgSegments","count","segments","distances","setSmartAlign","settings","blurQuality","trippyMode","clientHeight","ratio","clientWidth","Math","min","ceil","max","offset","bOpacity","cTime","currentTime","globalAlpha","globalCompositeOperation","blackoutStart","fillStyle","fillRect","drawInvert","bitmap","bitmaps","animated","drawHeight","drawWidth","align","drawSlice","drawBlur","drawImage","drawTrippy","intToHex","clearRect","bitmapXOffset","drawXOffset","xSegment","sliceXDistance","segmentBitmapWidth","segmentDrawWidth","bitmapYOffset","drawYOffset","j","ySegment","sliceYDistance","segmentBitmapHeight","segmentDrawHeight","floor","baseInvert","invertC","normalC","sort","a","b","beginPath","arc","PI","fill","closePath","num","toString","slice","delta","fadeVal","stopFade","mixColours","clearBlackout","beatsPerAnim","currentSong","charsPerBeat","syncAnim","frameDurations","exp","dist","blurUpdated","transitionPercent","now","sliceRampUp","sliceTransitionTime","sliceRampDown","longTransition","endEffect","redraw","animBeat","song","index","beatIndex","getBeatLength","interp","beatLoc","aLen","syncOffset","isFade","c","whiteout","blackoutUI","userInterface","hide","show","beatTime","doInstantBlackout","doBlackout","pow","percent","oldR","oldG","oldB","newR","newG","newB","mixR","mixG","mixB","saveTrippy","doXBlur","doYBlur","beatLength","beatCount","sliceX","sliceY","transitionTime","generateSliceSegments","resetSliceSegments","direction","even","spread","total","rando","random","decay","slow","medium","fast","faster!","quality","low","high","extreme","amount","HuesCore","defaults","_this","eventListeners","loaded","time","blurupdate","newsong","newimage","newcolour","newmode","frame","songstarted","settingsupdated","version","versionStr","toFixed","versionHex","buildLength","loopLength","currentImage","songIndex","imageIndex","lastSongArray","lastImageArray","colourIndex","colours","oldColours","loopCount","doBuildup","uiArray","HuesSettings","zip","workerScriptsPath","workersPath","getElementById","body","classList","add","documentElement","innerHTML","makePreloader","onerror","msg","url","line","col","error","HuesWindow","console","log","resourceManager","Resources","editor","HuesEditor","initUI","populateHuesInfo","selectTab","firstWindow","ui","push","RetroUI","WeedUI","ModernUI","XmasUI","HalloweenUI","MinimalUI","autoSong","visualiser","vCtx","SoundManager","init","then","locked","skipPreloader","getSizes","respacks","sizes","size","reduce","prev","curr","warning","unlock","clearMessage","setInterval","loopCheck","renderer","load","addAll","progress","preloader","style","backgroundPosition","scale","preloadMax","padding","preloadBase","preloadMsg","textContent","preloadPrefix","Array","join","display","callEventListeners","firstImage","setImageByName","autoplay","firstSong","setSongByName","setSong","disableKeyboard","e","event","defaultPrevented","altKey","ctrlKey","metaKey","shiftKey","tagName","toLowerCase","type","contentEditable","keyCode","which","keyHandler","ev","args","call","arguments","forEach","callback","apply","Error","filter","preloadTitle","preloadSubMsg","initVisualiser","logArrays","getVisualiserData","gradient","createLinearGradient","addColorStop","barWidth","barHeight","vals","requestAnimationFrame","playing","updateVisualiser","clampedTime","buildupPlayed","getBeat","beater","forcedNow","build","buildupRhythm","rhythm","mapSoFar","match","invertCount","getBeatIndex","enabledSongs","name","songs","bestSong","bestScore","score","title","leaveArray","_this2","undefined","source","crc","sound","enabled","filename","buildup","playBuildups","playSong","resetAudio","fillBuildup","updateBeatLength","independentBuild","buildBeats","recalcBeatIndex","songCount","indexOf","randomSong","noRepeat","shift","onLoop","autoSongDelay","doAutoSong","_this3","func","autoSongShuffle","nextSong","autoSongFadeout","fadeOut","songDataUpdated","shuffleImages","len","enabledImages","randomImage","cull","img","fullname","images","setIsFullAuto","randomColourIndex","getBeatString","doTrippyX","doTrippyY","doShortBlackout","randomColour","fullAuto","doColourFade","timeToNextBeat","doSlice","charsToNextBeat","toggleInvert","maxSearch","nextBeat","playbackRate","beatString","auto","hideLists","disconnect","connectCore","currentUI","changeUI","colourSet","pastelColours","weedColours","remove","vReady","rebuildEnabled","toggleSongList","toggleImageList","open","previousImage","nextImage","previousSong","toggleFullAuto","decreaseVolume","increaseVolume","seek","toggleMute","toggleHide","set","toggle","message","color","n","WAVE_PIXELS_PER_SECOND","WAVE_HEIGHT_PIXELS","huesWin","buildEditSize","buildEdit","loopEdit","editArea","wrapAt","hilightWidth","hilightHeight","undoBuffer","redoBuffer","batchUndoArray","buildWave","loopWave","buildWaveBuff","loopWaveBuff","waveContext","waveCanvas","respack","linked","enableWindow","onBeat","onNewSong","addTab","titleButtons","saveBtn","createButton","saveXML","copyBtn","copyXML","undoBtn","undo","redoBtn","redo","help","backgroundColor","statusMsg","topBar","uiCreateInfo","uiCreateImport","uiCreateEditArea","uiCreateControls","uiCreateVisualiser","preventDefault","noHilightCalc","innerHeight","boxHeight","offsetHeight","bHeadHeight","_header","lHeadHeight","handleHeight","resizeHandle","minHeight","maxHeight","buildHeight","_box","loopHeight","timeLock","hilight","grid","removeChild","updateInfo","updateWaveform","_hilight","map","offsetX","offsetY","left","top","_beatmap","_beatCount","regex","RegExp","replace","seekStart","seekLoop","_removeBtn","_locker","loopLen","buildLen","beatLen","_fileInput","files","newSong","newlyLinked","_sound","getOther","file","blobToArrayBuffer","buffer","testSong","test","loadBuffer","noExt","buildupName","getText","setText","setIndependentBuild","alert","_rhythm","reflow","stop","updateHalveDoubleButtons","blob","Promise","resolve","reject","fr","FileReader","onload","result","readAsArrayBuffer","Respack","author","description","addPack","rebuildArrays","setSongOject","newSongBtn","fromSongBtn","disabled","clearUndoRedo","updateIndependentBuild","setLocked","hasBuild","hasLoop","indep","lock","_locked","trimUndo","updateUndoUI","oldText","newText","undoObj","songVar","text","undoRedo","from","to","fromArray","pop","toArray","fromData","commit","batchUndo","other","halveBeats","commitUndo","doubleBeats","_halveBtn","_doubleBtn","txtLen","label","subtitle","parent","div","caption","container","input","extraClass","button","contains","stopPropagation","stopImmediatePropagation","toUpperCase","info","songUpdate","createTextInput","oninput","_this4","imports","songEdits","fromSong","songInfos","uiCreateSongStat","valueSpan","_this5","locker","uiCreateSingleEditor","_seek","handleContainer","handle","editTop","getBoundingClientRect","handleSize","resizer","clientY","mouseup","removeEventListener","soundName","rhythmName","_this6","header","nameLabel","_lockedBtn","textLen","rightHeader","fileInput","accept","multiple","onchange","loadAudio","click","removeAudio","editBox","beatmap","spellcheck","textUpdated","oncontextmenu","rightClick","beatHilight","_this7","controls","changeRate","change","rate","setRate","newRate","playRateLab","speedControl","speedDown","speedUp","wrapControl","wrapLab","parseInt","wave","drawWave","coords","getTextCoords","caret","totalLen","setCaret","seekTime","bLen","el","isNaN","offsetLeft","offsetTop","scrollLeft","scrollTop","offsetParent","clientX","caretFromEnd","getCaret","newLen","round","otherMap","wasLocked","pushUndo","onbeforeunload","confirmLeave","editable","sel","getSelection","rangeCount","range","getRangeAt","childNodes","commonAncestorContainer","endOffset","createRange","setStart","collapse","removeAllRanges","addRange","otherLock","renderWave","loop","samplesPerPixel","sampleRate","waveData","numberOfChannels","getChannelData","channels","pixel","halfHeight","avgHi","avgLo","chan","sample","maxPix","minPix","strokeStyle","moveTo","lineTo","stroke","maxAvg","minAvg","timespan","minTime","maxTime","drawTime","drawOffset","waveOffset","drawOneWave","err","loopPoints","drawWaveBar","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","point","lineWidth","offsetWidth","xml","generateXML","element","setAttribute","encodeURIComponent","textArea","select","success","execCommand","huesName","about","addReference","beatGlossary","shortcuts","titleText","list","ref","listElem","elem","item","defaultSettings","parseQueryString","respackPath","overwriteLocal","packsURL","disableRemoteResources","showWindow","volume","settingsCategories","Functionality","Graphics","Visuals","Interface","settingsOptions","options","variable","inputType","visiblity","ret","updated","settingsVersion","localStorage","clear","hasUI","settingCheckboxes","textCallbacks","visCallbacks","ephemerals","attr","hasOwnProperty","makeSetter","get","makeGetter","querySettings","getQuerySettings","concat","results","query","location","search","substring","vars","split","pair","packs","val","intValidator","self","updateConditionals","cat","catContainer","cats","_loop","setName","setContainer","setting","buttonContainer","option","checkbox","unique","id","checked","onclick","htmlFor","autofocus","visibility","isEphemeral","opt","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","_get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","getPrototypeOf","getter","HuesUI","imageName","imageLink","songName","songLink","hueName","imagePrev","imageNext","songPrev","songNext","timer","settingsToggle","hideToggle","callbacks","listContainer","visualiserContainer","hidden","songList","imageList","addCoreCallback","newImage","updateTime","resizeHandler","listView","firstElementChild","vol","href","pad","str","abs","prefix","_HuesUI","mode","beatBar","imageMode","imageModeManual","imageModeAuto","subControl","subControls","hideRestore","newMode","isAuto","beats","rest","resizeVisualiser","_RetroUI","_RetroUI2","xVariance","yVariance","beatLeft","beatRight","beatCenter","rot","round10","transform","MozTransform","webkitTransform","setTimeout","removeBeat","_HuesUI2","textSize_normal","textSize_small","songLink_size","imageLink_size","currentBeat","_this8","leftBox","volCluster","volBar","volLabel","infoToggle","step","volInput","setVolume","parseFloat","rightBox","songBlock","songControls","songShuffle","imageBlock","imageControls","leftInfo","rightInfo","span","ownerDocument","oldContent","textWidth","resizeSong","resizeImage","parentSize","chars","resizeElement","_ModernUI","_this9","initSnow","lights","wires","xleft","l","light","newLight","angle","right","xright","bottomHelper","bottom","xbottom","snowContext","startSnow","stopSnow","on","off","hue","lightOn","lightOff","bulb","randomLight","lightRecolour","lightFadeOut","snowCanvas","snowing","maxSnow","snowAngle","lastSnow","snowflakes","drawSnow","r","d","Date","flake","cos","sin","innerWidth","savedFill","_ModernUI2","_this10","leftBoxTomb","songTomb","insertBefore","firstChild","imageTomb","topLeft","topRight","bottomRight","leftHand","rightHand","vignette","eyes","windowshown","tabselected","actualWindow","closeButton","tabContainer","contentContainer","contents","tabs","tabNames","tabName","tabContent","content","dontShowWin","TAB_SONGS","TAB_IMAGES","getAndIncrementUnique","resourcePacks","allSongs","allImages","progressState","progressCallback","enabledSongList","enabledImageList","packView","pack","creator","imageCount","packButtons","totalSongs","totalImages","packsView","respackList","remoteList","loadRemote","progressBar","progressStatus","progressCurrent","progressTop","progressPercent","currentTab","remotes","fileParseQueue","urls","promises","p","xhr","XMLHttpRequest","onreadystatechange","readyState","DONE","bytes","getResponseHeader","req","status","send","code","all","Number","valueOf","respackPromises","progressFunc","updateProgress","loadFromURL","sequence","packPromise","addResourcesToArrays","updateTotals","appendListItem","selectPack","allAnimations","appendSimpleListItem","splice","names","loadFromBlob","localProgress","localComplete","filesLoaded","filesToLoad","progStat","packsContainer","packHeader","packList","remoteHeader","loadRemotes","buttons","loadCurrentRemote","loadLocal","progressContainer","progressFilled","progressTexts","indivView","packName","packInfo","packCreator","packCreatorText","packSize","packDesc","enableAll","disableAll","totalCounts","totalSongsCont","totalSongsLabel","totalImagesCont","totalImagesLabel","me","toggleVisible","link","truncateNum","selectResourceCallback","clickResourceCallback","res","isSong","arr","elName","tab","getEnabledTabContents","oncheck","checkStyler","responseType","response","populateRemotes","selectRemotePack","songcount","imagecount","moreSongs","moreImages","remoteProgress","remoteComplete","downloaded","debug","debugConsole","audioExtensions","imageExtensions","songQueue","imageQueue","_xmlQueue","totalFiles","loadedFromURL","override","getBlob","onprogress","lengthComputable","fs","FS","importBlob","parseZip","entries","directory","parseFile","parseSongQueue","parseImageQueue","parseXML","parseSong","parseImage","endsWith","loadXML","containsSong","extension","mime","oldSong","getSong","songPromise","getImage","containsImage","existing","loadImage","imgFile","imageObj","getData64URI","imagePromise","newImg","Image","src","parser","DOMParser","dom","parseFromString","nodeName","parseSongFile","parseImageFile","parseInfoFile","newSongs","nextElementSibling","attributes","getTag","forceTrim","newImages","frameDur","strSplit","localeCompare","Element","tag","def","t","getElementsByTagName","initPromise","lockedPromise","oggSupport","buildSource","loopSource","startTime","gainNode","mute","lastVol","vBars","vTotalBars","splitter","analysers","analyserArrays","binCutoffs","linBins","logBins","maxBinLin","AudioContext","webkitAudioContext","suspend","resume","createGain","connect","destination","decodeAudioData","miniOgg","audioWorker","createWorker","pingListener","terminate","postMessage","ping","ogg","state","unlocker","createBuffer","createBufferSource","start","playBuild","forcePlay","gain","cancelScheduledValues","setMute","loadSong","buffers","duration","dontDeleteBuffers","noPlayingUpdate","loopStart","loopEnd","_loadPromise","view","Uint8Array","backup","decoded","data","arrayBuffer","audioBufFromRaw","rawAudio","raw","array","samples","audioBuf","channel","Float32Array","copyToChannel","Worker","bars","attachVisualiser","channelCount","createChannelSplitter","analyser","createAnalyser","fftSize","smoothingTimeConstant","minDecibels","maxDecibels","frequencyBinCount","getByteTimeDomainData","binCount","binWidth","logLow","log2","logDiff","cutoff","freqCutoff","binCutoff","getByteFrequencyData","scaled","sumArray","updateVolume","setValueAtTime","exponentialRampToValueAtTime","miniOggRaw","miniOggBin","atob","ArrayBuffer","charCodeAt","String","f","g","h","k","m"],"mappings":"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","file":"hues-min.js","sourcesContent":["/* Copyright (c) 2015 William Toohey <will@mon.im>\r\n * Portions Copyright (c) 2015 Calvin Walton <calvin.walton@kepstin.ca>\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n(function(window, document) {\r\n\"use strict\";\r\n\r\n/*  Takes root element to attach to, and an audio context element for\r\n    getting the current time with reasonable accuracy */\r\nclass HuesCanvas {\r\n    constructor(root, soundManager, core) {\r\n        this.audio = soundManager;\r\n        soundManager.addEventListener(\"seek\", this.resetEffects.bind(this));\r\n        core.addEventListener(\"newsong\", this.resetEffects.bind(this));\r\n        core.addEventListener(\"newimage\", this.setImage.bind(this));\r\n        core.addEventListener(\"newcolour\", this.setColour.bind(this));\r\n        core.addEventListener(\"beat\", this.beat.bind(this));\r\n        core.addEventListener(\"invert\", this.setInvert.bind(this));\r\n        core.addEventListener(\"settingsupdated\", this.settingsUpdated.bind(this));\r\n        core.addEventListener(\"frame\", this.animationLoop.bind(this));\r\n        this.core = core;\r\n\r\n        this.needsRedraw = false;\r\n        this.colour = 0xFFFFFF;\r\n        this.image = null;\r\n        this.smartAlign = true; // avoid string comparisons every frame\r\n\r\n        this.animTimeout = null;\r\n        this.animFrame = null;\r\n        this.lastBeat = 0;\r\n\r\n        // set later\r\n        this.blurDecay = null;\r\n        this.blurAmount = null;\r\n        this.blurIterations = null;\r\n        this.blurDelta = null;\r\n        this.blurAlpha = null;\r\n        // dynamic\r\n        this.blurStart = 0;\r\n        this.blurDistance = 0;\r\n        this.xBlur = false;\r\n        this.yBlur = false;\r\n\r\n        this.sliceDistance = 0;\r\n        this.sliceStart = 0;\r\n        this.slices = {\r\n            x : this.makeSliceObj(25),\r\n            y : this.makeSliceObj(15)\r\n        };\r\n\r\n        // trippy mode\r\n        this.trippyStart = [0, 0]; // x, y\r\n        this.trippyRadii = [0, 0]; // x, y\r\n        // force trippy mode\r\n        this.trippyOn = false;\r\n        this.trippyRadius = 0;\r\n\r\n        this.blackout = false;\r\n        this.blackoutColour = \"#000\"; // for the whiteout case we must store this\r\n        this.blackoutTimeout = null;\r\n        // frame drop mitigation on many fast consecutive short blackouts\r\n        this.lastBlackout = 0;\r\n        this.currentBlackout = -1;\r\n        this.lastFrameBlack = false;\r\n\r\n        this.invert = false;\r\n\r\n        this.colourFade = false;\r\n        this.colourFadeStart=0;\r\n        this.colourFadeLength=0;\r\n        this.oldColour=0xFFFFFF;\r\n        this.newColour=0xFFFFFF;\r\n\r\n        this.blendMode = \"hard-light\";\r\n        // Chosen because they look decent\r\n        this.setBlurAmount(\"medium\");\r\n        this.setBlurQuality(\"high\");\r\n        this.setBlurDecay(\"fast\");\r\n\r\n        this.canvas = document.createElement('canvas');\r\n        this.context = this.canvas.getContext(\"2d\");\r\n        this.canvas.width = 1280;\r\n        this.canvas.height = 720;\r\n        this.canvas.className = \"hues-canvas\";\r\n        root.appendChild(this.canvas);\r\n\r\n        this.offCanvas = document.createElement('canvas');\r\n        this.offContext = this.offCanvas.getContext('2d');\r\n\r\n        window.addEventListener('resize', this.resize.bind(this));\r\n        this.resize();\r\n    }\r\n\r\n    makeSliceObj(avgSegments) {\r\n        return {\r\n            count       : 0,\r\n            avgSegments : avgSegments,\r\n            segments    : [],\r\n            distances   : []\r\n        };\r\n    }\r\n\r\n    setInvert(invert) {\r\n        this.invert = invert;\r\n        this.needsRedraw = true;\r\n    }\r\n\r\n    settingsUpdated() {\r\n        this.setSmartAlign(this.core.settings.smartAlign);\r\n        this.setBlurAmount(this.core.settings.blurAmount);\r\n        this.setBlurDecay(this.core.settings.blurDecay);\r\n        this.setBlurQuality(this.core.settings.blurQuality);\r\n        this.trippyOn = this.core.settings.trippyMode == \"on\";\r\n    }\r\n\r\n    resetEffects() {\r\n        this.colourFadeStart = 0;\r\n        this.colourFade = false;\r\n        this.trippyStart = [0, 0];\r\n        this.sliceStart = 0;\r\n        this.blurStart = 0;\r\n        this.blurDistance = 0;\r\n        this.xBlur = false;\r\n        this.yBlur = false;\r\n    }\r\n\r\n    resize() {\r\n        // height is max 720px, we expand width to suit\r\n        let height = this.core.root.clientHeight;\r\n        let ratio = this.core.root.clientWidth / height;\r\n        this.canvas.height = Math.min(height, 720);\r\n        this.canvas.width = Math.ceil(this.canvas.height * ratio);\r\n        this.offCanvas.height = this.canvas.height;\r\n        this.offCanvas.width = this.canvas.width;\r\n        this.trippyRadius = Math.max(this.canvas.width, this.canvas.height) / 2;\r\n        this.needsRedraw = true;\r\n    }\r\n\r\n    redraw() {\r\n        let offset; // for centering/right/left align\r\n        let bOpacity;\r\n        let width = this.canvas.width;\r\n        let height = this.canvas.height;\r\n\r\n        let cTime = this.audio.currentTime;\r\n        // white BG for the hard light filter\r\n        this.context.globalAlpha = 1;\r\n        this.context.globalCompositeOperation = \"source-over\";\r\n        if(this.blackout) {\r\n            // original is 3 frames at 30fps, this is close\r\n            bOpacity = (cTime - this.blackoutStart)*10;\r\n            if(bOpacity > 1) { // optimise the draw\r\n                // If a short blackout is scheduled, but we missed the image frame\r\n                // from the last one, you can get only black frames over and over\r\n                // this will forcibly swap to the image to increase perceived speed\r\n                if(this.lastBlackout != this.currentBlackout && this.lastFrameBlack) {\r\n                    this.lastFrameBlack = false;\r\n                    this.context.fillStyle = \"#FFF\";\r\n                    this.context.fillRect(0,0,width,height);\r\n                } else {\r\n                    this.lastFrameBlack = true;\r\n                    this.lastBlackout = this.currentBlackout;\r\n                    this.context.fillStyle = this.blackoutColour;\r\n                    this.context.fillRect(0,0,width,height);\r\n                    this.needsRedraw = false;\r\n                    this.drawInvert();\r\n                    return;\r\n                }\r\n            }\r\n        } else {\r\n            this.lastFrameBlack = false;\r\n            this.context.fillStyle = \"#FFF\";\r\n            this.context.fillRect(0,0,width,height);\r\n        }\r\n\r\n        if(this.image && (this.image.bitmap || this.image.bitmaps)) {\r\n            let bitmap = this.image.animated ?\r\n                this.image.bitmaps[this.animFrame] : this.image.bitmap;\r\n            let drawHeight = bitmap.height * (height / bitmap.height);\r\n            let drawWidth = (bitmap.width / bitmap.height) * drawHeight;\r\n            if(this.smartAlign) {\r\n                switch(this.image.align) {\r\n                    case \"left\":\r\n                        offset = 0;\r\n                        break;\r\n                    case \"right\":\r\n                        offset = width - drawWidth;\r\n                        break;\r\n                    default:\r\n                        offset = width/2 - drawWidth/2;\r\n                        break;\r\n                }\r\n            } else {\r\n                offset = width/2 - drawWidth/2;\r\n            }\r\n\r\n            if(this.sliceStart) {\r\n                bitmap = this.drawSlice(bitmap, drawWidth, drawHeight, width, height);\r\n                drawWidth = width;\r\n                drawHeight = height;\r\n            }\r\n\r\n            if(this.xBlur || this.yBlur) {\r\n                this.drawBlur(bitmap, offset, drawWidth, drawHeight);\r\n            }else {\r\n                this.context.globalAlpha = 1;\r\n                this.context.drawImage(bitmap, offset, 0, drawWidth, drawHeight);\r\n            }\r\n        }\r\n\r\n        if(this.trippyStart[0] || this.trippyStart[1]) {\r\n            this.drawTrippy(width, height);\r\n        } else {\r\n            this.offContext.fillStyle = this.intToHex(this.colour);\r\n            this.offContext.fillRect(0,0,width,height);\r\n        }\r\n        this.context.globalAlpha = 0.7;\r\n        this.context.globalCompositeOperation = this.blendMode;\r\n        this.context.drawImage(this.offCanvas, 0, 0);\r\n        if(this.blackout) {\r\n            this.context.globalAlpha = bOpacity;\r\n            this.context.fillStyle = this.blackoutColour;\r\n            this.context.fillRect(0,0,width,height);\r\n            this.needsRedraw = true;\r\n        } else {\r\n            this.needsRedraw = false;\r\n        }\r\n        this.drawInvert();\r\n    }\r\n\r\n    drawInvert() {\r\n        if(this.invert) {\r\n            this.context.globalAlpha = 1;\r\n            this.context.globalCompositeOperation = \"difference\";\r\n            this.context.fillStyle = \"#FFF\";\r\n            this.context.fillRect(0,0,this.canvas.width,this.canvas.height);\r\n        }\r\n    }\r\n\r\n    drawSlice(bitmap, drawWidth, drawHeight, width, height) {\r\n        this.offContext.clearRect(0,0,width,height);\r\n\r\n        let bitmapXOffset = 0;\r\n        let drawXOffset = 0;\r\n        for (let i = 0; i < this.slices.x.count; i++) {\r\n            let xSegment = this.slices.x.segments[i];\r\n            let sliceXDistance = this.slices.x.distances[i] * this.sliceDistance;\r\n            let segmentBitmapWidth = Math.ceil(xSegment * bitmap.width);\r\n            let segmentDrawWidth = Math.ceil(xSegment * drawWidth);\r\n\r\n            let bitmapYOffset = 0;\r\n            let drawYOffset = 0;\r\n            for (let j = 0; j < this.slices.y.count; j++) {\r\n                let ySegment = this.slices.y.segments[j];\r\n                let sliceYDistance = this.slices.y.distances[j] * this.sliceDistance;\r\n                let segmentBitmapHeight = Math.ceil(ySegment * bitmap.height);\r\n                let segmentDrawHeight = Math.ceil(ySegment * drawHeight);\r\n\r\n                this.offContext.drawImage(bitmap,\r\n                    bitmapXOffset, bitmapYOffset,            // subsection x, y\r\n                    segmentBitmapWidth, segmentBitmapHeight, // subsection w, h\r\n                    drawXOffset + sliceYDistance, drawYOffset + sliceXDistance, // drawn x, y\r\n                    segmentDrawWidth, segmentDrawHeight);    // drawn w, h\r\n\r\n                bitmapYOffset += segmentBitmapHeight;\r\n                drawYOffset += segmentDrawHeight;\r\n            }\r\n\r\n            bitmapXOffset += segmentBitmapWidth;\r\n            drawXOffset += segmentDrawWidth;\r\n        }\r\n\r\n        return this.offCanvas;\r\n    }\r\n\r\n    drawBlur(bitmap, offset, drawWidth, drawHeight) {\r\n        this.context.globalAlpha = this.blurAlpha;\r\n        if(this.xBlur) {\r\n            if(this.blurIterations < 0) {\r\n                this.context.globalAlpha = 1;\r\n                this.context.drawImage(bitmap, Math.floor(offset - this.blurDistance/2), 0,\r\n                    drawWidth + this.blurDistance, drawHeight);\r\n            } else {\r\n                for(let i=-1; i<=1; i+= this.blurDelta) {\r\n                    this.context.drawImage(bitmap, Math.floor(this.blurDistance * i) + offset, 0, drawWidth, drawHeight);\r\n                }\r\n            }\r\n        } else if(this.yBlur) {\r\n            if(this.blurIterations < 0) {\r\n                this.context.globalAlpha = 1;\r\n                this.context.drawImage(bitmap, offset, Math.floor(-this.blurDistance/2),\r\n                    drawWidth, drawHeight + this.blurDistance);\r\n            } else {\r\n                for(let i=-1; i<=1; i+= this.blurDelta) {\r\n                    this.context.drawImage(bitmap, offset, Math.floor(this.blurDistance * i), drawWidth, drawHeight);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // draws the correct trippy colour circles onto the offscreen canvas\r\n    drawTrippy(width, height) {\r\n        // x blur moves inwards from the corners, y comes out\r\n        // So the base colour is inverted for y, normal for x\r\n        // Thus if the y start is more recent, we invert\r\n        let baseInvert = this.trippyStart[1] > this.trippyStart[0];\r\n        let invertC = this.intToHex(0xFFFFFF ^ this.colour);\r\n        let normalC = this.intToHex(this.colour);\r\n        this.offContext.fillStyle = baseInvert ? invertC : normalC;\r\n        this.offContext.fillRect(0,0,width,height);\r\n\r\n        // sort high to low\r\n        this.trippyRadii.sort(function(a,b) {\r\n            return b - a;\r\n        });\r\n\r\n        let invert = !baseInvert;\r\n        for(let i = 0; i < 2; i++) {\r\n            if(this.trippyRadii[i] === 0) {\r\n                continue;\r\n            }\r\n            // Invert for each subsequent draw\r\n            this.offContext.beginPath();\r\n            this.offContext.fillStyle = this.intToHex(invert ? invertC : normalC);\r\n            this.offContext.arc(width/2, height/2, this.trippyRadii[i], 0, 2 * Math.PI, false);\r\n            this.offContext.fill();\r\n            this.offContext.closePath();\r\n            invert = !invert;\r\n        }\r\n    }\r\n\r\n    /* Second fastest method from\r\n     http://stackoverflow.com/questions/10073699/pad-a-number-with-leading-zeros-in-javascript\r\n     It stil does millions of ops per second, and isn't ugly like the integer if/else */\r\n    intToHex(num) {\r\n        return '#' + (\"00000\"+num.toString(16)).slice(-6);\r\n    }\r\n\r\n    animationLoop() {\r\n        if (this.colourFade) {\r\n            let delta = this.audio.currentTime - this.colourFadeStart;\r\n            let fadeVal = delta / this.colourFadeLength;\r\n            if (fadeVal >= 1) {\r\n                this.stopFade();\r\n                this.colour = this.newColour;\r\n            } else {\r\n                this.mixColours(fadeVal);\r\n            }\r\n            this.needsRedraw = true;\r\n        }\r\n        if(this.blackoutTimeout && this.audio.currentTime > this.blackoutTimeout) {\r\n            this.clearBlackout();\r\n        }\r\n        if(this.image && this.image.animated){\r\n            if(this.image.beatsPerAnim && this.core.currentSong && this.core.currentSong.charsPerBeat) {\r\n                let a = this.animFrame;\r\n                this.syncAnim();\r\n                if(this.animFrame != a) {\r\n                    this.needsRedraw = true;\r\n                    // If you change to a non-synced song, this needs to be reset\r\n                    this.animTimeout = this.audio.currentTime;\r\n                }\r\n            } else if(this.animTimeout < this.audio.currentTime) {\r\n                this.animFrame++;\r\n                this.animFrame %= this.image.frameDurations.length;\r\n                // Don't rebase to current time otherwise we may lag\r\n                this.animTimeout += this.image.frameDurations[this.animFrame]/1000;\r\n                this.needsRedraw = true;\r\n            }\r\n        }\r\n        if(this.blurStart) {\r\n            // flash offsets blur gen by a frame\r\n            let delta = this.audio.currentTime - this.blurStart + (1/30);\r\n            this.blurDistance = this.blurAmount * Math.exp(-this.blurDecay * delta);\r\n\r\n            // Update UI\r\n            let dist = this.blurDistance / this.blurAmount;\r\n            if(this.xBlur)\r\n                this.core.blurUpdated(dist, 0);\r\n            else\r\n                this.core.blurUpdated(0, dist);\r\n        }\r\n        if(this.sliceStart) {\r\n            let transitionPercent = 0.8;\r\n            let delta;\r\n            let now = this.audio.currentTime;\r\n            if(now < this.sliceRampUp) {\r\n                delta = this.sliceRampUp - now;\r\n                this.sliceDistance = (1-(delta / this.sliceTransitionTime)) * transitionPercent;\r\n            } else if(now < this.sliceRampDown) {\r\n                delta = this.sliceRampDown - now;\r\n                let longTransition = this.sliceRampDown - this.sliceRampUp;\r\n                this.sliceDistance = transitionPercent + ((1-(delta / longTransition)) * (1-transitionPercent));\r\n            } else {\r\n                let endEffect = this.sliceRampDown + this.sliceTransitionTime;\r\n                if(now > endEffect) {\r\n                    this.sliceStart = 0;\r\n                    this.sliceDistance = 0;\r\n                } else {\r\n                    delta = endEffect - now;\r\n                    this.sliceDistance = delta / this.sliceTransitionTime;\r\n                }\r\n            }\r\n            this.needsRedraw = true;\r\n        }\r\n        for(let i = 0; i < 2; i++) {\r\n            if(this.trippyStart[i] || this.trippyRadii[i]) {\r\n                this.needsRedraw = true;\r\n                this.trippyRadii[i] = Math.floor((this.audio.currentTime - this.trippyStart[i]) * this.trippyRadius) * 2;\r\n                if(this.trippyRadii[i] > this.trippyRadius) {\r\n                    this.trippyStart[i] = 0;\r\n                    this.trippyRadii[i] = 0;\r\n                    continue;\r\n                }\r\n                // x comes from outside the window\r\n                if(i % 2 === 0) {\r\n                    this.trippyRadii[i] = this.trippyRadius - this.trippyRadii[i];\r\n                }\r\n            }\r\n        }\r\n\r\n        if(this.blurStart && this.blurDistance < 1) {\r\n            this.core.blurUpdated(0, 0);\r\n            this.blurDistance = 0;\r\n            this.blurStart = 0;\r\n            this.xBlur = this.yBlur = false;\r\n            this.redraw();\r\n        } else if(this.blurStart) {\r\n            this.redraw();\r\n        } else if(this.needsRedraw){\r\n            this.redraw();\r\n        }\r\n    }\r\n\r\n    setImage(image) {\r\n        if(this.image == image) {\r\n            return;\r\n        }\r\n        this.needsRedraw = true;\r\n        this.image = image;\r\n        // Null images don't need anything interesting done to them\r\n        if(!image || (!image.bitmap && !image.bitmaps)) {\r\n            return;\r\n        }\r\n        if(image.animated) {\r\n            this.animBeat = null;\r\n            this.animFrame = 0;\r\n            this.animTimeout = this.audio.currentTime + image.frameDurations[0]/1000;\r\n            if(image.beatsPerAnim && this.core.currentSong && this.core.currentSong.charsPerBeat) {\r\n                this.syncAnim();\r\n            }\r\n        }\r\n    }\r\n\r\n    beat() {\r\n        this.lastBeat = this.audio.currentTime;\r\n    }\r\n\r\n    syncAnim() {\r\n        let song = this.core.currentSong;\r\n        if(!song) { // fallback to default\r\n           return;\r\n        }\r\n        let index = this.core.beatIndex;\r\n        // When animation has more frames than song has beats, or part thereof\r\n        if(this.lastBeat && this.core.getBeatLength()) {\r\n            let interp = (this.audio.currentTime - this.lastBeat) / this.core.getBeatLength();\r\n            index += Math.min(interp, 1);\r\n        }\r\n        // This loops A-OK because the core's beatIndex never rolls over for a new loop\r\n        let beatLoc = (index / song.charsPerBeat) % this.image.beatsPerAnim;\r\n\r\n        let aLen = this.image.bitmaps.length;\r\n        this.animFrame = Math.floor(aLen * (beatLoc / this.image.beatsPerAnim));\r\n        if(this.image.syncOffset) {\r\n            this.animFrame += this.image.syncOffset;\r\n        }\r\n        // Because negative mods are different in JS\r\n        this.animFrame = ((this.animFrame % aLen) + aLen) % aLen;\r\n    }\r\n\r\n    setColour(colour, isFade) {\r\n        if(colour.c == this.colour) {\r\n            return;\r\n        }\r\n        if(isFade) {\r\n            this.newColour = colour.c;\r\n        } else {\r\n            this.stopFade();\r\n            this.colour = colour.c;\r\n        }\r\n        this.needsRedraw = true;\r\n    }\r\n\r\n    doBlackout(whiteout) {\r\n        if(typeof(whiteout) === 'undefined') whiteout = false;\r\n        if(whiteout) {\r\n            this.blackoutColour = \"#FFF\";\r\n        } else {\r\n            this.blackoutColour = \"#000\";\r\n        }\r\n        this.blackoutTimeout = 0; // indefinite\r\n        // Don't restart the blackout animation if we're already blacked out\r\n        if(!this.blackout) {\r\n            this.blackoutStart = this.audio.currentTime;\r\n        }\r\n        this.blackout = true;\r\n        this.needsRedraw = true;\r\n        if(this.core.settings.blackoutUI == \"on\") {\r\n            this.core.userInterface.hide();\r\n        }\r\n    }\r\n\r\n    clearBlackout() {\r\n        this.blackout = false;\r\n        this.blackoutTimeout = 0;\r\n        this.needsRedraw = true;\r\n        if(this.core.settings.blackoutUI == \"on\") {\r\n            this.core.userInterface.show();\r\n        }\r\n    }\r\n\r\n    doShortBlackout(beatTime) {\r\n        // looks better if we go right to black\r\n        this.doInstantBlackout();\r\n        this.blackoutTimeout = this.audio.currentTime + beatTime / 1.7;\r\n        this.currentBlackout++;\r\n    }\r\n\r\n    doInstantBlackout() {\r\n        this.doBlackout();\r\n        // sufficiently negative\r\n        this.blackoutStart = -Math.pow(2, 32);\r\n    }\r\n\r\n    doColourFade(length) {\r\n        this.colourFade = true;\r\n        this.colourFadeLength = length;\r\n        this.colourFadeStart = this.audio.currentTime;\r\n        this.oldColour = this.colour;\r\n    }\r\n\r\n    stopFade() {\r\n        this.colourFade = false;\r\n        this.colourFadeStart = 0;\r\n        this.colourFadeLength = 0;\r\n    }\r\n\r\n    mixColours(percent) {\r\n        percent = Math.min(1, percent);\r\n        let oldR = this.oldColour >> 16 & 0xFF;\r\n        let oldG = this.oldColour >> 8  & 0xFF;\r\n        let oldB = this.oldColour       & 0xFF;\r\n        let newR = this.newColour >> 16 & 0xFF;\r\n        let newG = this.newColour >> 8  & 0xFF;\r\n        let newB = this.newColour       & 0xFF;\r\n        let mixR = oldR * (1 - percent) + newR * percent;\r\n        let mixG = oldG * (1 - percent) + newG * percent;\r\n        let mixB = oldB * (1 - percent) + newB * percent;\r\n        this.colour = mixR << 16 | mixG << 8 | mixB;\r\n    }\r\n\r\n    doXBlur() {\r\n        this.blurStart = this.audio.currentTime;\r\n        if(this.trippyOn)\r\n            this.trippyStart[0] = this.blurStart;\r\n        this.blurDistance = this.blurAmount;\r\n        this.xBlur = true;\r\n        this.yBlur = false;\r\n        this.needsRedraw = true;\r\n    }\r\n\r\n    doYBlur() {\r\n        this.blurStart = this.audio.currentTime;\r\n        if(this.trippyOn)\r\n            this.trippyStart[1] = this.blurStart;\r\n        this.blurDistance = this.blurAmount;\r\n        this.xBlur = false;\r\n        this.yBlur = true;\r\n        this.needsRedraw = true;\r\n    }\r\n\r\n    doTrippyX() {\r\n        let saveTrippy = this.trippyOn;\r\n        // force trippy\r\n        this.trippyOn = true;\r\n        this.doXBlur();\r\n        this.trippyOn = saveTrippy;\r\n    }\r\n\r\n    doTrippyY() {\r\n        let saveTrippy = this.trippyOn;\r\n        // force trippy\r\n        this.trippyOn = true;\r\n        this.doYBlur();\r\n        this.trippyOn = saveTrippy;\r\n    }\r\n\r\n    doSlice(beatLength, beatCount, sliceX, sliceY) {\r\n        let transitionTime = Math.min(0.06, beatLength);\r\n\r\n        this.sliceStart = this.audio.currentTime;\r\n        this.sliceRampUp = this.sliceStart + transitionTime;\r\n        this.sliceRampDown = this.sliceStart + (beatLength * beatCount) - transitionTime;\r\n        this.sliceTransitionTime = transitionTime;\r\n\r\n        if (sliceX)\r\n            this.generateSliceSegments('x');\r\n        else\r\n            this.resetSliceSegments('x');\r\n        if (sliceY)\r\n            this.generateSliceSegments('y');\r\n        else\r\n            this.resetSliceSegments('y');\r\n\r\n        this.needsRedraw = true;\r\n    }\r\n\r\n    generateSliceSegments(direction) {\r\n        let even = 1.0 / this.slices[direction].avgSegments;\r\n        let spread = even / 2;\r\n        let total = 0;\r\n        let i;\r\n        for(i = 0; ; i++) {\r\n            let rando = even + Math.random() * spread * 2 - spread;\r\n            this.slices[direction].segments[i] = rando;\r\n            total += rando;\r\n\r\n            this.slices[direction].distances[i] =\r\n                Math.random() * this.blurAmount - this.blurAmount / 2;\r\n\r\n            if(total > 1.0) {\r\n                this.slices[direction].segments[i] -= total - 1.0;\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.slices[direction].count = i + 1;\r\n    }\r\n\r\n    resetSliceSegments(direction) {\r\n        this.slices[direction].count = 1;\r\n        this.slices[direction].segments[0] = 1;\r\n        this.slices[direction].distances[0] = 0;\r\n    }\r\n\r\n    setBlurDecay(decay) {\r\n        this.blurDecay = {\"slow\" : 7.8, \"medium\" : 14.1, \"fast\" : 20.8, \"faster!\" : 28.7}[decay];\r\n    }\r\n\r\n    setBlurQuality(quality) {\r\n        this.blurIterations = {\"low\" : -1, \"medium\" : 11, \"high\" : 19, \"extreme\" : 35}[quality];\r\n        this.blurDelta = 1 / (this.blurIterations/2);\r\n        this.blurAlpha = 1 / (this.blurIterations/2);\r\n    }\r\n\r\n    setBlurAmount(amount) {\r\n        this.blurAmount = {\"low\" : 48, \"medium\" : 96, \"high\" : 384}[amount];\r\n    }\r\n\r\n    setSmartAlign(align) {\r\n        this.smartAlign = align == \"on\";\r\n    }\r\n}\r\n\r\nwindow.HuesCanvas = HuesCanvas;\r\n\r\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n(function(window, document) {\r\n\"use strict\";\r\n\r\nclass HuesCore {\r\n    constructor(defaults) {\r\n        this.eventListeners = {\r\n            /* callback loaded()\r\n             *\r\n             * When everything has completely loaded and we're ready to go\r\n             */\r\n            loaded : [],\r\n\r\n            /* callback time(seconds)\r\n             *\r\n             * When the song time is updated - negative for buildup\r\n             * Returns a floating point number denoting seconds\r\n             */\r\n            time : [],\r\n\r\n            /* callback blurUpdate(xPercent, yPercent)\r\n             *\r\n             * The current blur amounts, in percent of full blur\r\n             */\r\n            blurupdate : [],\r\n\r\n            /* callback newsong(song)\r\n             *\r\n             * Called on song change, whether user triggered or autosong.\r\n             * Song object is passed.\r\n             */\r\n            newsong : [],\r\n\r\n            /* callback newimage(image)\r\n             *\r\n             * Called on image change, whether user triggered or FULL AUTO mode.\r\n             * Image object is passed.\r\n             */\r\n            newimage : [],\r\n\r\n            /* callback newcolour(colour, isFade)\r\n             *\r\n             * Called on colour change.\r\n             * colour: colour object.\r\n             * isFade: if the colour is fading from the previous value\r\n             */\r\n            newcolour : [],\r\n\r\n            /* callback newmode(mode)\r\n             *\r\n             * Called on mode change.\r\n             * Mode is passed as a boolean.\r\n             */\r\n            newmode : [],\r\n\r\n            /* callback beat(beatString, beatIndex)\r\n             *\r\n             * Called on every new beat.\r\n             * beatString is a 256 char long array of current and upcoming beat chars\r\n             * beatIndex is the beat index. Negative during buildups\r\n             */\r\n            beat : [],\r\n\r\n            /* callback invert(isInverted)\r\n             *\r\n             * Called whenever the invert state changes.\r\n             * Invert state is passed as a boolean.\r\n             */\r\n            invert : [],\r\n\r\n            /* callback frame()\r\n             *\r\n             * Called on each new frame, at the end of all other frame processing\r\n             */\r\n            frame : [],\r\n\r\n            /* callback songstarted(song)\r\n             *\r\n             * Called when the song actually begins to play, not just when the\r\n             * new song processing begins. Song object passed.\r\n             */\r\n            songstarted : [],\r\n\r\n            /* callback settingsupdated()\r\n             *\r\n             * Called when settings are updated and should be re-read from the settings object\r\n             */\r\n            settingsupdated : []\r\n        };\r\n\r\n        // Bunch-o-initialisers\r\n        this.version = 34;\r\n        this.versionStr = (this.version/10).toFixed(1);\r\n        this.versionHex = this.version.toString(16);\r\n        this.beatIndex = 0;\r\n\r\n        // How long a beat lasts for in each section\r\n        this.buildLength = -1;\r\n        this.loopLength = -1;\r\n\r\n        this.currentSong = null;\r\n        this.currentImage = null;\r\n        this.songIndex = -1;\r\n        this.imageIndex = -1;\r\n        this.lastSongArray = [];\r\n        this.lastImageArray = [];\r\n\r\n        this.colourIndex = 0x3f;\r\n        this.colours = HuesCore.oldColours;\r\n\r\n        this.invert = false;\r\n        this.loopCount = 0;\r\n        this.doBuildup = true;\r\n        this.userInterface = null;\r\n        this.uiArray = [];\r\n\r\n        this.settings = new HuesSettings(defaults);\r\n        zip.workerScriptsPath = this.settings.workersPath;\r\n\r\n        // What's our root element?\r\n        this.root = null;\r\n        if(!this.settings.root) {\r\n            this.root = document.body;\r\n        } else if(typeof this.settings.root === \"string\") {\r\n            if(this.settings.root && document.getElementById(this.settings.root)) {\r\n                this.root = document.getElementById(this.settings.root);\r\n            } else {\r\n                this.root = document.body;\r\n            }\r\n        } else { // been given an element\r\n            this.root = this.settings.root;\r\n        }\r\n        this.root.classList.add(\"hues-root\");\r\n        // Special case for full page Hues\r\n        if(this.root === document.body) {\r\n            document.documentElement.className = \"hues-root\";\r\n        }\r\n        // Yes, we do indeed have Javascript\r\n        this.root.innerHTML = \"\";\r\n\r\n        this.makePreloader(this.root);\r\n\r\n        window.onerror = (msg, url, line, col, error) => {\r\n            this.error(msg);\r\n            // Get more info in console\r\n            return false;\r\n        };\r\n\r\n        this.window = new HuesWindow(this.root, this.settings);\r\n\r\n        console.log(\"0x40 Hues v\" + this.versionStr + \" - start your engines!\");\r\n\r\n        this.resourceManager = new Resources(this, this.window);\r\n        this.editor = new HuesEditor(this, this.window);\r\n        this.settings.initUI(this.window);\r\n        populateHuesInfo(this.versionStr, this.window, this.settings);\r\n\r\n        this.window.selectTab(this.settings.firstWindow, true);\r\n\r\n        let ui = document.createElement(\"div\");\r\n        ui.className = \"hues-ui\";\r\n        this.root.appendChild(ui);\r\n        this.uiArray.push(new RetroUI(ui), new WeedUI(ui), new ModernUI(ui),\r\n                          new XmasUI(ui), new HalloweenUI(ui), new MinimalUI(ui));\r\n\r\n        this.autoSong = this.settings.autoSong;\r\n\r\n        this.visualiser = document.createElement(\"canvas\");\r\n        this.visualiser.className = \"hues-visualiser\";\r\n        this.visualiser.height = \"64\";\r\n        this.vCtx = this.visualiser.getContext(\"2d\");\r\n\r\n        this.soundManager = new SoundManager(this);\r\n\r\n        this.soundManager.init().then(() => {\r\n            if(!this.soundManager.locked && this.settings.skipPreloader == \"on\") {\r\n                return null;\r\n            } else {\r\n                return this.resourceManager.getSizes(this.settings.respacks);\r\n            }\r\n        }).then( sizes => {\r\n            if(sizes === null) {\r\n                return;\r\n            }\r\n\r\n            let size = sizes.reduce( (prev, curr) => {\r\n                return typeof curr === 'number' ? prev + curr : null;\r\n            }, 0);\r\n            if(typeof size === 'number') {\r\n                size = size.toFixed(1);\r\n            } else {\r\n                size = '<abbr title=\"Content-Length header not present for respack URLs\">???</abbr>';\r\n            }\r\n\r\n            let warning = size + \"MB of music/images.<br />\" +\r\n                \"Flashing lights.<br />\" +\r\n                \"<b>Tap or click to start</b>\";\r\n\r\n            if(!this.soundManager.locked) {\r\n                warning += \"<br /><span>Skip this screen from Options</span>\";\r\n            }\r\n            this.warning(warning);\r\n            // Even if not locked, this steals clicks which is useful here\r\n            return this.soundManager.unlock();\r\n        }).then(() => {\r\n            this.clearMessage();\r\n            setInterval(this.loopCheck.bind(this), 1000);\r\n            this.renderer = new HuesCanvas(this.root, this.soundManager, this);\r\n            // Now all our objects are instantiated, we fire the updated settings\r\n            this.settings.addEventListener(\"updated\", this.settingsUpdated.bind(this));\r\n            this.settingsUpdated();\r\n            this.setColour(this.colourIndex);\r\n            this.animationLoop();\r\n\r\n            if(this.settings.load) {\r\n                return this.resourceManager.addAll(this.settings.respacks, progress => {\r\n                    this.preloader.style.backgroundPosition = (100 - progress*100) + \"% 0%\";\r\n                    let scale = Math.floor(progress * this.settings.preloadMax);\r\n                    let padding = this.settings.preloadMax.toString(this.settings.preloadBase).length;\r\n                    this.preloadMsg.textContent = this.settings.preloadPrefix +\r\n                                                  (Array(padding).join(\"0\") +\r\n                                                  scale.toString(this.settings.preloadBase)).slice(-padding);\r\n                });\r\n            } else {\r\n                this.preloader.style.display = \"none\";\r\n                return;\r\n            }\r\n        }).then(() => {\r\n            this.preloader.classList.add(\"hues-preloader--loaded\");\r\n            this.callEventListeners(\"loaded\");\r\n            if(this.settings.firstImage) {\r\n                this.setImageByName(this.settings.firstImage);\r\n            } else {\r\n                this.setImage(0);\r\n            }\r\n            if(this.settings.autoplay) {\r\n                if(this.settings.firstSong) {\r\n                    this.setSongByName(this.settings.firstSong);\r\n                } else {\r\n                    this.setSong(0);\r\n                }\r\n            }\r\n        }).catch(error => { // Comment this out to get proper stack traces\r\n            this.error(error);\r\n        });\r\n\r\n        if(!this.settings.disableKeyboard) {\r\n            document.addEventListener(\"keydown\", e => {\r\n                e = e || window.event;\r\n                if(e.defaultPrevented) {\r\n                    return true;\r\n                }\r\n                // Ignore modifiers so we don't steal other events\r\n                if (e.altKey || e.ctrlKey || e.metaKey || e.shiftKey) {\r\n                    return true;\r\n                }\r\n                // If we've focused a text input, let the input go through!\r\n                if((e.target.tagName.toLowerCase() == \"input\" && e.target.type == \"text\") ||\r\n                    e.target.contentEditable === \"true\") {\r\n                    return true;\r\n                }\r\n                let key = e.keyCode || e.which;\r\n                return this.keyHandler(key);\r\n            });\r\n        }\r\n    }\r\n\r\n    callEventListeners(ev) {\r\n        let args = Array.prototype.slice.call(arguments, 1);\r\n        this.eventListeners[ev].forEach(function(callback) {\r\n            callback.apply(null, args);\r\n        });\r\n    }\r\n\r\n    addEventListener(ev, callback) {\r\n        ev = ev.toLowerCase();\r\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\r\n            this.eventListeners[ev].push(callback);\r\n        } else {\r\n            throw Error(\"Unknown event: \" + ev);\r\n        }\r\n    }\r\n\r\n    removeEventListener(ev, callback) {\r\n        ev = ev.toLowerCase();\r\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\r\n            this.eventListeners[ev] = this.eventListeners[ev].filter(function(a) {\r\n                return (a !== callback);\r\n            });\r\n        } else {\r\n            throw Error(\"Unknown event: \" + ev);\r\n        }\r\n    }\r\n\r\n    makePreloader(root) {\r\n        this.preloader = document.createElement(\"div\");\r\n        this.preloader.className = \"hues-preloader\";\r\n        root.appendChild(this.preloader);\r\n\r\n        if(this.settings.preloadTitle) {\r\n            this.preloadTitle = document.createElement(\"div\");\r\n            this.preloadTitle.className = \"hues-preloader__title\";\r\n            this.preloadTitle.textContent = this.settings.preloadTitle;\r\n            this.preloader.appendChild(this.preloadTitle);\r\n        }\r\n\r\n        this.preloadMsg = document.createElement(\"div\");\r\n        this.preloadMsg.className = \"hues-preloader__text\";\r\n        this.preloadMsg.textContent = \"Initialising...\";\r\n        this.preloader.appendChild(this.preloadMsg);\r\n\r\n        this.preloadSubMsg = document.createElement(\"div\");\r\n        this.preloadSubMsg.className = \"hues-preloader__subtext\";\r\n        this.preloader.appendChild(this.preloadSubMsg);\r\n    }\r\n\r\n    resizeVisualiser() {\r\n        this.soundManager.initVisualiser(this.visualiser.width/2);\r\n    }\r\n\r\n    updateVisualiser() {\r\n        if(this.settings.visualiser != \"on\") {\r\n            return;\r\n        }\r\n\r\n        let logArrays = this.soundManager.getVisualiserData();\r\n        if(!logArrays) {\r\n            return;\r\n        }\r\n\r\n        this.vCtx.clearRect(0, 0, this.vCtx.canvas.width, this.vCtx.canvas.height);\r\n\r\n        let gradient=this.vCtx.createLinearGradient(0,64,0,0);\r\n        if(this.invert) {\r\n            gradient.addColorStop(1,\"rgba(20,20,20,0.6)\");\r\n            gradient.addColorStop(0,\"rgba(255,255,255,0.6)\");\r\n        } else {\r\n            gradient.addColorStop(1,\"rgba(255,255,255,0.6)\");\r\n            gradient.addColorStop(0,\"rgba(20,20,20,0.6)\");\r\n        }\r\n        this.vCtx.fillStyle = gradient;\r\n\r\n        let barWidth = 2;\r\n        let barHeight;\r\n        let x = 0;\r\n        for(let a = 0; a < logArrays.length; a++) {\r\n            let vals = logArrays[a];\r\n            for(let i = 0; i < vals.length; i++) {\r\n                let index = 0;\r\n                if(logArrays.length == 2 && a === 0) {\r\n                    index = vals.length - i - 1;\r\n                } else {\r\n                    index = i;\r\n                }\r\n                barHeight = vals[index]/4;\r\n\r\n                this.vCtx.fillRect(x,this.vCtx.canvas.height-barHeight,barWidth,barHeight);\r\n\r\n                x += barWidth;\r\n            }\r\n        }\r\n    }\r\n\r\n    animationLoop() {\r\n        requestAnimationFrame(this.animationLoop.bind(this));\r\n        if(!this.soundManager.playing) {\r\n            this.callEventListeners(\"frame\");\r\n            return;\r\n        }\r\n        this.updateVisualiser();\r\n        let now = this.soundManager.currentTime;\r\n        this.callEventListeners(\"time\", this.soundManager.clampedTime);\r\n        if(now >= 0 && this.doBuildup) {\r\n            this.currentSong.buildupPlayed = true;\r\n        }\r\n        for(let beatTime = this.beatIndex * this.getBeatLength(); beatTime < now;\r\n                beatTime = ++this.beatIndex * this.getBeatLength()) {\r\n            let beat = this.getBeat(this.beatIndex);\r\n            this.beater(beat);\r\n        }\r\n        this.callEventListeners(\"frame\");\r\n    }\r\n\r\n    recalcBeatIndex(forcedNow) {\r\n        let now = typeof forcedNow === \"number\" ? forcedNow : this.soundManager.currentTime;\r\n        // getBeatLength isn't updated with the right beatIndex yet\r\n        this.beatIndex = Math.floor(now / (now < 0 ? this.buildLength : this.loopLength));\r\n        // beatIndex is NaN, abort\r\n        if(this.beatIndex != this.beatIndex) {\r\n            this.setInvert(false);\r\n            return;\r\n        }\r\n\r\n        // We should sync up to how many inverts there are\r\n        let build = this.currentSong.buildupRhythm;\r\n        let rhythm = this.currentSong.rhythm;\r\n        let mapSoFar;\r\n        if(this.beatIndex < 0) {\r\n            // Clamp to 0 in case we've juuust started\r\n            mapSoFar = build.slice(0, Math.max(this.beatIndex + build.length, 0));\r\n        } else {\r\n            // If the rhythm has an odd number of inverts, don't reset because it\r\n            // alternates on each loop anyway\r\n            if((rhythm.match(/i|I/g)||[]).length % 2) {\r\n                return;\r\n            }\r\n            mapSoFar = (build ? build : \"\") + rhythm.slice(0, this.beatIndex);\r\n        }\r\n        // If there's an odd amount of inverts thus far, invert our display\r\n        let invertCount = (mapSoFar.match(/i|I/g)||[]).length;\r\n        this.setInvert(invertCount % 2);\r\n    }\r\n\r\n    getBeatIndex() {\r\n        if(!this.soundManager.playing) {\r\n            return 0;\r\n        } else if(this.beatIndex < 0) {\r\n            return this.beatIndex;\r\n        } else {\r\n            return this.beatIndex % this.currentSong.rhythm.length;\r\n        }\r\n    }\r\n\r\n    getSafeBeatIndex() {\r\n        let index = this.getBeatIndex();\r\n        if(index < 0) {\r\n            return 0;\r\n        } else {\r\n            return index;\r\n        }\r\n    }\r\n\r\n    blurUpdated(x, y) {\r\n        this.callEventListeners(\"blurupdate\", x, y);\r\n    }\r\n\r\n    nextSong() {\r\n        let index = (this.songIndex + 1) % this.resourceManager.enabledSongs.length;\r\n        this.setSong(index);\r\n    }\r\n\r\n    previousSong() {\r\n        let index = ((this.songIndex - 1) + this.resourceManager.enabledSongs.length) % this.resourceManager.enabledSongs.length;\r\n        this.setSong(index);\r\n    }\r\n\r\n    setSongByName(name) {\r\n        let songs = this.resourceManager.enabledSongs;\r\n        let bestSong = 0;\r\n        let bestScore = 0;\r\n        for(let i = 0; i < songs.length; i++) {\r\n            let score = songs[i].title.score(name);\r\n            if(score > bestScore) {\r\n                bestScore = score;\r\n                bestSong = i;\r\n            }\r\n        }\r\n        return this.setSong(bestSong);\r\n    }\r\n\r\n    /* To set songs via reference instead of index - used in HuesEditor */\r\n    setSongOject(song) {\r\n        for(let i = 0; i < this.resourceManager.enabledSongs.length; i++) {\r\n            if(this.resourceManager.enabledSongs[i] === song) {\r\n                return this.setSong(i);\r\n            }\r\n        }\r\n    }\r\n\r\n    setSong(index, leaveArray) {\r\n        if(this.currentSong == this.resourceManager.enabledSongs[index]) {\r\n            return;\r\n        }\r\n        // When not randoming, clear this\r\n        if(!leaveArray) {\r\n            this.lastSongArray = [];\r\n        }\r\n        this.lastSongArray.push(index);\r\n        this.songIndex = index;\r\n        this.currentSong = this.resourceManager.enabledSongs[this.songIndex];\r\n        if (this.currentSong === undefined) {\r\n            this.currentSong = {\"name\":\"None\", \"title\":\"None\", \"rhythm\":\".\", \"source\":null, \"crc\":\"none\", \"sound\":null, \"enabled\":true, \"filename\":\"none\"};\r\n        }\r\n        console.log(\"Next song:\", this.songIndex, this.currentSong);\r\n        this.callEventListeners(\"newsong\", this.currentSong);\r\n        this.loopCount = 0;\r\n        if (this.currentSong.buildup) {\r\n            switch (this.settings.playBuildups) {\r\n            case \"off\":\r\n                this.currentSong.buildupPlayed = true;\r\n                this.doBuildup = false;\r\n                break;\r\n            case \"on\":\r\n                this.currentSong.buildupPlayed = false;\r\n                this.doBuildup = true;\r\n                break;\r\n            case \"once\":\r\n                this.doBuildup = !this.currentSong.buildupPlayed;\r\n                break;\r\n            }\r\n        }\r\n        this.setInvert(false);\r\n        this.renderer.doInstantBlackout();\r\n        return this.soundManager.playSong(this.currentSong, this.doBuildup)\r\n        .then(() => {\r\n            this.resetAudio();\r\n            this.fillBuildup();\r\n            this.callEventListeners(\"songstarted\", this.currentSong);\r\n        });\r\n    }\r\n\r\n    updateBeatLength() {\r\n        this.loopLength = this.soundManager.loopLength / this.currentSong.rhythm.length;\r\n        if(this.currentSong.buildup) {\r\n            if (!this.currentSong.buildupRhythm) {\r\n                this.currentSong.buildupRhythm = \".\";\r\n            }\r\n            this.buildLength = this.soundManager.buildLength / this.currentSong.buildupRhythm.length;\r\n        } else {\r\n            this.buildLength = -1;\r\n        }\r\n    }\r\n\r\n    getBeatLength() {\r\n        if(this.beatIndex < 0) {\r\n            return this.buildLength;\r\n        } else {\r\n            return this.loopLength;\r\n        }\r\n    }\r\n\r\n    fillBuildup() {\r\n        // update loop length for flash style filling\r\n        this.updateBeatLength();\r\n        if(this.currentSong.buildup) {\r\n            if(this.currentSong.independentBuild) {\r\n                console.log(\"New behaviour - separate build/loop lengths\");\r\n                // Do nothing\r\n            } else {\r\n                console.log(\"Flash behaviour - filling buildup\");\r\n                let buildBeats = Math.floor(this.soundManager.buildLength / this.loopLength);\r\n                if(buildBeats < 1) {\r\n                    buildBeats = 1;\r\n                }\r\n                while (this.currentSong.buildupRhythm.length < buildBeats) {\r\n                    this.currentSong.buildupRhythm = this.currentSong.buildupRhythm + \".\";\r\n                }\r\n                console.log(\"Buildup length:\", buildBeats);\r\n            }\r\n        }\r\n        // update with a buildup of possibly different length\r\n        this.updateBeatLength();\r\n        // If we're in the build or loop this will adjust\r\n        // If we've lagged a bit, we'll miss the first beat. Rewind!\r\n        this.recalcBeatIndex(this.doBuildup ? -this.soundManager.buildLength : 0);\r\n    }\r\n\r\n    randomSong() {\r\n        let songCount = this.resourceManager.enabledSongs.length;\r\n        let index=Math.floor((Math.random() * songCount));\r\n        if (songCount > 1 && (index == this.songIndex || this.lastSongArray.indexOf(index) != -1)) {\r\n            this.randomSong();\r\n        } else {\r\n            console.log(\"Randoming a song!\");\r\n            this.setSong(index, true);\r\n            let noRepeat = Math.min(5, Math.floor(songCount / 2));\r\n            while (this.lastSongArray.length > noRepeat && noRepeat >= 0) {\r\n                this.lastSongArray.shift();\r\n            }\r\n        }\r\n    }\r\n\r\n    /* This is its own function because requestAnimationFrame is called very very\r\n       rarely when the tab is backgrounded. As autoSong is often used to chill with\r\n       music, it's important to keep checking the loop so songs don't go for too\r\n       long. */\r\n    loopCheck() {\r\n        if(Math.floor(this.soundManager.currentTime / this.soundManager.loopLength) > this.loopCount) {\r\n            this.onLoop();\r\n        }\r\n    }\r\n\r\n    onLoop() {\r\n        this.loopCount++;\r\n        switch (this.settings.autoSong) {\r\n        case \"loop\":\r\n            console.log(\"Checking loops\");\r\n            if (this.loopCount >= this.settings.autoSongDelay) {\r\n                this.doAutoSong();\r\n            }\r\n            break;\r\n        case \"time\":\r\n            console.log(\"Checking times\");\r\n            if (this.soundManager.loopLength * this.loopCount >= this.settings.autoSongDelay * 60) {\r\n                this.doAutoSong();\r\n            }\r\n            break;\r\n        }\r\n    }\r\n\r\n    doAutoSong() {\r\n        let func = null;\r\n        if(this.resourceManager.enabledSongs.length < 2) {\r\n            return; // don't move if there's nothing to move to\r\n        }\r\n        if(this.settings.autoSongShuffle == \"on\") {\r\n            func = this.randomSong;\r\n        } else {\r\n            func = this.nextSong;\r\n        }\r\n        if(this.settings.autoSongFadeout == \"on\") {\r\n            this.soundManager.fadeOut(() => {\r\n                func.call(this);\r\n            });\r\n        } else {\r\n            func.call(this);\r\n        }\r\n    }\r\n\r\n    songDataUpdated() {\r\n        if (this.currentSong) {\r\n            this.callEventListeners(\"newsong\", this.currentSong);\r\n            this.callEventListeners(\"newimage\", this.currentImage);\r\n        }\r\n    }\r\n\r\n    resetAudio() {\r\n        this.beatIndex = 0;\r\n        this.songDataUpdated();\r\n        if(this.settings.visualiser == \"on\") {\r\n            this.soundManager.initVisualiser(this.visualiser.width/2);\r\n        }\r\n    }\r\n\r\n    randomImage() {\r\n        if(this.settings.shuffleImages == \"on\") {\r\n            let len = this.resourceManager.enabledImages.length;\r\n            let index = Math.floor(Math.random() * len);\r\n            if ((index == this.imageIndex || this.lastImageArray.indexOf(index) != -1) && len > 1) {\r\n                this.randomImage();\r\n            } else {\r\n                this.setImage(index, true);\r\n                this.lastImageArray.push(index);\r\n                let cull = Math.min(20, Math.floor((len / 2)));\r\n                while (this.lastImageArray.length > cull && cull >= 0) {\r\n                    this.lastImageArray.shift();\r\n                }\r\n            }\r\n        } else { // jk, not actually random\r\n            let img=(this.imageIndex + 1) % this.resourceManager.enabledImages.length;\r\n            this.setImage(img);\r\n        }\r\n    }\r\n\r\n    setImage(index, leaveArray) {\r\n        // If there are no images, this corrects NaN to 0\r\n        this.imageIndex = index ? index : 0;\r\n        let img=this.resourceManager.enabledImages[this.imageIndex];\r\n        if (img == this.currentImage && img !== null) {\r\n            return;\r\n        }\r\n        // When not randoming, clear this\r\n        if(!leaveArray) {\r\n            this.lastImageArray = [];\r\n        }\r\n        if (img) {\r\n            this.currentImage = img;\r\n        } else {\r\n            this.currentImage = {\"name\":\"None\", \"fullname\":\"None\", \"align\":\"center\", \"bitmap\":null, \"source\":null, \"enabled\":true};\r\n            this.imageIndex = -1;\r\n            this.lastImageArray = [];\r\n        }\r\n        this.callEventListeners(\"newimage\", this.currentImage);\r\n    }\r\n\r\n    setImageByName(name) {\r\n        let images = this.resourceManager.enabledImages;\r\n        for(let i = 0; i < images.length; i++) {\r\n            if(images[i].name == name || images[i].fullname == name) {\r\n                this.setImage(i);\r\n                return;\r\n            }\r\n        }\r\n        this.setImage(0); // fallback\r\n    }\r\n\r\n    nextImage() {\r\n        this.setIsFullAuto(false);\r\n        let img=(this.imageIndex + 1) % this.resourceManager.enabledImages.length;\r\n        this.setImage(img);\r\n    }\r\n\r\n    previousImage() {\r\n        this.setIsFullAuto(false);\r\n        let img=((this.imageIndex - 1) + this.resourceManager.enabledImages.length) % this.resourceManager.enabledImages.length;\r\n        this.setImage(img);\r\n    }\r\n\r\n    randomColourIndex() {\r\n        let index=Math.floor((Math.random() * this.colours.length));\r\n        if (index == this.colourIndex) {\r\n            return this.randomColourIndex();\r\n        }\r\n        return index;\r\n    }\r\n\r\n    randomColour(isFade) {\r\n        let index=this.randomColourIndex();\r\n        this.setColour(index, isFade);\r\n    }\r\n\r\n    setColour(index, isFade) {\r\n        this.colourIndex = index;\r\n        let colour = this.colours[this.colourIndex];\r\n        this.callEventListeners(\"newcolour\", colour, isFade);\r\n    }\r\n\r\n    getBeat(index) {\r\n        if(index < 0) {\r\n            return this.currentSong.buildupRhythm[this.currentSong.buildupRhythm.length+index];\r\n        } else {\r\n            return this.currentSong.rhythm[index % this.currentSong.rhythm.length];\r\n        }\r\n    }\r\n\r\n    beater(beat) {\r\n        this.callEventListeners(\"beat\", this.getBeatString(), this.getBeatIndex());\r\n        switch(beat) {\r\n            case 'X':\r\n            case 'x':\r\n                this.renderer.doYBlur();\r\n                break;\r\n            case 'O':\r\n            case 'o':\r\n                this.renderer.doXBlur();\r\n                break;\r\n            case ')':\r\n                this.renderer.doTrippyX();\r\n                break;\r\n            case '(':\r\n                this.renderer.doTrippyY();\r\n                break;\r\n            case '+':\r\n                this.renderer.doXBlur();\r\n                this.renderer.doBlackout();\r\n                break;\r\n            case '¤':\r\n                this.renderer.doXBlur();\r\n                this.renderer.doBlackout(true);\r\n                break;\r\n            case '|':\r\n                this.renderer.doShortBlackout(this.getBeatLength());\r\n                this.randomColour();\r\n                break;\r\n            case ':':\r\n                this.randomColour();\r\n                break;\r\n            case '*':\r\n                if(this.settings.fullAuto) {\r\n                    this.randomImage();\r\n                }\r\n                break;\r\n            case '=':\r\n                if(this.settings.fullAuto) {\r\n                    this.randomImage();\r\n                }\r\n                /* falls through */\r\n            case '~':\r\n                this.renderer.doColourFade(this.timeToNextBeat());\r\n                this.randomColour(true);\r\n                break;\r\n            case 'S':\r\n            case 's':\r\n                this.renderer.doSlice(this.getBeatLength(), this.charsToNextBeat(), false, true);\r\n                break;\r\n            case 'V':\r\n            case 'v':\r\n                this.renderer.doSlice(this.getBeatLength(), this.charsToNextBeat(), true, false);\r\n                break;\r\n            case '@':\r\n            case '#':\r\n                this.renderer.doSlice(this.getBeatLength(), this.charsToNextBeat(), true, true);\r\n                break;\r\n            case 'I':\r\n                if (this.settings.fullAuto) {\r\n                    this.randomImage();\r\n                }\r\n                /* falls through */\r\n            case 'i':\r\n                this.toggleInvert();\r\n                break;\r\n            }\r\n            if ([\".\", \"+\", \"|\", \"¤\"].indexOf(beat) == -1) {\r\n                this.renderer.clearBlackout();\r\n            }\r\n            if([\".\", \"+\", \"¤\", \":\", \"*\", \"X\", \"O\", \"~\", \"=\", \"i\", \"I\", \"s\", \"v\", \"#\"].indexOf(beat) == -1) {\r\n                this.randomColour();\r\n                if (this.settings.fullAuto) {\r\n                    this.randomImage();\r\n                }\r\n        }\r\n    }\r\n\r\n\r\n    charsToNextBeat() {\r\n        // case: fade in build, not in rhythm. Must max out fade timer.\r\n        let maxSearch = this.currentSong.rhythm.length;\r\n        if(this.beatIndex < 0) {\r\n            maxSearch -= this.beatIndex;\r\n        }\r\n        let nextBeat;\r\n        for (nextBeat = 1; nextBeat <= maxSearch; nextBeat++) {\r\n            if (this.getBeat(nextBeat + this.beatIndex) != \".\") {\r\n                break;\r\n            }\r\n        }\r\n        return nextBeat;\r\n    }\r\n\r\n    timeToNextBeat() {\r\n        return (this.charsToNextBeat() * this.getBeatLength()) / this.soundManager.playbackRate;\r\n    }\r\n\r\n    getBeatString(length) {\r\n        length = length ? length : 256;\r\n\r\n        let beatString = \"\";\r\n        let song = this.currentSong;\r\n        if (song) {\r\n            if(this.beatIndex < 0) {\r\n                beatString = song.buildupRhythm.slice(\r\n                        song.buildupRhythm.length + this.beatIndex);\r\n            } else {\r\n                beatString = song.rhythm.slice(this.beatIndex % song.rhythm.length);\r\n            }\r\n            while (beatString.length < length) {\r\n                beatString += song.rhythm;\r\n            }\r\n        }\r\n\r\n        return beatString;\r\n    }\r\n\r\n    setIsFullAuto(auto) {\r\n        this.settings.fullAuto = auto;\r\n        if (this.userInterface) {\r\n            this.callEventListeners(\"newmode\", this.settings.fullAuto);\r\n        }\r\n    }\r\n\r\n    toggleFullAuto() {\r\n        this.setIsFullAuto(!this.settings.fullAuto);\r\n    }\r\n\r\n    setInvert(invert) {\r\n        this.invert = !!invert;\r\n        this.callEventListeners(\"invert\", invert);\r\n    }\r\n\r\n    toggleInvert() {\r\n        this.setInvert(!this.invert);\r\n    }\r\n\r\n    respackLoaded() {\r\n        this.init();\r\n    }\r\n\r\n    changeUI(index) {\r\n        if (index >= 0 && this.uiArray.length > index && this.userInterface != this.uiArray[index]) {\r\n            this.hideLists();\r\n            if(this.userInterface) {\r\n                this.userInterface.disconnect();\r\n            }\r\n            this.userInterface = this.uiArray[index];\r\n            this.userInterface.connectCore(this);\r\n            this.callEventListeners(\"newmode\", this.settings.fullAuto);\r\n            this.callEventListeners(\"newsong\", this.currentSong);\r\n            this.callEventListeners(\"newimage\", this.currentImage);\r\n            this.callEventListeners(\"newcolour\", this.colours[this.colourIndex], false);\r\n            this.callEventListeners(\"beat\", this.getBeatString(), this.getBeatIndex());\r\n            this.callEventListeners(\"invert\", this.invert);\r\n        }\r\n    }\r\n\r\n    settingsUpdated() {\r\n        this.callEventListeners(\"settingsupdated\");\r\n        switch (this.settings.currentUI) {\r\n        case \"retro\":\r\n            this.changeUI(0);\r\n            break;\r\n        case \"v4.20\":\r\n            this.changeUI(1);\r\n            break;\r\n        case \"modern\":\r\n            this.changeUI(2);\r\n            break;\r\n        case \"xmas\":\r\n            this.changeUI(3);\r\n            break;\r\n        case \"hlwn\":\r\n            this.changeUI(4);\r\n            break;\r\n        case \"mini\":\r\n            this.changeUI(5);\r\n            break;\r\n        }\r\n        switch (this.settings.colourSet) {\r\n        case \"normal\":\r\n            this.colours = HuesCore.oldColours;\r\n            break;\r\n        case \"pastel\":\r\n            this.colours = HuesCore.pastelColours;\r\n            break;\r\n        case \"v4.20\":\r\n            this.colours = HuesCore.weedColours;\r\n            break;\r\n        }\r\n        switch (this.settings.blackoutUI) {\r\n        case \"off\":\r\n            this.userInterface.show();\r\n            break;\r\n        case \"on\":\r\n            if(this.renderer.blackout) {\r\n                this.userInterface.hide();\r\n            }\r\n            break;\r\n        }\r\n        switch (this.settings.visualiser) {\r\n        case \"off\":\r\n            this.visualiser.classList.add(\"hidden\");\r\n            break;\r\n        case \"on\":\r\n            this.visualiser.classList.remove(\"hidden\");\r\n            if(!this.soundManager.vReady) {\r\n                this.soundManager.initVisualiser(this.visualiser.width/2);\r\n            }\r\n            break;\r\n        }\r\n        if (this.autoSong == \"off\" && this.settings.autoSong != \"off\") {\r\n            console.log(\"Resetting loopCount since AutoSong was enabled\");\r\n            this.loopCount = 0;\r\n        }\r\n        this.autoSong = this.settings.autoSong;\r\n    }\r\n\r\n    enabledChanged() {\r\n        this.resourceManager.rebuildEnabled();\r\n    }\r\n\r\n    hideLists() {\r\n        this.resourceManager.hideLists();\r\n    }\r\n\r\n    toggleSongList() {\r\n        this.window.hide();\r\n        this.resourceManager.toggleSongList();\r\n    }\r\n\r\n    toggleImageList() {\r\n        this.window.hide();\r\n        this.resourceManager.toggleImageList();\r\n    }\r\n\r\n    openSongSource() {\r\n        if (this.currentSong && this.currentSong.source) {\r\n            window.open(this.currentSong.source,'_blank');\r\n        }\r\n    }\r\n\r\n    openImageSource() {\r\n        if (this.currentImage && this.currentImage.source) {\r\n            window.open(this.currentImage.source,'_blank');\r\n        }\r\n    }\r\n\r\n    keyHandler(key) {\r\n        switch (key) {\r\n        case 37: // LEFT\r\n            this.previousImage();\r\n            break;\r\n        case 39: // RIGHT\r\n            this.nextImage();\r\n            break;\r\n        case 38: // UP\r\n            this.nextSong();\r\n            break;\r\n        case 40: // DOWN\r\n            this.previousSong();\r\n            break;\r\n        case 70: // F\r\n            this.toggleFullAuto();\r\n            break;\r\n        case 109: // NUMPAD_SUBTRACT\r\n        case 189: // MINUS\r\n        case 173: // MINUS, legacy\r\n            this.soundManager.decreaseVolume();\r\n            break;\r\n        case 107: // NUMPAD_ADD\r\n        case 187: // EQUAL\r\n        case 61: // EQUAL, legacy\r\n            this.soundManager.increaseVolume();\r\n            break;\r\n        case 66: // B\r\n            this.soundManager.seek(-this.soundManager.buildLength);\r\n            break;\r\n        case 77: // M\r\n            this.soundManager.toggleMute();\r\n            break;\r\n        case 72: // H\r\n            this.userInterface.toggleHide();\r\n            break;\r\n        case 82: // R\r\n            this.window.selectTab(\"RESOURCES\");\r\n            break;\r\n        case 69: // E\r\n            this.window.selectTab(\"EDITOR\");\r\n            break;\r\n        case 79: // O\r\n            this.window.selectTab(\"OPTIONS\");\r\n            break;\r\n        case 73: // I\r\n            this.window.selectTab(\"INFO\");\r\n            break;\r\n        case 49: // NUMBER_1\r\n            this.settings.set(\"currentUI\", \"retro\");\r\n            break;\r\n        case 50: // NUMBER_2\r\n            this.settings.set(\"currentUI\", \"v4.20\");\r\n            break;\r\n        case 51: // NUMBER_3\r\n            this.settings.set(\"currentUI\", \"modern\");\r\n            break;\r\n        case 52: // NUMBER_4\r\n            this.settings.set(\"currentUI\", \"xmas\");\r\n            break;\r\n        case 53: // NUMBER_5\r\n            this.settings.set(\"currentUI\", \"hlwn\");\r\n            break;\r\n        case 54: // NUMBER_6\r\n            this.settings.set(\"currentUI\", \"mini\");\r\n            break;\r\n        case 67: // C\r\n            this.toggleImageList();\r\n            break;\r\n        case 83: // S\r\n            this.toggleSongList();\r\n            break;\r\n        case 87: // W\r\n            this.window.toggle();\r\n            break;\r\n        case 78: // N\r\n            this.randomSong();\r\n            break;\r\n        default:\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    error(message) {\r\n        console.log(message);\r\n        this.preloadSubMsg.textContent = message;\r\n        this.preloadMsg.style.color = \"#F00\";\r\n    }\r\n\r\n    warning(message) {\r\n        console.log(message);\r\n        this.preloadSubMsg.innerHTML = message;\r\n        this.preloadMsg.style.color = \"#F93\";\r\n    }\r\n\r\n    clearMessage() {\r\n        this.preloadSubMsg.textContent = \"\";\r\n        this.preloadMsg.style.color = \"\";\r\n    }\r\n}\r\n\r\nHuesCore.oldColours =\r\n   [{'c': 0x000000, 'n': 'black'},\r\n    {'c': 0x550000, 'n': 'brick'},\r\n    {'c': 0xAA0000, 'n': 'crimson'},\r\n    {'c': 0xFF0000, 'n': 'red'},\r\n    {'c': 0x005500, 'n': 'turtle'},\r\n    {'c': 0x555500, 'n': 'sludge'},\r\n    {'c': 0xAA5500, 'n': 'brown'},\r\n    {'c': 0xFF5500, 'n': 'orange'},\r\n    {'c': 0x00AA00, 'n': 'green'},\r\n    {'c': 0x55AA00, 'n': 'grass'},\r\n    {'c': 0xAAAA00, 'n': 'maize'},\r\n    {'c': 0xFFAA00, 'n': 'citrus'},\r\n    {'c': 0x00FF00, 'n': 'lime'},\r\n    {'c': 0x55FF00, 'n': 'leaf'},\r\n    {'c': 0xAAFF00, 'n': 'chartreuse'},\r\n    {'c': 0xFFFF00, 'n': 'yellow'},\r\n    {'c': 0x000055, 'n': 'midnight'},\r\n    {'c': 0x550055, 'n': 'plum'},\r\n    {'c': 0xAA0055, 'n': 'pomegranate'},\r\n    {'c': 0xFF0055, 'n': 'rose'},\r\n    {'c': 0x005555, 'n': 'swamp'},\r\n    {'c': 0x555555, 'n': 'dust'},\r\n    {'c': 0xAA5555, 'n': 'dirt'},\r\n    {'c': 0xFF5555, 'n': 'blossom'},\r\n    {'c': 0x00AA55, 'n': 'sea'},\r\n    {'c': 0x55AA55, 'n': 'ill'},\r\n    {'c': 0xAAAA55, 'n': 'haze'},\r\n    {'c': 0xFFAA55, 'n': 'peach'},\r\n    {'c': 0x00FF55, 'n': 'spring'},\r\n    {'c': 0x55FF55, 'n': 'mantis'},\r\n    {'c': 0xAAFF55, 'n': 'brilliant'},\r\n    {'c': 0xFFFF55, 'n': 'canary'},\r\n    {'c': 0x0000AA, 'n': 'navy'},\r\n    {'c': 0x5500AA, 'n': 'grape'},\r\n    {'c': 0xAA00AA, 'n': 'mauve'},\r\n    {'c': 0xFF00AA, 'n': 'purple'},\r\n    {'c': 0x0055AA, 'n': 'cornflower'},\r\n    {'c': 0x5555AA, 'n': 'deep'},\r\n    {'c': 0xAA55AA, 'n': 'lilac'},\r\n    {'c': 0xFF55AA, 'n': 'lavender'},\r\n    {'c': 0x00AAAA, 'n': 'aqua'},\r\n    {'c': 0x55AAAA, 'n': 'steel'},\r\n    {'c': 0xAAAAAA, 'n': 'grey'},\r\n    {'c': 0xFFAAAA, 'n': 'pink'},\r\n    {'c': 0x00FFAA, 'n': 'bay'},\r\n    {'c': 0x55FFAA, 'n': 'marina'},\r\n    {'c': 0xAAFFAA, 'n': 'tornado'},\r\n    {'c': 0xFFFFAA, 'n': 'saltine'},\r\n    {'c': 0x0000FF, 'n': 'blue'},\r\n    {'c': 0x5500FF, 'n': 'twilight'},\r\n    {'c': 0xAA00FF, 'n': 'orchid'},\r\n    {'c': 0xFF00FF, 'n': 'magenta'},\r\n    {'c': 0x0055FF, 'n': 'azure'},\r\n    {'c': 0x5555FF, 'n': 'liberty'},\r\n    {'c': 0xAA55FF, 'n': 'royalty'},\r\n    {'c': 0xFF55FF, 'n': 'thistle'},\r\n    {'c': 0x00AAFF, 'n': 'ocean'},\r\n    {'c': 0x55AAFF, 'n': 'sky'},\r\n    {'c': 0xAAAAFF, 'n': 'periwinkle'},\r\n    {'c': 0xFFAAFF, 'n': 'carnation'},\r\n    {'c': 0x00FFFF, 'n': 'cyan'},\r\n    {'c': 0x55FFFF, 'n': 'turquoise'},\r\n    {'c': 0xAAFFFF, 'n': 'powder'},\r\n    {'c': 0xFFFFFF, 'n': 'white'}];\r\nHuesCore.pastelColours =\r\n   [{'c': 0xCD4A4A, 'n': 'Mahogany'},\r\n    {'c': 0xFAE7B5, 'n': 'Banana Mania'},\r\n    {'c': 0x9F8170, 'n': 'Beaver'},\r\n    {'c': 0x232323, 'n': 'Black'},\r\n    {'c': 0xBC5D58, 'n': 'Chestnut'},\r\n    {'c': 0xDD9475, 'n': 'Copper'},\r\n    {'c': 0x9ACEEB, 'n': 'Cornflower'},\r\n    {'c': 0x2B6CC4, 'n': 'Denim'},\r\n    {'c': 0xEFCDB8, 'n': 'Desert Sand'},\r\n    {'c': 0x6E5160, 'n': 'Eggplant'},\r\n    {'c': 0x1DF914, 'n': 'Electric Lime'},\r\n    {'c': 0x71BC78, 'n': 'Fern'},\r\n    {'c': 0xFCD975, 'n': 'Goldenrod'},\r\n    {'c': 0xA8E4A0, 'n': 'Granny Smith Apple'},\r\n    {'c': 0x95918C, 'n': 'Gray'},\r\n    {'c': 0x1CAC78, 'n': 'Green'},\r\n    {'c': 0xFF1DCE, 'n': 'Hot Magenta'},\r\n    {'c': 0xB2EC5D, 'n': 'Inch Worm'},\r\n    {'c': 0x5D76CB, 'n': 'Indigo'},\r\n    {'c': 0xFDFC74, 'n': 'Laser Lemon'},\r\n    {'c': 0xFCB4D5, 'n': 'Lavender'},\r\n    {'c': 0xFFBD88, 'n': 'Macaroni and Cheese'},\r\n    {'c': 0x979AAA, 'n': 'Manatee'},\r\n    {'c': 0xFF8243, 'n': 'Mango Tango'},\r\n    {'c': 0xFDBCB4, 'n': 'Melon'},\r\n    {'c': 0x1A4876, 'n': 'Midnight Blue'},\r\n    {'c': 0xFFA343, 'n': 'Neon Carrot'},\r\n    {'c': 0xBAB86C, 'n': 'Olive Green'},\r\n    {'c': 0xFF7538, 'n': 'Orange'},\r\n    {'c': 0xE6A8D7, 'n': 'Orchid'},\r\n    {'c': 0x414A4C, 'n': 'Outer Space'},\r\n    {'c': 0xFF6E4A, 'n': 'Outrageous Orange'},\r\n    {'c': 0x1CA9C9, 'n': 'Pacific Blue'},\r\n    {'c': 0xC5D0E6, 'n': 'Periwinkle'},\r\n    {'c': 0x8E4585, 'n': 'Plum'},\r\n    {'c': 0x7442C8, 'n': 'Purple Heart'},\r\n    {'c': 0xD68A59, 'n': 'Raw Sienna'},\r\n    {'c': 0xE3256B, 'n': 'Razzmatazz'},\r\n    {'c': 0xEE204D, 'n': 'Red'},\r\n    {'c': 0x1FCECB, 'n': 'Robin Egg Blue'},\r\n    {'c': 0x7851A9, 'n': 'Royal Purple'},\r\n    {'c': 0xFF9BAA, 'n': 'Salmon'},\r\n    {'c': 0xFC2847, 'n': 'Scarlet'},\r\n    {'c': 0x9FE2BF, 'n': 'Sea Green'},\r\n    {'c': 0xA5694F, 'n': 'Sepia'},\r\n    {'c': 0x8A795D, 'n': 'Shadow'},\r\n    {'c': 0x45CEA2, 'n': 'Shamrock'},\r\n    {'c': 0xFB7EFD, 'n': 'Shocking Pink'},\r\n    {'c': 0xECEABE, 'n': 'Spring Green'},\r\n    {'c': 0xFD5E53, 'n': 'Sunset Orange'},\r\n    {'c': 0xFAA76C, 'n': 'Tan'},\r\n    {'c': 0xFC89AC, 'n': 'Tickle Me Pink'},\r\n    {'c': 0xDBD7D2, 'n': 'Timberwolf'},\r\n    {'c': 0x17806D, 'n': 'Tropical Rain Forest'},\r\n    {'c': 0x77DDE7, 'n': 'Turquoise Blue'},\r\n    {'c': 0xFFA089, 'n': 'Vivid Tangerine'},\r\n    {'c': 0x8F509D, 'n': 'Vivid Violet'},\r\n    {'c': 0xEDEDED, 'n': 'White'},\r\n    {'c': 0xFF43A4, 'n': 'Wild Strawberry'},\r\n    {'c': 0xFC6C85, 'n': 'Wild Watermelon'},\r\n    {'c': 0xCDA4DE, 'n': 'Wisteria'},\r\n    {'c': 0xFCE883, 'n': 'Yellow'},\r\n    {'c': 0xC5E384, 'n': 'Yellow Green'},\r\n    {'c': 0xFFB653, 'n': 'Yellow Orange'}];\r\nHuesCore.weedColours =\r\n   [{'c': 0x00FF00, 'n': 'Green'},\r\n    {'c': 0x5A6351, 'n': 'Lizard'},\r\n    {'c': 0x636F57, 'n': 'Cactus'},\r\n    {'c': 0x4A7023, 'n': 'Kakapo'},\r\n    {'c': 0x3D5229, 'n': 'Wet Moss'},\r\n    {'c': 0x659D32, 'n': 'Tree Moss'},\r\n    {'c': 0x324F17, 'n': 'Lime Rind'},\r\n    {'c': 0x7F8778, 'n': 'Flight Jacket'},\r\n    {'c': 0xBCED91, 'n': 'Green Mist'},\r\n    {'c': 0x488214, 'n': 'Holly'},\r\n    {'c': 0x577A3A, 'n': 'Mtn Dew Bottle'},\r\n    {'c': 0x748269, 'n': 'Seaweed Roll'},\r\n    {'c': 0x83F52C, 'n': 'Neon Green'},\r\n    {'c': 0xC0D9AF, 'n': 'Lichen'},\r\n    {'c': 0xA6D785, 'n': 'Guacamole'},\r\n    {'c': 0x687E5A, 'n': 'Pond Scum'},\r\n    {'c': 0x3F602B, 'n': 'Douglas Fir'},\r\n    {'c': 0x3F6826, 'n': 'Royal Palm'},\r\n    {'c': 0x646F5E, 'n': 'Seaweed'},\r\n    {'c': 0x476A34, 'n': 'Noble Fir'},\r\n    {'c': 0x5DFC0A, 'n': 'Green Led'},\r\n    {'c': 0x435D36, 'n': 'Spinach'},\r\n    {'c': 0x84BE6A, 'n': 'Frog'},\r\n    {'c': 0x5B9C64, 'n': 'Emerald'},\r\n    {'c': 0x3A6629, 'n': 'Circuit Board'},\r\n    {'c': 0x308014, 'n': 'Sapgreen'},\r\n    {'c': 0x31B94D, 'n': 'Pool Table'},\r\n    {'c': 0x55AE3A, 'n': 'Leaf'},\r\n    {'c': 0x4DBD33, 'n': 'Grass'},\r\n    {'c': 0x596C56, 'n': 'Snake'},\r\n    {'c': 0x86C67C, 'n': '100 Euro'},\r\n    {'c': 0x7BCC70, 'n': 'Night Vision'},\r\n    {'c': 0xA020F0, 'n': 'Purple'},\r\n    {'c': 0x9B30FF, 'n': 'Purple'},\r\n    {'c': 0x912CEE, 'n': 'Purple'},\r\n    {'c': 0x7D26CD, 'n': 'Purple'},\r\n    {'c': 0xAA00FF, 'n': 'Purple'},\r\n    {'c': 0x800080, 'n': 'Purple'},\r\n    {'c': 0xA74CAB, 'n': 'Turnip'},\r\n    {'c': 0x8F5E99, 'n': 'Violet'},\r\n    {'c': 0x816687, 'n': 'Eggplant'},\r\n    {'c': 0xCC00FF, 'n': 'Grape'},\r\n    {'c': 0x820BBB, 'n': 'Wild Violet'},\r\n    {'c': 0x660198, 'n': 'Concord Grape'},\r\n    {'c': 0x71637D, 'n': 'Garden Plum'},\r\n    {'c': 0xB272A6, 'n': 'Purple Fish'},\r\n    {'c': 0x5C246E, 'n': 'Ultramarine Violet'},\r\n    {'c': 0x5E2D79, 'n': 'Purple Rose'},\r\n    {'c': 0x683A5E, 'n': 'Sea Urchin'},\r\n    {'c': 0x91219E, 'n': 'Cobalt Violet Deep'},\r\n    {'c': 0x8B668B, 'n': 'Plum'},\r\n    {'c': 0x9932CD, 'n': 'Dark Orchid'},\r\n    {'c': 0xBF5FFF, 'n': 'Violet Flower'},\r\n    {'c': 0xBDA0CB, 'n': 'Purple Candy'},\r\n    {'c': 0x551A8B, 'n': 'Deep Purple'},\r\n    {'c': 0xB5509C, 'n': 'Thistle'},\r\n    {'c': 0x871F78, 'n': 'Dark Purple'},\r\n    {'c': 0x9C6B98, 'n': 'Purple Ink'},\r\n    {'c': 0xDB70DB, 'n': 'Orchid'},\r\n    {'c': 0x990099, 'n': 'True Purple'},\r\n    {'c': 0x8B008B, 'n': 'Darkmagenta'},\r\n    {'c': 0xB62084, 'n': \"Harold's Crayon\"},\r\n    {'c': 0x694489, 'n': 'Purple Rain'},\r\n    {'c': 0xFFD700, 'n': 'Gold'}];\r\n\r\nwindow.HuesCore = HuesCore;\r\n\r\n})(window, document);","/* Copyright (c) William Toohey <will@mon.im>\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n(function(window, document) {\r\n\"use strict\";\r\n\r\nlet WAVE_PIXELS_PER_SECOND = 100;\r\nlet WAVE_HEIGHT_PIXELS = 20;\r\n\r\nclass HuesEditor {\r\n    constructor(core, huesWin) {\r\n        this.buildEditSize = 80; // pixels, including header\r\n        this.buildEdit = null;\r\n        this.loopEdit = null;\r\n        this.editArea = null;\r\n        this.wrapAt = 32;\r\n\r\n        this.hilightWidth = 0;\r\n        this.hilightHeight = 0;\r\n\r\n        this.undoBuffer = [];\r\n        this.redoBuffer = [];\r\n        // Will be an array if many actions are performed in one undo\r\n        this.batchUndoArray = null;\r\n\r\n        // For rendering the waveform\r\n        this.buildWave = null;\r\n        this.loopWave = null;\r\n        this.buildWaveBuff = null;\r\n        this.loopWaveBuff = null;\r\n        this.waveContext = null;\r\n        this.waveCanvas = null;\r\n\r\n        // for storing respacks created with \"new\"\r\n        this.respack = null;\r\n        // when we're actually following the playing song\r\n        this.linked = false;\r\n\r\n        this.core = core;\r\n        if(core.settings.enableWindow) {\r\n            this.initUI();\r\n            core.addEventListener(\"beat\", this.onBeat.bind(this));\r\n            core.addEventListener(\"newsong\", this.onNewSong.bind(this));\r\n            huesWin.addTab(\"EDITOR\", this.root);\r\n        }\r\n    }\r\n\r\n    initUI() {\r\n        this.root = document.createElement(\"div\");\r\n        this.root.className = \"editor\";\r\n        let titleButtons = document.createElement(\"div\");\r\n        titleButtons.className = \"editor__title-buttons\";\r\n        this.root.appendChild(titleButtons);\r\n        this.saveBtn = this.createButton(\"Save XML\", titleButtons, true);\r\n        this.saveBtn.addEventListener(\"click\", this.saveXML.bind(this));\r\n        this.copyBtn = this.createButton(\"Copy XML\", titleButtons, true);\r\n        this.copyBtn.addEventListener(\"click\", this.copyXML.bind(this));\r\n        this.undoBtn = this.createButton(\"Undo\", titleButtons, true);\r\n        this.undoBtn.addEventListener(\"click\", this.undo.bind(this));\r\n        this.redoBtn = this.createButton(\"Redo\", titleButtons, true);\r\n        this.redoBtn.addEventListener(\"click\", this.redo.bind(this));\r\n        let help = this.createButton(\"Help?\", titleButtons);\r\n        help.style.backgroundColor = \"rgba(0,160,0,0.3)\";\r\n        help.addEventListener(\"click\", () => {\r\n            window.open(\"https://github.com/mon/0x40-web/tree/master/docs/Editor.md\", '_blank');\r\n        });\r\n\r\n        this.statusMsg = document.createElement(\"span\");\r\n        this.statusMsg.className = \"editor__status-msg\";\r\n        titleButtons.appendChild(this.statusMsg);\r\n\r\n        this.topBar = document.createElement(\"div\");\r\n        this.topBar.className = \"editor__top-bar\";\r\n        this.root.appendChild(this.topBar);\r\n\r\n        this.uiCreateInfo();\r\n        this.uiCreateImport();\r\n        this.root.appendChild(document.createElement(\"hr\"));\r\n        this.uiCreateEditArea();\r\n        this.uiCreateControls();\r\n        this.uiCreateVisualiser();\r\n\r\n        document.addEventListener(\"keydown\", e => {\r\n            e = e || window.event;\r\n            if(e.defaultPrevented) {\r\n                return true;\r\n            }\r\n            let key = e.keyCode || e.which;\r\n\r\n            if (e.ctrlKey) {\r\n                if(key == 90) { // Z\r\n                    this.undo();\r\n                } else if(key == 89) { // Y\r\n                    this.redo();\r\n                }\r\n                if(key == 90 || key == 89) {\r\n                    e.preventDefault();\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n\r\n        window.addEventListener('resize', this.resize.bind(this));\r\n        // Fix Chrome rendering - redraw on tab load\r\n        // tabselected passes the name of the selected tab, we force noHilightCalc to false\r\n        this.core.window.addEventListener(\"tabselected\", this.resize.bind(this, false));\r\n        this.resize();\r\n    }\r\n\r\n    resize(noHilightCalc) {\r\n        this.root.style.height = (window.innerHeight - 200) + \"px\";\r\n        let boxHeight = this.editArea.offsetHeight;\r\n        let bHeadHeight = this.buildEdit._header.offsetHeight;\r\n        let lHeadHeight = this.loopEdit._header.offsetHeight;\r\n        let handleHeight = this.resizeHandle.offsetHeight;\r\n        let minHeight = bHeadHeight;\r\n        let maxHeight = boxHeight - handleHeight - lHeadHeight - bHeadHeight;\r\n        let buildHeight = Math.min(maxHeight, Math.max(minHeight, this.buildEditSize - handleHeight));\r\n        this.buildEdit.style.height = buildHeight + \"px\";\r\n        this.buildEdit._box.style.height = (buildHeight - bHeadHeight) + \"px\";\r\n        let loopHeight = maxHeight - buildHeight + lHeadHeight;\r\n        this.loopEdit.style.height = loopHeight + \"px\";\r\n        this.loopEdit._box.style.height = (loopHeight - lHeadHeight) + \"px\";\r\n\r\n        // For window resizing down situation\r\n        if(this.editArea.offsetHeight != boxHeight) {\r\n            this.resize();\r\n        }\r\n\r\n        // Resize the time lock\r\n        this.timeLock.style.height = (buildHeight + handleHeight) + \"px\";\r\n\r\n        // Save to fix Chrome rendering and to enable right click to seek\r\n        // We only resize on a window resize event, not when dragging the handle\r\n        if(!noHilightCalc) {\r\n            let hilight = document.createElement(\"div\");\r\n            hilight.className = \"beat-hilight\";\r\n            // Because clientWidth is rounded, we need to take the average. 100 is plenty.\r\n            let grid = \"\";\r\n            // height goes to 99 because we always have 1 line\r\n            for(let i = 0; i < 99; i++) {\r\n                grid += \"<br />\";\r\n            }\r\n            // width\r\n            for(let i = 0; i < 100; i++) {\r\n                grid += \"&nbsp;\";\r\n            }\r\n            hilight.innerHTML = grid;\r\n            this.loopEdit.appendChild(hilight);\r\n            this.hilightWidth = hilight.clientWidth / 100;\r\n            this.hilightHeight = hilight.clientHeight / 100;\r\n            this.loopEdit.removeChild(hilight);\r\n\r\n            this.waveCanvas.width = this.waveCanvas.clientWidth;\r\n        }\r\n    }\r\n\r\n    getOther(editor) {\r\n        return editor == this.loopEdit ? this.buildEdit : this.loopEdit;\r\n    }\r\n\r\n    onNewSong(song) {\r\n        if(this.linked) {\r\n            if(song == this.song) {\r\n                // Because you can \"edit current\" before it loads\r\n                this.updateInfo();\r\n                this.updateWaveform();\r\n            } else {\r\n                this.linked = false;\r\n                // Clear beat hilight\r\n                this.buildEdit._hilight.innerHTML = \"&block;\";\r\n                this.loopEdit._hilight.innerHTML = \"&block;\";\r\n                this.buildEdit._hilight.className = \"beat-hilight invisible\";\r\n                this.loopEdit._hilight.className = \"beat-hilight invisible\";\r\n                // Clear the waveform\r\n                this.waveContext.clearRect(0, 0, this.waveCanvas.width, WAVE_HEIGHT_PIXELS);\r\n            }\r\n        } else if(song == this.song) { // went to another song then came back\r\n            this.linked = true;\r\n        }\r\n    }\r\n\r\n    onBeat(map, index) {\r\n        if(!this.song || this.core.currentSong != this.song) {\r\n            return;\r\n        }\r\n        let editor;\r\n        if(index < 0) {\r\n            index += this.core.currentSong.buildupRhythm.length;\r\n            editor = this.buildEdit;\r\n            this.loopEdit._hilight.className = \"beat-hilight invisible\";\r\n        } else {\r\n            editor = this.loopEdit;\r\n            if(this.song.buildup) {\r\n                this.buildEdit._hilight.className = \"beat-hilight invisible\";\r\n            }\r\n        }\r\n        editor._hilight.className = \"beat-hilight\";\r\n        let offsetX = index % this.wrapAt;\r\n        let offsetY = Math.floor(index / this.wrapAt);\r\n        // Not computing width/height here due to Chrome bug\r\n        editor._hilight.style.left = Math.floor(offsetX * this.hilightWidth) + \"px\";\r\n        editor._hilight.style.top = Math.floor(offsetY * this.hilightHeight) + \"px\";\r\n    }\r\n\r\n    reflow(editor, map) {\r\n        if(!map) { // NOTHING TO SEE HERE\r\n            editor._beatmap.textContent = \"\";\r\n            editor._hilight.textContent = \"[none]\";\r\n            editor._hilight.className = \"beat-hilight\";\r\n            editor._hilight.style.top = \"0\";\r\n            editor._hilight.style.left = \"0\";\r\n            editor._beatCount.textContent = \"0 beats\";\r\n            return;\r\n        } else {\r\n            editor._hilight.innerHTML = \"&block;\";\r\n        }\r\n        editor._beatCount.textContent = map.length + \" beats\";\r\n        // http://stackoverflow.com/a/27012001\r\n        // if it's too long to wrap, scroll in the x direction\r\n        let regex = new RegExp(\"(.{\" + this.wrapAt + \"})\", \"g\");\r\n        editor._beatmap.innerHTML = map.replace(regex, \"$1<br />\");\r\n    }\r\n\r\n    updateInfo() {\r\n        // Avoid a bunch of nested elses\r\n        this.seekStart.classList.add(\"hues-button--disabled\");\r\n        this.seekLoop.classList.add(\"hues-button--disabled\");\r\n        this.saveBtn.classList.add(\"hues-button--disabled\");\r\n        this.copyBtn.classList.add(\"hues-button--disabled\");\r\n        this.buildEdit._removeBtn.classList.add(\"hues-button--disabled\");\r\n        this.loopEdit._removeBtn.classList.add(\"hues-button--disabled\");\r\n\r\n        if(!this.song) {\r\n            return;\r\n        }\r\n\r\n        this.saveBtn.classList.remove(\"hues-button--disabled\");\r\n        this.copyBtn.classList.remove(\"hues-button--disabled\");\r\n\r\n        if(this.song.independentBuild) {\r\n            this.timeLock._locker.innerHTML = \"&#xe904;\";\r\n            this.timeLock.classList.add(\"edit-area__timelock--unlocked\");\r\n        } else {\r\n            this.timeLock._locker.innerHTML = \"&#xe905;\";\r\n            this.timeLock.classList.remove(\"edit-area__timelock--unlocked\");\r\n        }\r\n        if(this.song.sound) {\r\n            this.seekLoop.classList.remove(\"hues-button--disabled\");\r\n            this.loopEdit._removeBtn.classList.remove(\"hues-button--disabled\");\r\n        }\r\n        if(this.song.buildup) {\r\n            this.seekStart.classList.remove(\"hues-button--disabled\");\r\n            this.buildEdit._removeBtn.classList.remove(\"hues-button--disabled\");\r\n        }\r\n\r\n        if(!this.linked) {\r\n            return;\r\n        }\r\n\r\n        let loopLen = this.core.soundManager.loopLength;\r\n        let buildLen = this.core.soundManager.buildLength;\r\n        let beatLen = (loopLen / this.song.rhythm.length) * 1000;\r\n\r\n        this.loopLen.textContent = loopLen.toFixed(2);\r\n        this.buildLen.textContent = buildLen.toFixed(2);\r\n        this.beatLen.textContent = beatLen.toFixed(2);\r\n    }\r\n\r\n    loadAudio(editor) {\r\n        if(editor._fileInput.files.length < 1) {\r\n            return;\r\n        }\r\n        // If first load, this makes fresh, gets the core synced up\r\n        this.newSong(this.song);\r\n\r\n        // Have we just added a build to a song with a rhythm, or vice versa?\r\n        // If so, link their lengths\r\n        let newlyLinked = !this.song[editor._sound] && !!this.song[this.getOther(editor)._sound];\r\n\r\n        // Disable load button TODO\r\n        let file = editor._fileInput.files[0];\r\n\r\n        // load audio\r\n        this.blobToArrayBuffer(file)\r\n        .then(buffer => {\r\n            // Is this buffer even decodable?\r\n            let testSong = {test: buffer};\r\n            return this.core.soundManager.loadBuffer(testSong, \"test\")\r\n                   // keep the buffer moving through the chain\r\n                   // remember it's been passed through to a worker, so we update the reference\r\n                   .then(() => {\r\n                       return testSong.test;\r\n                   });\r\n        }).then(buffer => {\r\n            this.song[editor._sound] = buffer;\r\n            // Save filename for XML export\r\n            let noExt = file.name.replace(/\\.[^/.]+$/, \"\");\r\n            if(editor._sound == \"sound\") {\r\n                this.song.name = noExt;\r\n            } else {\r\n                this.song.buildupName = noExt;\r\n            }\r\n            // make empty map if needed\r\n            if(!this.getText(editor)) {\r\n                this.setText(editor, \"x...o...x...o...\");\r\n            }\r\n            // Do we have a loop to play?\r\n            if(this.song.sound) {\r\n                // Force refresh\r\n                return this.core.soundManager.playSong(this.song, true, true);\r\n            }\r\n        }).then(() => {\r\n            if(newlyLinked) {\r\n                this.setIndependentBuild(false);\r\n            }\r\n            this.updateInfo();\r\n            this.core.updateBeatLength();\r\n            // We may have to go backwards in time\r\n            this.core.recalcBeatIndex();\r\n            this.updateWaveform();\r\n        }).catch(error => {\r\n            console.log(error);\r\n            this.alert(\"Couldn't load song! Is it a LAME encoded MP3?\");\r\n        });\r\n    }\r\n\r\n    removeAudio(editor) {\r\n        if(!this.song) {\r\n            return;\r\n        }\r\n\r\n        this.song[editor._sound] = null;\r\n        this.song[editor._rhythm] = \"\";\r\n        this.setIndependentBuild(true);\r\n        this.reflow(editor, \"\");\r\n        // Is the loop playable?\r\n        if(this.song.sound && this.linked) {\r\n            this.core.soundManager.playSong(this.song, true, true)\r\n            .then(() => {\r\n                this.updateWaveform();\r\n            });\r\n        } else {\r\n            this.core.soundManager.stop();\r\n            this.updateWaveform();\r\n        }\r\n        this.updateInfo();\r\n        this.updateHalveDoubleButtons(editor);\r\n    }\r\n\r\n    blobToArrayBuffer(blob) {\r\n        return new Promise((resolve, reject) => {\r\n            let fr = new FileReader();\r\n            fr.onload = () => {\r\n                resolve(fr.result);\r\n            };\r\n            fr.onerror = () => {\r\n                reject(new Error(\"File read failed!\"));\r\n            };\r\n            fr.readAsArrayBuffer(blob);\r\n        });\r\n    }\r\n\r\n    newSong(song) {\r\n        if(!song) {\r\n            song = {\"name\":\"Name\",\r\n               \"title\":\"Title\",\r\n               \"rhythm\":\"\",\r\n               \"source\":\"\",\r\n               \"sound\":null,\r\n               \"enabled\":true,\r\n               \"filename\":null,\r\n               \"charsPerBeat\": null,\r\n               // Because new songs are empty\r\n               \"independentBuild\": true};\r\n           if(!this.respack) {\r\n               this.respack = new Respack();\r\n               this.respack.name = \"Editor Respack\";\r\n               this.respack.author = \"You!\";\r\n               this.respack.description = \"An internal resourcepack for editing new songs\";\r\n               this.core.resourceManager.addPack(this.respack);\r\n           }\r\n           this.respack.songs.push(song);\r\n           this.core.resourceManager.rebuildArrays();\r\n           this.core.resourceManager.rebuildEnabled();\r\n           this.core.setSongOject(song);\r\n        }\r\n        // Clear instructions\r\n        this.buildEdit._hilight.className = \"beat-hilight invisible\";\r\n        this.loopEdit._hilight.className = \"beat-hilight invisible\";\r\n\r\n        // Clear helpful glows\r\n        this.newSongBtn.classList.remove(\"hues-button--glow\");\r\n        this.fromSongBtn.classList.remove(\"hues-button--glow\");\r\n\r\n        // Enable title edits\r\n        this.title.disabled = false;\r\n        this.source.disabled = false;\r\n\r\n        this.clearUndoRedo();\r\n\r\n        this.song = song;\r\n        this.reflow(this.buildEdit, song.buildupRhythm);\r\n        this.reflow(this.loopEdit, song.rhythm);\r\n        this.title.value = song.title;\r\n        this.source.value = song.source;\r\n\r\n        // Force independent build if only 1 source is present\r\n        this.updateIndependentBuild();\r\n\r\n        // Unlock beatmap lengths\r\n        this.setLocked(this.buildEdit, 0);\r\n        this.setLocked(this.loopEdit, 0);\r\n\r\n        this.linked = true;\r\n        this.updateInfo();\r\n        this.updateWaveform();\r\n    }\r\n\r\n    updateIndependentBuild() {\r\n        // Force independent build if only 1 source is present\r\n\r\n        // Effectively buildup XOR loop - does only 1 exist?\r\n        let hasBuild = !!this.song.buildup;\r\n        let hasLoop = !!this.song.sound;\r\n        if(hasBuild != hasLoop) {\r\n            this.setIndependentBuild(true);\r\n        }\r\n    }\r\n\r\n    setIndependentBuild(indep) {\r\n        this.song.independentBuild = indep;\r\n        if(!indep) {\r\n            // If both are locked, we lock the result, otherwise unlock both\r\n            let lock = this.loopEdit._locked && this.buildEdit._locked;\r\n            // Then unlock both so text adjustment can occur\r\n            this.loopEdit._locked = 0;\r\n            this.buildEdit._locked = 0;\r\n            // Correct the lengths\r\n            this.setText(this.loopEdit, this.getText(this.loopEdit));\r\n            // Restore locked state\r\n            if(lock) {\r\n                this.loopEdit._locked = this.song.rhythm.length;\r\n                this.buildEdit._locked = this.song.buildupRhythm.length;\r\n            }\r\n        }\r\n        this.updateInfo();\r\n    }\r\n\r\n    batchUndo() {\r\n        if(!this.batchUndoArray)\r\n            this.batchUndoArray = [];\r\n    }\r\n\r\n    commitUndo() {\r\n        if(this.batchUndoArray) {\r\n            this.undoBuffer.push(this.batchUndoArray);\r\n            this.trimUndo();\r\n            this.batchUndoArray = null;\r\n            this.updateUndoUI();\r\n        }\r\n    }\r\n\r\n    pushUndo(name, editor, oldText, newText) {\r\n        if(oldText == newText) {\r\n            return;\r\n        }\r\n        this.redoBuffer = [];\r\n\r\n        let undoObj = {songVar: name,\r\n                       editor: editor,\r\n                       text: oldText,\r\n                       indep: this.song.independentBuild};\r\n        if(this.batchUndoArray) {\r\n            this.batchUndoArray.push(undoObj);\r\n        } else {\r\n            // 1 element array so undoRedo is neater\r\n            this.undoBuffer.push([undoObj]);\r\n            this.trimUndo();\r\n        }\r\n        this.updateUndoUI();\r\n    }\r\n\r\n    trimUndo() {\r\n        while(this.undoBuffer.length > 50) {\r\n            this.undoBuffer.shift();\r\n        }\r\n    }\r\n\r\n    undo() {\r\n        this.undoRedo(this.undoBuffer, this.redoBuffer);\r\n    }\r\n\r\n    redo() {\r\n        this.undoRedo(this.redoBuffer, this.undoBuffer);\r\n    }\r\n\r\n    undoRedo(from, to) {\r\n        if(from.length === 0 || !this.song) {\r\n            return;\r\n        }\r\n        // Remove old data\r\n        let fromArray = from.pop();\r\n        let toArray = [];\r\n        for(let i = 0; i < fromArray.length; i++) {\r\n            let fromData = fromArray[i];\r\n            // Make restore from current\r\n            toArray.push({songVar: fromData.songVar,\r\n                          editor: fromData.editor,\r\n                          text: this.song[fromData.songVar],\r\n                          indep: this.song.independentBuild});\r\n            // Restore to editor\r\n            this.song[fromData.songVar] = fromData.text;\r\n            this.song.independentBuild = fromData.indep;\r\n            // Don't have weird behaviour there\r\n            if(fromData.editor._locked) {\r\n                fromData.editor._locked = fromData.text.length;\r\n            }\r\n            this.reflow(fromData.editor, this.song[fromData.songVar]);\r\n            this.updateHalveDoubleButtons(fromData.editor);\r\n        }\r\n        to.push(toArray);\r\n        this.updateUndoUI();\r\n        this.updateInfo();\r\n        this.core.updateBeatLength();\r\n        this.core.recalcBeatIndex();\r\n    }\r\n\r\n    clearUndoRedo() {\r\n        this.undoBuffer = [];\r\n        this.redoBuffer = [];\r\n        this.updateUndoUI();\r\n    }\r\n\r\n    updateUndoUI() {\r\n        this.undoBtn.className = \"hues-button hues-button--disabled\";\r\n        this.redoBtn.className = \"hues-button hues-button--disabled\";\r\n\r\n        if(this.undoBuffer.length > 0) {\r\n            this.undoBtn.classList.remove(\"hues-button--disabled\");\r\n        }\r\n        if(this.redoBuffer.length > 0) {\r\n            this.redoBtn.classList.remove(\"hues-button--disabled\");\r\n        }\r\n    }\r\n\r\n    halveBeats(editor) {\r\n        let commit = false;\r\n        if(!this.song.independentBuild) {\r\n            commit = true;\r\n            this.batchUndo();\r\n            // halve them both\r\n            let other = this.getOther(editor);\r\n            this.song.independentBuild = true;\r\n            this.halveBeats(other);\r\n        }\r\n        this.setText(editor, this.song[editor._rhythm].replace(/(.)./g, \"$1\"));\r\n        if(commit) {\r\n            this.commitUndo();\r\n            // We set it so any rounding is padded\r\n            this.setIndependentBuild(false);\r\n        }\r\n    }\r\n\r\n    doubleBeats(editor) {\r\n        let commit = false;\r\n        if(!this.song.independentBuild) {\r\n            commit = true;\r\n            this.batchUndo();\r\n            // Double them both\r\n            let other = this.getOther(editor);\r\n            this.song.independentBuild = true;\r\n            this.doubleBeats(other);\r\n        }\r\n        this.setText(editor, this.song[editor._rhythm].replace(/(.)/g, \"$1.\"));\r\n        if(commit) {\r\n            this.commitUndo();\r\n            // We set it so any rounding is padded\r\n            this.setIndependentBuild(false);\r\n        }\r\n    }\r\n\r\n    updateHalveDoubleButtons(editor) {\r\n        editor._halveBtn.className = \"hues-button hues-button--disabled\";\r\n        editor._doubleBtn.className = \"hues-button hues-button--disabled\";\r\n\r\n        if(!editor._locked) {\r\n            let txtLen = this.getText(editor).length;\r\n            if(!this.song.independentBuild) {\r\n                let other = this.getOther(editor);\r\n                txtLen = Math.min(txtLen, this.getText(other).length);\r\n            }\r\n            if(txtLen > 0) {\r\n                editor._doubleBtn.className = \"hues-button\";\r\n            }\r\n            if(txtLen > 1) {\r\n                editor._halveBtn.className = \"hues-button\";\r\n            }\r\n        }\r\n    }\r\n\r\n    createTextInput(label, subtitle, parent) {\r\n        let div = document.createElement(\"div\");\r\n        div.className = \"editor__label\";\r\n        let caption = document.createElement(\"label\");\r\n        caption.innerHTML = label;\r\n        div.appendChild(caption);\r\n        let container = document.createElement(\"span\");\r\n        container.className = \"editor__textinput-container\";\r\n        let input = document.createElement(\"input\");\r\n        input.className = \"editor__textinput\";\r\n        input.type = \"text\";\r\n        input.value = subtitle;\r\n        container.appendChild(input);\r\n        div.appendChild(container);\r\n\r\n        parent.appendChild(div);\r\n\r\n        return input;\r\n    }\r\n\r\n    createButton(label, parent, disabled, extraClass) {\r\n        let button = document.createElement(\"span\");\r\n        button.className = \"hues-button\";\r\n        if(disabled) {\r\n            button.classList.add(\"hues-button--disabled\");\r\n        }\r\n        if(extraClass) {\r\n            button.className += \" \" + extraClass;\r\n        }\r\n        // Automagically make disabled buttons ignore clicks\r\n        button.addEventListener(\"click\", event => {\r\n            if(button.classList.contains(\"hues-button--disabled\")) {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                event.stopImmediatePropagation();\r\n                return false;\r\n            } else {\r\n                return true;\r\n            }\r\n        });\r\n        button.innerHTML = label.toUpperCase();\r\n        parent.appendChild(button);\r\n        return button;\r\n    }\r\n\r\n    uiCreateInfo() {\r\n        let info = document.createElement(\"div\");\r\n        this.topBar.appendChild(info);\r\n        info.className = \"editor__info\";\r\n\r\n        let songUpdate = function(name) {\r\n            if(!this.song ) {\r\n                return;\r\n            }\r\n            this.song[name] = this[name].value;\r\n            if(this.song != this.core.currentSong) {\r\n                return;\r\n            }\r\n            this.core.callEventListeners(\"newsong\", this.song);\r\n        };\r\n\r\n        this.title = this.createTextInput(\"Title:\", \"Song name\", info);\r\n        this.title.oninput = songUpdate.bind(this, \"title\");\r\n        this.title.disabled = true;\r\n        this.source = this.createTextInput(\"Link:&nbsp;\", \"Source link\", info);\r\n        this.source.oninput = songUpdate.bind(this, \"source\");\r\n        this.source.disabled = true;\r\n    }\r\n\r\n    uiCreateImport() {\r\n        let imports = document.createElement(\"div\");\r\n        this.topBar.appendChild(imports);\r\n        imports.className = \"editor__imports\";\r\n\r\n        let songEdits = document.createElement(\"div\");\r\n        imports.appendChild(songEdits);\r\n        let newSongBtn = this.createButton(\"New song\", songEdits, false, \"hues-button--glow\");\r\n        newSongBtn.addEventListener(\"click\", () => {\r\n            this.newSong();\r\n        });\r\n        this.newSongBtn = newSongBtn;\r\n        let fromSong = this.createButton(\"Edit current song\", songEdits, false, \"hues-button--glow\");\r\n        fromSong.addEventListener(\"click\", () => {\r\n            if(this.core.currentSong) {\r\n                this.newSong(this.core.currentSong);\r\n            }\r\n        });\r\n        this.fromSongBtn = fromSong;\r\n\r\n        let songInfos = document.createElement(\"div\");\r\n        songInfos.className = \"settings-individual editor__song-stats\";\r\n        imports.appendChild(songInfos);\r\n\r\n        this.loopLen = this.uiCreateSongStat(\"Loop length (s):\", \"0.00\", songInfos);\r\n        this.buildLen = this.uiCreateSongStat(\"Build length (s):\", \"0.00\", songInfos);\r\n        this.beatLen = this.uiCreateSongStat(\"Beat length (ms):\", \"0.00\", songInfos);\r\n    }\r\n\r\n    uiCreateSongStat(name, value, parent) {\r\n        let container = document.createElement(\"div\");\r\n        parent.appendChild(container);\r\n        let label = document.createElement(\"span\");\r\n        label.textContent = name;\r\n        container.appendChild(label);\r\n        let valueSpan = document.createElement(\"span\");\r\n        valueSpan.textContent = value;\r\n        valueSpan.className = \"editor__song-stats__value\";\r\n        container.appendChild(valueSpan);\r\n        return valueSpan;\r\n    }\r\n\r\n    uiCreateEditArea() {\r\n        let editArea = document.createElement(\"div\");\r\n        this.editArea = editArea;\r\n        editArea.className = \"edit-area\";\r\n        this.root.appendChild(editArea);\r\n\r\n        // Lock build/loop lengths\r\n        this.timeLock = document.createElement(\"div\");\r\n        editArea.appendChild(this.timeLock);\r\n        this.timeLock.className = \"hues-icon edit-area__timelock edit-area__timelock--unlocked\";\r\n        // CHAIN-BROKEN, use &#xe905; for CHAIN\r\n        let locker = this.createButton(\"&#xe904;\", this.timeLock);\r\n        locker.addEventListener(\"click\", () => {\r\n            // Only allow if both song bits exist\r\n            if(!this.song || !this.song.buildup || !this.song.sound) {\r\n                return;\r\n            }\r\n            this.setIndependentBuild(!this.song.independentBuild);\r\n        });\r\n        this.timeLock._locker = locker;\r\n\r\n        this.buildEdit = this.uiCreateSingleEditor(\"Buildup\", \"buildup\", \"buildupRhythm\", editArea);\r\n        this.seekStart = this.buildEdit._seek;\r\n        // FIRST |<<\r\n        this.seekStart.innerHTML = \"&#xe90b;\";\r\n        this.seekStart.addEventListener(\"click\", () => {\r\n            this.core.soundManager.seek(-this.core.soundManager.buildLength);\r\n        });\r\n\r\n        // drag handle\r\n        let handleContainer = document.createElement(\"div\");\r\n        handleContainer.className = \"resize-handle\";\r\n        editArea.appendChild(handleContainer);\r\n        let handle = document.createElement(\"div\");\r\n        handle.className = 'hues-icon resize-handle__handle';\r\n        handle.innerHTML = \"&#xe908;\"; // DRAG HANDLE\r\n        handleContainer.appendChild(handle);\r\n        this.resizeHandle = handleContainer;\r\n\r\n        handleContainer.addEventListener(\"mousedown\", (e) => {\r\n            e.preventDefault();\r\n            let editTop = this.editArea.getBoundingClientRect().top;\r\n            let handleSize = this.resizeHandle.clientHeight;\r\n\r\n            let resizer = (e) => {\r\n                this.buildEditSize = Math.floor(e.clientY - editTop + handleSize/2);\r\n                this.resize(true);\r\n            };\r\n\r\n            let mouseup = function(e) {\r\n                document.removeEventListener(\"mousemove\", resizer);\r\n                document.removeEventListener(\"mouseup\", mouseup);\r\n            };\r\n\r\n            document.addEventListener(\"mousemove\", resizer);\r\n            document.addEventListener(\"mouseup\", mouseup);\r\n        });\r\n\r\n        this.loopEdit = this.uiCreateSingleEditor(\"Rhythm&nbsp;\", \"sound\", \"rhythm\", editArea);\r\n        this.seekLoop = this.loopEdit._seek;\r\n        // FIRST |<<\r\n        this.seekLoop.innerHTML = \"&#xe90b;\";\r\n        this.seekLoop.addEventListener(\"click\", () => {\r\n            this.core.soundManager.seek(0);\r\n        });\r\n\r\n        this.buildEdit._hilight.textContent = \"[none]\";\r\n        this.loopEdit._hilight.innerHTML =\r\n            '<br />' +\r\n             'Click [LOAD RHYTHM] to load a loop! LAME encoded MP3s work best.<br />' +\r\n             '(LAME is important for seamless MP3 loops)<br />' +\r\n             '<br />' +\r\n             '[DOUBLE] doubles the selected map length by padding it with \".\"s.<br />' +\r\n             '[HALVE] shortens the map length by removing every other character.<br />' +\r\n             '<br />' +\r\n             'You can also add a buildup with [LOAD BUILDUP], or remove it<br />' +\r\n             'with [REMOVE].<br />' +\r\n             '<br />' +\r\n             '[NEW SONG] adds a completely empty song for you to edit, and<br />' +\r\n             '[EDIT CURRENT SONG] takes the current playing song to the editor.<br />' +\r\n             '<br />' +\r\n             '[COPY/SAVE XML] allow for storing the rhythms and easy <br />' +\r\n             'inclusion into a Resource Pack!';\r\n    }\r\n\r\n    uiCreateSingleEditor(title, soundName, rhythmName, parent) {\r\n        let container = document.createElement(\"div\");\r\n        parent.appendChild(container);\r\n\r\n        let header = document.createElement(\"div\");\r\n        header.className = \"edit-area__header\";\r\n        container.appendChild(header);\r\n\r\n        let nameLabel = document.createElement(\"span\");\r\n        header.appendChild(nameLabel);\r\n        nameLabel.innerHTML = title;\r\n\r\n        let seek = this.createButton(\"\", header, true, \"hues-icon\");\r\n        header.appendChild(seek);\r\n        container._seek = seek;\r\n\r\n        let beatCount = document.createElement(\"span\");\r\n        header.appendChild(beatCount);\r\n        beatCount.className = \"edit-area__beat-count\";\r\n        beatCount.textContent = \"0 beats\";\r\n        container._lockedBtn = this.createButton(\"&#xe907;\", header, false, \"hues-icon\");\r\n        container._lockedBtn.addEventListener(\"click\", () => {\r\n            if(container._locked) {\r\n                this.setLocked(container, 0);\r\n            } else {\r\n                let textLen = this.getText(container).length;\r\n                this.setLocked(container, textLen);\r\n            }\r\n        });\r\n\r\n        let rightHeader = document.createElement(\"span\");\r\n        rightHeader.className = \"edit-area__header__right\";\r\n        header.appendChild(rightHeader);\r\n\r\n        container._halveBtn = this.createButton(\"Halve\", rightHeader, true);\r\n        container._halveBtn.addEventListener(\"click\", this.halveBeats.bind(this, container));\r\n        container._doubleBtn = this.createButton(\"Double\", rightHeader, true);\r\n        container._doubleBtn.addEventListener(\"click\", this.doubleBeats.bind(this, container));\r\n\r\n        let fileInput = document.createElement(\"input\");\r\n        fileInput.type =\"file\";\r\n        fileInput.accept=\".mp3, .wav, .ogg\";\r\n        fileInput.multiple = false;\r\n        fileInput.onchange = this.loadAudio.bind(this, container);\r\n        let load = this.createButton(\"Load \" + title.replace(/&nbsp;/g,\"\"), rightHeader);\r\n        load.addEventListener(\"click\", () => {fileInput.click();});\r\n\r\n        container._removeBtn = this.createButton(\"Remove\", rightHeader, true);\r\n        container._removeBtn.addEventListener(\"click\", this.removeAudio.bind(this, container));\r\n\r\n        let editBox = document.createElement(\"div\");\r\n        editBox.className = \"edit-area__box\";\r\n        let beatmap = document.createElement(\"div\");\r\n        beatmap.className = \"edit-area__beatmap\";\r\n        beatmap.contentEditable = true;\r\n        beatmap.spellcheck = false;\r\n        beatmap.oninput = this.textUpdated.bind(this, container);\r\n        beatmap.oncontextmenu = this.rightClick.bind(this, container);\r\n\r\n        let beatHilight = document.createElement(\"div\");\r\n        beatHilight.className = \"beat-hilight\";\r\n\r\n        editBox.appendChild(beatHilight);\r\n        editBox.appendChild(beatmap);\r\n        container.appendChild(editBox);\r\n\r\n        container._header = header;\r\n        container._beatCount = beatCount;\r\n        container._box = editBox;\r\n        container._beatmap = beatmap;\r\n        container._hilight = beatHilight;\r\n        container._fileInput = fileInput;\r\n\r\n        container._sound = soundName;\r\n        container._rhythm = rhythmName;\r\n\r\n        // Are we in insert mode? Default = no\r\n        container._locked = 0;\r\n\r\n        return container;\r\n    }\r\n\r\n    uiCreateControls() {\r\n        let controls = document.createElement(\"div\");\r\n        controls.className = \"edit__controls\";\r\n        this.root.appendChild(controls);\r\n\r\n        let changeRate = function(change) {\r\n            let rate = this.core.soundManager.playbackRate;\r\n            rate += change;\r\n            this.core.soundManager.setRate(rate);\r\n            // In case it gets clamped, check\r\n            let newRate = this.core.soundManager.playbackRate;\r\n            playRateLab.textContent = newRate.toFixed(2) + \"x\";\r\n        };\r\n\r\n        let speedControl = document.createElement(\"div\");\r\n        controls.appendChild(speedControl);\r\n\r\n        // BACKWARD\r\n        let speedDown = this.createButton(\"&#xe909;\", speedControl, false, \"hues-icon\");\r\n        speedDown.addEventListener(\"click\", changeRate.bind(this, -0.25));\r\n        // FORWARD\r\n        let speedUp = this.createButton(\"&#xe90a;\", speedControl, false, \"hues-icon\");\r\n        speedUp.addEventListener(\"click\", changeRate.bind(this, 0.25));\r\n\r\n        let playRateLab = document.createElement(\"span\");\r\n        playRateLab.className = \"settings-individual\";\r\n        playRateLab.textContent = \"1.00x\";\r\n        speedControl.appendChild(playRateLab);\r\n\r\n        let wrapControl = document.createElement(\"div\");\r\n        controls.appendChild(wrapControl);\r\n\r\n        let wrapLab = document.createElement(\"span\");\r\n        wrapLab.className = \"settings-individual\";\r\n        wrapLab.textContent = \"New line at beat \";\r\n        wrapControl.appendChild(wrapLab);\r\n\r\n        let wrapAt = document.createElement(\"input\");\r\n        wrapAt.className = \"settings-input\";\r\n        wrapAt.value = this.wrapAt;\r\n        wrapAt.type = \"text\";\r\n        wrapAt.oninput = () => {\r\n            wrapAt.value = wrapAt.value.replace(/\\D/g,'');\r\n            if(wrapAt.value === \"\" || wrapAt.value < 1) {\r\n                wrapAt.value = \"\";\r\n                return;\r\n            }\r\n            this.wrapAt = parseInt(wrapAt.value);\r\n            this.reflow(this.buildEdit, this.song.buildupRhythm);\r\n            this.reflow(this.loopEdit, this.song.rhythm);\r\n\r\n        };\r\n        wrapControl.appendChild(wrapAt);\r\n    }\r\n\r\n    uiCreateVisualiser() {\r\n        let wave = document.createElement(\"canvas\");\r\n        wave.className = \"waveform\";\r\n        wave.height = WAVE_HEIGHT_PIXELS;\r\n        this.root.appendChild(wave);\r\n        this.waveCanvas = wave;\r\n        this.waveContext = wave.getContext(\"2d\");\r\n\r\n        this.core.addEventListener(\"frame\", this.drawWave.bind(this));\r\n    }\r\n\r\n    rightClick(editor, event) {\r\n        if(!this.linked) {\r\n            return;\r\n        }\r\n        // If the right click is also a focus event, caret doesn't move, so we have to use coords\r\n        let coords = this.getTextCoords(event);\r\n\r\n        if(coords.x > this.wrapAt)\r\n            return true;\r\n\r\n        let caret = coords.y * this.wrapAt + coords.x;\r\n        let totalLen = this.getText(editor).length;\r\n        if(caret > totalLen)\r\n            return true;\r\n\r\n        // in case of focus event\r\n        this.setCaret(editor._beatmap, caret);\r\n        let percent = caret / totalLen;\r\n        let seekTime = 0;\r\n        if(editor == this.loopEdit) { // loop\r\n            seekTime = this.core.soundManager.loopLength * percent;\r\n        } else { // build\r\n            let bLen = this.core.soundManager.buildLength;\r\n            seekTime = -bLen + bLen * percent;\r\n        }\r\n        this.core.soundManager.seek(seekTime);\r\n\r\n        event.preventDefault();\r\n        return false;\r\n    }\r\n\r\n    getTextCoords(event) {\r\n        // http://stackoverflow.com/a/10816667\r\n        let el = event.target,\r\n            x = 0,\r\n            y = 0;\r\n\r\n        while (el && !isNaN(el.offsetLeft) && !isNaN(el.offsetTop)) {\r\n            x += el.offsetLeft - el.scrollLeft;\r\n            y += el.offsetTop - el.scrollTop;\r\n            el = el.offsetParent;\r\n        }\r\n\r\n        x = Math.floor((event.clientX - x) / this.hilightWidth);\r\n        y = Math.floor((event.clientY - y) / this.hilightHeight);\r\n\r\n        return {x: x, y: y};\r\n    }\r\n\r\n    textUpdated(editor) {\r\n        if(!this.song || !this.song[editor._sound]) {\r\n            this.reflow(editor, \"\");\r\n            return;\r\n        }\r\n        // Space at start of line is nonbreaking, get it with \\u00a0\r\n        let input = editor._beatmap.textContent.replace(/ |\\u00a0/g, \"\");\r\n        if(input.length === 0) {\r\n            input = \".\";\r\n        }\r\n        this.setText(editor, input);\r\n    }\r\n\r\n    getText(editor) {\r\n        if(!this.song || !this.song[editor._rhythm]) {\r\n            return \"\";\r\n        } else {\r\n            return this.song[editor._rhythm];\r\n        }\r\n    }\r\n\r\n    setText(editor, text, caretFromEnd) {\r\n        if(!this.song || !this.song[editor._sound]) {\r\n            this.reflow(editor, \"\");\r\n            return;\r\n        }\r\n        let commitUndo = false;\r\n        let caret = caretFromEnd ? text.length : this.getCaret(editor._beatmap);\r\n        if(editor._locked) {\r\n            caret = Math.min(editor._locked, caret);\r\n            if(text.length > editor._locked) {\r\n                // Works for pastes too! Removes the different between sizes from the caret position\r\n                text = text.slice(0, caret) + text.slice(caret + (text.length - editor._locked), text.length);\r\n            } else {\r\n                while(text.length < editor._locked) {\r\n                    text += \".\";\r\n                }\r\n            }\r\n        // time to scale things to fit\r\n        } else if(!this.song.independentBuild && this.song.buildupRhythm && this.song.rhythm) {\r\n            let ratio;\r\n            if(editor == this.loopEdit) {\r\n                 ratio = this.core.soundManager.loopLength / this.core.soundManager.buildLength;\r\n            } else {\r\n                ratio = this.core.soundManager.buildLength / this.core.soundManager.loopLength;\r\n            }\r\n            let newLen = Math.round(text.length / ratio);\r\n            // We've tried to make the other map impossibly short, force us to be longer\r\n            while(newLen === 0) {\r\n                text += \".\";\r\n                newLen = Math.round(text.length / ratio);\r\n            }\r\n            let otherMap = this.getOther(editor);\r\n            let wasLocked = otherMap._locked;\r\n            // clamp the length\r\n            otherMap._locked = newLen;\r\n            // Make undos also sync\r\n            this.batchUndo();\r\n            commitUndo = true;\r\n            // avoid infinite loop\r\n            this.song.independentBuild = true;\r\n            // Use setText to update undo state and fill/clamp beats\r\n            this.setText(otherMap, this.song[otherMap._rhythm], true);\r\n            // Restore\r\n            this.song.independentBuild = false;\r\n            // Otherwise we'll lose the new length on the next edit\r\n            if(!wasLocked) {\r\n                otherMap._locked = 0;\r\n            }\r\n            // Fix the buttons\r\n            this.updateHalveDoubleButtons(otherMap);\r\n        }\r\n        this.pushUndo(editor._rhythm, editor, this.song[editor._rhythm], text);\r\n        // If we were linked, commit our 2 edits as 1 undo state\r\n        if(commitUndo) {\r\n            this.commitUndo();\r\n        }\r\n        // Make sure you can't accidentally close the tab\r\n        window.onbeforeunload = this.confirmLeave;\r\n        this.song[editor._rhythm] = text;\r\n        this.reflow(editor, this.song[editor._rhythm]);\r\n        this.setCaret(editor._beatmap, caret);\r\n        this.updateHalveDoubleButtons(editor);\r\n\r\n        this.core.updateBeatLength();\r\n        // We may have to go backwards in time\r\n        this.core.recalcBeatIndex();\r\n        this.updateInfo();\r\n    }\r\n\r\n    getCaret(editable) {\r\n        let caret = 0;\r\n        let sel = window.getSelection();\r\n        if (sel.rangeCount) {\r\n          let range = sel.getRangeAt(0);\r\n          // <br> elements are empty, and pastes do weird things.\r\n          // So don't go up in multiples of 2 for getCaret\r\n          for(let i = 0; i < editable.childNodes.length; i++) {\r\n              if (range.commonAncestorContainer == editable.childNodes[i]) {\r\n                  caret += range.endOffset;\r\n                return caret;\r\n              } else {\r\n                  caret += editable.childNodes[i].textContent.length;\r\n              }\r\n          }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    setCaret(editable, caret) {\r\n        let range = document.createRange();\r\n        let sel = window.getSelection();\r\n        // <br> elements mean children go up in multiples of 2\r\n        for(let i = 0; i < editable.childNodes.length; i+= 2) {\r\n            let textLen = editable.childNodes[i].textContent.length;\r\n            if(caret > textLen) {\r\n                caret -= textLen;\r\n            } else {\r\n                range.setStart(editable.childNodes[i], caret);\r\n                range.collapse(true);\r\n                sel.removeAllRanges();\r\n                sel.addRange(range);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    setLocked(editor, locked) {\r\n        editor._locked = locked;\r\n        if(locked) {\r\n            editor._lockedBtn.innerHTML = \"&#xe906;\"; // LOCKED\r\n        } else {\r\n            editor._lockedBtn.innerHTML = \"&#xe907;\"; // UNLOCKED\r\n        }\r\n        // Synchronise locks when lengths are linked\r\n        if(!this.song.independentBuild) {\r\n            let other = this.getOther(editor);\r\n            let otherLock = locked ? this.getText(other).length : 0;\r\n            this.song.independentBuild = true;\r\n            this.setLocked(other, otherLock);\r\n            this.song.independentBuild = false;\r\n        }\r\n        this.updateHalveDoubleButtons(editor);\r\n    }\r\n\r\n    updateWaveform() {\r\n        if(this.buildWaveBuff != this.core.soundManager.buildup) {\r\n            this.buildWaveBuff = this.core.soundManager.buildup;\r\n            this.buildWave = this.renderWave(this.buildWaveBuff, this.core.soundManager.buildLength);\r\n        }\r\n        if(this.loopWaveBuff != this.core.soundManager.loop) {\r\n            this.loopWaveBuff = this.core.soundManager.loop;\r\n            this.loopWave = this.renderWave(this.loopWaveBuff, this.core.soundManager.loopLength);\r\n        }\r\n    }\r\n\r\n    renderWave(buffer, length) {\r\n        if(!buffer) {\r\n            return null;\r\n        }\r\n        // The individual wave section\r\n        let wave = document.createElement(\"canvas\");\r\n        let waveContext = wave.getContext(\"2d\");\r\n\r\n        wave.height = WAVE_HEIGHT_PIXELS;\r\n        wave.width = Math.floor(WAVE_PIXELS_PER_SECOND * length);\r\n\r\n        let samplesPerPixel = Math.floor(buffer.sampleRate / WAVE_PIXELS_PER_SECOND);\r\n        let waveData = [];\r\n        for(let i = 0; i < buffer.numberOfChannels; i++) {\r\n            waveData.push(buffer.getChannelData(i));\r\n        }\r\n        let channels = buffer.numberOfChannels;\r\n        // Half pixel offset makes things look crisp\r\n        let pixel = 0.5;\r\n        let halfHeight = WAVE_HEIGHT_PIXELS/2;\r\n        for(let i = 0; i < buffer.length; i += samplesPerPixel) {\r\n            let min = 0, max = 0, avgHi = 0, avgLo = 0;\r\n            let j;\r\n            for(j = 0; j < samplesPerPixel && i + j < buffer.length; j++) {\r\n                for(let chan = 0; chan < channels; chan++) {\r\n                    let sample = waveData[chan][i+j];\r\n                    if(sample > 0) {\r\n                        avgHi += sample;\r\n                    } else {\r\n                        avgLo += sample;\r\n                    }\r\n                    if(sample > max) max = sample;\r\n                    if(sample < min) min = sample;\r\n                }\r\n            }\r\n            let maxPix = Math.floor(halfHeight + max * halfHeight);\r\n            // Min is negative, addition is correct\r\n            let minPix = Math.floor(halfHeight + min * halfHeight);\r\n            waveContext.strokeStyle = \"black\";\r\n            waveContext.globalAlpha = \"1\";\r\n            waveContext.beginPath();\r\n            waveContext.moveTo(pixel, maxPix);\r\n            waveContext.lineTo(pixel, minPix);\r\n            waveContext.stroke();\r\n\r\n            // Draw the average too, gives a better feel for the wave\r\n            avgHi /= j * channels;\r\n            avgLo /= j * channels;\r\n            let maxAvg = Math.floor(halfHeight + avgHi * halfHeight);\r\n            let minAvg = Math.floor(halfHeight + avgLo * halfHeight);\r\n            waveContext.strokeStyle = \"white\";\r\n            waveContext.globalAlpha = \"0.5\";\r\n            waveContext.beginPath();\r\n            waveContext.moveTo(pixel, maxAvg);\r\n            waveContext.lineTo(pixel, minAvg);\r\n            waveContext.stroke();\r\n\r\n            pixel+=1;\r\n        }\r\n\r\n        return wave;\r\n    }\r\n\r\n    drawWave() {\r\n        if((!this.buildWave && !this.loopWave) || !this.linked)\r\n            return;\r\n\r\n        let width = this.waveCanvas.width;\r\n        let now = this.core.soundManager.currentTime;\r\n        let timespan = width / WAVE_PIXELS_PER_SECOND / 2;\r\n        let minTime = now - timespan;\r\n        let maxTime = now + timespan;\r\n\r\n        let bLen = this.core.soundManager.buildLength;\r\n        let loopLen = this.core.soundManager.loopLength;\r\n\r\n        let drawTime, drawOffset;\r\n        if(bLen) {\r\n            drawTime = Math.max(minTime, -bLen);\r\n        } else {\r\n            drawTime = Math.max(minTime, 0);\r\n        }\r\n        // drawOffset is \"pixels from the left\"\r\n        drawOffset = Math.floor((drawTime - minTime) * WAVE_PIXELS_PER_SECOND);\r\n\r\n        this.waveContext.clearRect(0, 0, width, WAVE_HEIGHT_PIXELS);\r\n\r\n        if(this.buildWave && bLen && minTime < 0) {\r\n            // Bit of legwork to convert negative to positive\r\n            let waveOffset = Math.floor((1 - drawTime / -bLen) * (this.buildWave.width-1));\r\n            try {\r\n                drawOffset = this.drawOneWave(this.buildWave, waveOffset, drawOffset, width);\r\n            } catch (err) {\r\n                console.log(this.waveCanvas);\r\n            }\r\n            // If there's more to draw after the build, it'll be from the start of the wave\r\n            drawTime = 0;\r\n        }\r\n\r\n        let loopPoints = [];\r\n        if(this.loopWave && loopLen && maxTime > 0) {\r\n            while(drawOffset < width) {\r\n                if(drawTime === 0) {\r\n                    loopPoints.push(drawOffset);\r\n                }\r\n\r\n                let waveOffset = Math.floor((drawTime / loopLen) * (this.loopWave.width-1));\r\n                drawOffset = this.drawOneWave(this.loopWave, waveOffset, drawOffset, width);\r\n                // If we're drawing more than 1 loop it's starting at 0\r\n                drawTime = 0;\r\n            }\r\n        }\r\n\r\n        // trackbar\r\n        this.drawWaveBar(\"red\", width/2);\r\n        // Signify loop point with a green bar, drawing over the wave\r\n        for(let point of loopPoints) {\r\n            this.drawWaveBar(\"green\", point);\r\n        }\r\n    }\r\n\r\n    drawOneWave(wave, waveOffset, drawOffset, width) {\r\n        let drawWidth = Math.min(width - drawOffset, wave.width - waveOffset);\r\n        this.waveContext.drawImage(wave,\r\n                                   waveOffset, 0,                  // source x/y\r\n                                   drawWidth, WAVE_HEIGHT_PIXELS,  // source width/height\r\n                                   drawOffset, 0,                  // dest x/y\r\n                                   drawWidth, WAVE_HEIGHT_PIXELS); // dest width/height\r\n        return drawOffset + drawWidth;\r\n    }\r\n\r\n    drawWaveBar(colour, offset) {\r\n        this.waveContext.strokeStyle = colour;\r\n        this.waveContext.lineWidth = 2;\r\n        this.waveContext.beginPath();\r\n        this.waveContext.moveTo(offset, 0);\r\n        this.waveContext.lineTo(offset, WAVE_HEIGHT_PIXELS);\r\n        this.waveContext.stroke();\r\n    }\r\n\r\n    confirmLeave() {\r\n        return \"Unsaved beatmap - leave anyway?\";\r\n    }\r\n\r\n    alert(msg) {\r\n        this.statusMsg.classList.remove(\"editor__status-msg--fade\");\r\n        this.statusMsg.textContent = msg;\r\n        // Trigger a reflow and thus restart the animation\r\n        var useless = this.statusMsg.offsetWidth;\r\n        this.statusMsg.classList.add(\"editor__status-msg--fade\");\r\n    }\r\n\r\n    generateXML() {\r\n        if(!this.song) {\r\n            return null;\r\n        }\r\n        // Yes, this is just a bunch of strings. Simple XML, simple method.\r\n\r\n        let result = \"  <song name=\\\"\" + this.song.name + \"\\\">\\n\";\r\n        result += \"    <title>\" + this.song.title + \"</title>\\n\";\r\n        if(this.song.source) {\r\n            result += \"    <source>\" + this.song.source + \"</source>\\n\";\r\n        }\r\n        result += \"    <rhythm>\" + this.song.rhythm + \"</rhythm>\\n\";\r\n        if(this.song.buildup) {\r\n            result += \"    <buildup>\" + this.song.buildupName + \"</buildup>\\n\";\r\n            result += \"    <buildupRhythm>\" + this.song.buildupRhythm + \"</buildupRhythm>\\n\";\r\n            if(this.song.independentBuild) {\r\n                result += \"    <independentBuild>true</independentBuild>\\n\";\r\n            }\r\n        }\r\n        result += \"  </song>\\n\";\r\n        return result;\r\n    }\r\n\r\n    saveXML() {\r\n        let xml = this.generateXML();\r\n        if(!xml) {\r\n            return;\r\n        }\r\n        let result = \"<songs>\\n\";\r\n        result += xml;\r\n        result += \"</songs>\\n\";\r\n\r\n        // http://stackoverflow.com/a/18197341\r\n        let element = document.createElement('a');\r\n        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(result));\r\n        element.setAttribute('download', \"0x40Hues - \" + this.song.name + \".xml\");\r\n\r\n        element.style.display = 'none';\r\n        document.body.appendChild(element);\r\n\r\n        element.click();\r\n\r\n        document.body.removeChild(element);\r\n\r\n        window.onbeforeunload = null;\r\n    }\r\n\r\n    // http://stackoverflow.com/a/30810322\r\n    copyXML() {\r\n        let text = this.generateXML();\r\n\r\n        // Clicking when disabled\r\n        if(!text) {\r\n            return;\r\n        }\r\n\r\n        let textArea = document.createElement(\"textarea\");\r\n        textArea.className = \"copybox\";\r\n\r\n        textArea.value = text;\r\n\r\n        document.body.appendChild(textArea);\r\n\r\n        textArea.select();\r\n\r\n        let success;\r\n\r\n        try {\r\n            success = document.execCommand('copy');\r\n        } catch (err) {\r\n            success = false;\r\n        }\r\n\r\n        document.body.removeChild(textArea);\r\n        if(success) {\r\n            this.alert(\"Beatmap XML copied to clipboard!\");\r\n        } else {\r\n            this.alert(\"Copy failed! Try saving instead\");\r\n        }\r\n    }\r\n}\r\n\r\nwindow.HuesEditor = HuesEditor;\r\n\r\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\r\n * Portions Copyright (c) 2015 Calvin Walton <calvin.walton@kepstin.ca>\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n(function(window, document) {\r\n\"use strict\";\r\n\r\n /* HuesInfo.js populates the INFO tab in the Hues Window.\r\n  */\r\n\r\nconst beatGlossary = [\r\n    \"x Vertical blur (snare)\",\r\n    \"o Horizontal blur (bass)\",\r\n    \"- No blur\",\r\n    \"+ Blackout\",\r\n    \"¤ Whiteout\",\r\n    \"| Short blackout\",\r\n    \": Color only\",\r\n    \"* Image only\",\r\n    \"X Vertical blur only\",\r\n    \"O Horizontal blur only\",\r\n    \") Trippy cirle in\",\r\n    \"( Trippy circle out\",\r\n    \"~ Fade color\",\r\n    \"= Fade and change image\",\r\n    \"i Invert all colours\",\r\n    \"I Invert & change image\",\r\n    \"s Horizontal slice\",\r\n    \"S Horizontal slice and change image\",\r\n    \"v Vertical slice\",\r\n    \"V Vertical slice and change image\",\r\n    \"# Double slice\",\r\n    \"@ Double slice and change image\"\r\n];\r\n\r\nconst shortcuts = [\r\n    \"↑↓  Change song\",\r\n    \"←→  Change image\",\r\n    \"[N] Random song\",\r\n    \"-+  Change volume\",\r\n    \"[M] Toggle mute\",\r\n    \"[B] Restart song from build\",\r\n    \"[F] Toggle automode\",\r\n    \"[H] Toggle UI hide\",\r\n    \"[C] Character list\",\r\n    \"[S] Song list\",\r\n    \"[W] Toggle window\",\r\n    \"[R] Resource packs\",\r\n    \"[O] Options\",\r\n    \"[I] Information\",\r\n    \"[1-5] Change UI\"\r\n];\r\n\r\nfunction populateHuesInfo(version, huesWin, settings) {\r\n    if(!settings.enableWindow) {\r\n        return;\r\n    }\r\n    let verString = (parseInt(version)/10).toFixed(1);\r\n\r\n    let info = document.createElement(\"div\");\r\n    info.className = \"hues-ref\";\r\n\r\n    let huesName = settings.huesName.replace(\"%VERSION%\", version);\r\n    let about = document.createElement(\"div\");\r\n    about.className = \"hues-about\";\r\n    about.innerHTML = \"<h1>\" + huesName + \"</h1>\" +\r\n        '<h2>Adapted from the <a target=\"_blank\" href=\"http://0x40hues.blogspot.com\">0x40 Flash</a></h2>' +\r\n        '<h2>Web-ified by <a target=\"_blank\" href=\"https://github.com/mon\">mon</a></h2>' +\r\n        '<h3>With help from <a target=\"_blank\" href=\"https://github.com/kepstin/0x40hues-html5\">Kepstin</a></h3>';\r\n    info.appendChild(about);\r\n\r\n    addReference(info, \"Beat glossary\", beatGlossary);\r\n    addReference(info, \"Keyboard shortcuts\", shortcuts);\r\n\r\n    huesWin.addTab(\"INFO\", info);\r\n}\r\n\r\nlet addReference = function(root, titleText, list) {\r\n    let ref = document.createElement(\"div\");\r\n    ref.className = \"hues-ref__info\";\r\n    root.appendChild(ref);\r\n\r\n    let title = document.createElement(\"h3\");\r\n    title.textContent = titleText;\r\n    ref.appendChild(title);\r\n\r\n    let listElem = document.createElement(\"ul\");\r\n    list.forEach(function(elem) {\r\n        let item = document.createElement(\"li\");\r\n        item.textContent = elem;\r\n        listElem.appendChild(item);\r\n    });\r\n    ref.appendChild(listElem);\r\n};\r\n\r\nwindow.populateHuesInfo = populateHuesInfo;\r\n\r\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\r\n * Portions Copyright (c) 2015 Calvin Walton <calvin.walton@kepstin.ca>\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n (function(window, document) {\r\n\"use strict\";\r\n\r\n/* If you're modifying settings for your hues, DON'T EDIT THIS\r\n   - Go to the HTML and edit the `defaults` object instead!\r\n */\r\nconst defaultSettings = {\r\n    // Location relative to root - where do the audio/zip workers live\r\n    // This is required because Web Workers need an absolute path\r\n    workersPath : \"lib/workers/\",\r\n    // List of respacks to load\r\n    respacks : [],\r\n    // If true, the query string (?foo=bar&baz=boz) will be parsed for settings\r\n    parseQueryString : true,\r\n    // ONLY USED FOR QUERY STRINGS this will be prepended to any respacks\r\n    // passed in as a ?packs=query\r\n    respackPath : \"respacks/\",\r\n    // Debugging var, for loading zips or not\r\n    load : true,\r\n    // Debug, play first song automatically?\r\n    autoplay : true,\r\n    // If true, defaults passed in initialiser override locally saved\r\n    overwriteLocal : false,\r\n    // If set, will attempt to play the named song first\r\n    firstSong: null,\r\n    // If set, will attempt to set the named image first\r\n    firstImage: null,\r\n    // set to false to never change images\r\n    fullAuto: true,\r\n    // The remote respack listing JSON endpoint\r\n    // NOTE: Any packs referenced need CORS enabled or loads fail\r\n    packsURL: \"https://cdn.0x40.ga/getRespacks.php\",\r\n    // If set, will disable the remote resources menu. For custom pages.\r\n    disableRemoteResources: false,\r\n    // You will rarely want to change this. Enables/disables the Hues Window.\r\n    enableWindow: true,\r\n    // Whether to show the Hues Window on page load\r\n    showWindow: false,\r\n    // What tab will be displayed first in the Hues Window\r\n    firstWindow: \"INFO\",\r\n    // Preloader customisation\r\n    preloadPrefix: \"0x\",\r\n    preloadBase: 16,\r\n    preloadMax: 0x40,\r\n    preloadTitle: \"\",\r\n    // Info customisation\r\n    huesName: \"0x40 Hues of JS, v%VERSION%\",\r\n    // If unset, uses <body>, otherwise sets which element to turn hues-y\r\n    root: null,\r\n    // If set, keyboard shortcuts are ignored\r\n    disableKeyboard: false,\r\n\r\n    // UI accessible config\r\n    smartAlign: \"on\",\r\n    blurAmount: \"medium\",\r\n    blurDecay: \"fast\",\r\n    blurQuality: \"medium\",\r\n    currentUI: \"modern\",\r\n    colourSet: \"normal\",\r\n    blackoutUI: \"off\",\r\n    playBuildups: \"on\",\r\n    visualiser: \"off\",\r\n    shuffleImages: \"on\",\r\n    autoSong: \"off\",\r\n    autoSongDelay: 5, // loops or minutes depending on autoSong value\r\n    autoSongShuffle: \"on\",\r\n    autoSongFadeout: \"on\",\r\n    trippyMode: \"off\",\r\n    volume: 0.7,\r\n    skipPreloader: \"off\"\r\n};\r\n\r\n// To dynamically build the UI like the cool guy I am\r\nconst settingsCategories = {\r\n    \"Functionality\" : [\r\n        \"autoSong\",\r\n        \"autoSongShuffle\",\r\n        \"autoSongFadeout\",\r\n        \"playBuildups\"\r\n    ],\r\n    \"Graphics\" : [\r\n        \"blurAmount\",\r\n        \"blurDecay\",\r\n        \"blurQuality\",\r\n        \"trippyMode\"\r\n    ],\r\n    \"Visuals\" : [\r\n        \"smartAlign\",\r\n        \"shuffleImages\",\r\n        \"colourSet\",\r\n        \"visualiser\"\r\n    ],\r\n    \"Interface\" : [\r\n        \"currentUI\",\r\n        \"blackoutUI\",\r\n        \"skipPreloader\"\r\n    ]\r\n};\r\n\r\nconst settingsOptions = {\r\n    smartAlign : {\r\n        name : \"Smart Align images\",\r\n        options : [\"off\", \"on\"]\r\n    },\r\n    blurAmount : {\r\n        name : \"Blur amount\",\r\n        options : [\"low\", \"medium\", \"high\"]\r\n    },\r\n    blurDecay : {\r\n        name : \"Blur decay\",\r\n        options : [\"slow\", \"medium\", \"fast\", \"faster!\"]\r\n    },\r\n    blurQuality : {\r\n        name : \"Blur quality\",\r\n        options : [\"low\", \"medium\", \"high\", \"extreme\"]\r\n    },\r\n    visualiser : {\r\n        name : \"Spectrum analyser\",\r\n        options : [\"off\", \"on\"]\r\n    },\r\n    currentUI : {\r\n        name : \"UI style\",\r\n        options : [\"retro\", \"v4.20\", \"modern\", \"xmas\", \"hlwn\", \"mini\"]\r\n    },\r\n    colourSet : {\r\n        name : \"Colour set\",\r\n        options : [\"normal\", \"pastel\", \"v4.20\"]\r\n    },\r\n    blackoutUI : {\r\n        name : \"Blackout affects UI\",\r\n        options : [\"off\", \"on\"]\r\n    },\r\n    playBuildups : {\r\n        name : \"Play buildups\",\r\n        options : [\"off\", \"once\", \"on\"]\r\n    },\r\n    autoSong : {\r\n        name : \"AutoSong\",\r\n        options : [\"off\", \"loop\", \"time\",\r\n            {type:\"varText\", text:function() {\r\n                // only display if autosong is on\r\n                return this.autoSong == \"off\" ? \"\" : \"after\";\r\n            }},\r\n            {type:\"input\", variable:\"autoSongDelay\", inputType:\"int\",\r\n                visiblity:function() {\r\n                    return this.autoSong != \"off\";\r\n                }\r\n            },\r\n            {type:\"varText\", text:function() {\r\n                let ret = \"\";\r\n                switch(this.autoSong) {\r\n                    case \"loop\":\r\n                        ret = \"loop\";\r\n                        break;\r\n                    case \"time\":\r\n                        ret = \"min\";\r\n                        break;\r\n                    case \"off\":\r\n                        /* falls through */\r\n                    default:\r\n                        return \"\";\r\n                }\r\n                if(this.autoSongDelay > 1) {\r\n                    ret += \"s\";\r\n                }\r\n                return ret;\r\n            }}\r\n        ]\r\n    },\r\n    autoSongShuffle : {\r\n        name : \"AutoSong shuffle\",\r\n        options : [\"off\", \"on\"]\r\n    },\r\n    autoSongFadeout : {\r\n        name : \"AutoSong fade out\",\r\n        options : [\"off\", \"on\"]\r\n    },\r\n    trippyMode : {\r\n        name : \"Trippy Mode\",\r\n        options : [\"off\", \"on\"]\r\n    },\r\n    shuffleImages : {\r\n        name : \"Shuffle images\",\r\n        options : [\"off\", \"on\"]\r\n    },\r\n    skipPreloader : {\r\n        name : \"Skip preloader warning\",\r\n        options : [\"off\", \"on\"]\r\n    }\r\n};\r\n\r\nclass HuesSettings {\r\n    constructor(defaults) {\r\n        this.eventListeners = {\r\n            /* callback updated()\r\n             *\r\n             * Called when settings are updated\r\n             */\r\n            updated : []\r\n        };\r\n\r\n        let settingsVersion = \"1\";\r\n        if(localStorage.settingsVersion != settingsVersion) {\r\n            localStorage.clear();\r\n            localStorage.settingsVersion = settingsVersion;\r\n        }\r\n\r\n        this.hasUI = false;\r\n\r\n        this.settingCheckboxes = {};\r\n\r\n        this.textCallbacks = [];\r\n        this.visCallbacks = [];\r\n\r\n        this.ephemerals = {};\r\n\r\n        for(let attr in defaultSettings) {\r\n            if(!defaultSettings.hasOwnProperty(attr)) {\r\n                continue;\r\n            }\r\n            Object.defineProperty(this, attr, {\r\n                set: this.makeSetter(attr), get: this.makeGetter(attr)\r\n            });\r\n\r\n            if(defaults[attr] !== undefined) {\r\n                if(defaults.overwriteLocal) {\r\n                    this[attr] = defaults[attr];\r\n                } else {\r\n                    this.ephemerals[attr] = defaults[attr];\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this.parseQueryString) {\r\n            let querySettings = this.getQuerySettings();\r\n\r\n            for(let attr in defaultSettings) {\r\n                // query string overrides, finally\r\n                if(querySettings[attr] !== undefined && attr != 'respacks') {\r\n                    this.ephemerals[attr] = querySettings[attr];\r\n                }\r\n            }\r\n\r\n            this.respacks = this.respacks.concat(querySettings.respacks);\r\n        }\r\n    }\r\n\r\n    getQuerySettings() {\r\n        let results = {};\r\n        results.respacks = [];\r\n        let query = window.location.search.substring(1);\r\n        let vars = query.split(\"&\");\r\n        for (let i=0;i<vars.length;i++) {\r\n            let pair = vars[i].split(\"=\");\r\n            if(pair[0] == \"packs\" || pair[0] == \"respacks\"){\r\n                let packs = pair[1].split(\",\");\r\n                for(let j = 0; j < packs.length; j++) {\r\n                    results.respacks.push(this.respackPath + packs[j]);\r\n                }\r\n            } else if(pair[0] == \"song\") { // alias for firstSong\r\n                results.firstSong = pair[1];\r\n            } else {\r\n                let val = pair[1];\r\n                // since we can set ephemeral variables this way\r\n                if(val === \"true\" || val === \"false\")\r\n                    val = val == \"true\";\r\n                results[pair[0]] = val;\r\n            }\r\n        }\r\n        return results;\r\n    }\r\n\r\n    initUI(huesWin) {\r\n        let root = document.createElement(\"div\");\r\n        root.className = \"hues-options\";\r\n\r\n        // Don't make in every loop\r\n        let intValidator = function(self, variable) {\r\n            this.value = this.value.replace(/\\D/g,'');\r\n            if(this.value === \"\" || this.value < 1) {\r\n                this.value = \"\";\r\n                return;\r\n            }\r\n            self[variable] = this.value;\r\n            self.updateConditionals();\r\n            self.callEventListeners(\"updated\");\r\n        };\r\n\r\n        // To order things nicely\r\n        for(let cat in settingsCategories) {\r\n            if(settingsCategories.hasOwnProperty(cat)) {\r\n                let catContainer = document.createElement(\"div\");\r\n                catContainer.textContent = cat;\r\n                catContainer.className = \"settings-category\";\r\n                let cats = settingsCategories[cat];\r\n                for(let i = 0; i < cats.length; i++) {\r\n                    let setName = cats[i];\r\n                    let setContainer = document.createElement(\"div\");\r\n                    let setting = settingsOptions[setName];\r\n                    setContainer.textContent = setting.name;\r\n                    setContainer.className = \"settings-individual\";\r\n                    let buttonContainer = document.createElement(\"div\");\r\n                    buttonContainer.className = \"settings-buttons\";\r\n\r\n                    for(let j = 0; j < setting.options.length; j++) {\r\n                        let option = setting.options[j];\r\n                        if(typeof option === \"string\") {\r\n                            let checkbox = document.createElement(\"input\");\r\n                            // Save checkbox so we can update UI stuff\r\n                            this.settingCheckboxes[setName + \"-\" + option] = checkbox;\r\n                            checkbox.className = \"settings-checkbox\";\r\n                            checkbox.type = \"radio\";\r\n                            checkbox.value = option;\r\n                            let unique = 0;\r\n                            // Lets us have multiple hues on 1 page\r\n                            let id = setName + \"-\" + option + \"-\";\r\n                            while(document.getElementById(id + unique)) {\r\n                                unique++;\r\n                            }\r\n                            checkbox.name = setName + \"-\" + unique;\r\n                            checkbox.id = id + unique;\r\n                            if(this[setName] == option) {\r\n                                checkbox.checked = true;\r\n                            }\r\n                            checkbox.onclick = function(self) {\r\n                                self[setName] = this.value;\r\n                            }.bind(checkbox, this);\r\n                            buttonContainer.appendChild(checkbox);\r\n                            // So we can style this nicely\r\n                            let label = document.createElement(\"label\");\r\n                            label.className = \"settings-label\";\r\n                            label.htmlFor = checkbox.id;\r\n                            label.textContent = option.toUpperCase();\r\n                            buttonContainer.appendChild(label);\r\n                        } else { // special option\r\n                            if(option.type == \"varText\") {\r\n                                let text = document.createElement(\"span\");\r\n                                text.textContent = option.text.bind(this)();\r\n                                buttonContainer.appendChild(text);\r\n                                this.textCallbacks.push({func:option.text.bind(this), element:text});\r\n                            } else if(option.type == \"input\") {\r\n                                let input = document.createElement(\"input\");\r\n                                input.setAttribute(\"type\", \"text\");\r\n                                input.className = \"settings-input\";\r\n                                input.value = this[option.variable];\r\n                                // TODO: support more than just positive ints when the need arises\r\n                                if(option.inputType == \"int\") {\r\n                                    input.oninput = intValidator.bind(input, this, option.variable);\r\n                                }\r\n                                input.autofocus = false;\r\n                                buttonContainer.appendChild(input);\r\n                                if(option.visiblity) {\r\n                                    this.visCallbacks.push({func:option.visiblity.bind(this), element:input});\r\n                                    input.style.visibility = option.visiblity.bind(this)() ? \"visible\" : \"hidden\";\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                    }\r\n                    setContainer.appendChild(buttonContainer);\r\n                    catContainer.appendChild(setContainer);\r\n                }\r\n                root.appendChild(catContainer);\r\n            }\r\n        }\r\n        huesWin.addTab(\"OPTIONS\", root);\r\n        this.hasUI = true;\r\n    }\r\n\r\n    makeGetter(setting) {\r\n        return () => {\r\n            if(defaultSettings.hasOwnProperty(setting)) {\r\n                if(this.ephemerals[setting] !== undefined)\r\n                    return this.ephemerals[setting];\r\n                else if(localStorage[setting] !== undefined)\r\n                    return localStorage[setting];\r\n                else\r\n                    return defaultSettings[setting];\r\n            } else {\r\n                console.log(\"WARNING: Attempted to fetch invalid setting:\", setting);\r\n                return null;\r\n            }\r\n        };\r\n    }\r\n\r\n    // Set a named index to its named value, returns false if name doesn't exist\r\n    makeSetter(setting) {\r\n        return value => {\r\n            if(this.isEphemeral(setting)) {\r\n                this.ephemerals[setting] = value;\r\n            } else {\r\n                let opt = settingsOptions[setting];\r\n                if(!opt || opt.options.indexOf(value) == -1) {\r\n                    console.log(value, \"is not a valid value for\", setting);\r\n                    return false;\r\n                }\r\n                // for updating the UI selection\r\n                try {\r\n                    this.settingCheckboxes[setting + \"-\" + value].checked = true;\r\n                } catch(e) {}\r\n                localStorage[setting] = value;\r\n                this.ephemerals[setting] = undefined;\r\n            }\r\n            this.updateConditionals();\r\n            this.callEventListeners(\"updated\");\r\n            return true;\r\n        };\r\n    }\r\n\r\n    isEphemeral(setting) {\r\n        return settingsOptions[setting] === undefined;\r\n    }\r\n\r\n    updateConditionals() {\r\n        // update any conditionally formatted settings text\r\n        for(let i = 0; i < this.textCallbacks.length; i++) {\r\n            let text = this.textCallbacks[i];\r\n            text.element.textContent = text.func();\r\n        }\r\n        for(let i = 0; i < this.visCallbacks.length; i++) {\r\n            let callback = this.visCallbacks[i];\r\n            callback.element.style.visibility = callback.func() ? \"visible\" : \"hidden\";\r\n        }\r\n    }\r\n\r\n    callEventListeners(ev) {\r\n        let args = Array.prototype.slice.call(arguments, 1);\r\n        this.eventListeners[ev].forEach(function(callback) {\r\n            callback.apply(null, args);\r\n        });\r\n    }\r\n\r\n    addEventListener(ev, callback) {\r\n        ev = ev.toLowerCase();\r\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\r\n            this.eventListeners[ev].push(callback);\r\n        } else {\r\n            throw Error(\"Unknown event: \" + ev);\r\n        }\r\n    }\r\n\r\n    removeEventListener(ev, callback) {\r\n        ev = ev.toLowerCase();\r\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\r\n            this.eventListeners[ev] = this.eventListeners[ev].filter(function(a) {\r\n                return (a !== callback);\r\n            });\r\n        } else {\r\n            throw Error(\"Unknown event: \" + ev);\r\n        }\r\n    }\r\n}\r\n\r\nwindow.HuesSettings = HuesSettings;\r\n\r\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n (function(window, document) {\r\n\"use strict\";\r\n\r\n/*\r\n    Base UI Class for Hues display. Parent is an element\r\n    to put all your own elements under, but make a div\r\n    underneath so it can be entirely hidden.\r\n*/\r\nclass HuesUI {\r\n\r\n    constructor(parent, name) {\r\n        if(!parent) {\r\n            return;\r\n        }\r\n        this.root = document.createElement(\"div\");\r\n        this.root.className = name ? name : this.constructor.name;\r\n        parent.appendChild(this.root);\r\n        this.root.style.visibility = \"hidden\";\r\n\r\n        this.core = null;\r\n\r\n        this.imageName = null;\r\n        this.imageLink = null;\r\n\r\n        this.songName = null;\r\n        this.songLink = null;\r\n\r\n        this.hueName = null;\r\n\r\n        this.imagePrev = null;\r\n        this.imageNext = null;\r\n        this.songPrev = null;\r\n        this.songNext = null;\r\n\r\n        this.beatCount = null;\r\n        this.timer = null;\r\n        this.xBlur = null;\r\n        this.yBlur = null;\r\n\r\n        this.settingsToggle = null;\r\n        this.hideToggle = null;\r\n\r\n        // To deregister on UI hide we need to keep track of these\r\n        // Each callback is { name : \"callbackname\", func : function }\r\n        // Add using this.addCoreCallback\r\n        this.callbacks = [];\r\n\r\n        // Put this near the links to song/image lists/ Bottom right alignment\r\n        this.listContainer = null;\r\n        // Must be dynamic width, 64 pixels high. Will be filled with visualiser\r\n        this.visualiserContainer = null;\r\n\r\n        this.hidden = false;\r\n\r\n        this.initUI();\r\n    }\r\n\r\n    addCoreCallback(name, func) {\r\n        this.callbacks.push({name : name, func : func});\r\n    }\r\n\r\n    initUI() {\r\n        // Major info, image, song names\r\n        let imageName = document.createElement(\"div\");\r\n        this.imageName = imageName;\r\n\r\n        this.imageLink = document.createElement(\"a\");\r\n        this.imageLink.target = \"_blank\";\r\n        this.imageName.appendChild(this.imageLink);\r\n\r\n        let songName = document.createElement(\"div\");\r\n        this.songName = songName;\r\n\r\n        this.songLink = document.createElement(\"a\");\r\n        this.songLink.target = \"_blank\";\r\n        this.songName.appendChild(this.songLink);\r\n\r\n        let hueName = document.createElement(\"div\");\r\n        this.hueName = hueName;\r\n\r\n        // Prev/next controls\r\n        let imagePrev = document.createElement(\"div\");\r\n        imagePrev.textContent = \"<\";\r\n        imagePrev.onclick = () => {this.core.previousImage();};\r\n        this.imagePrev = imagePrev;\r\n        let imageNext = document.createElement(\"div\");\r\n        imageNext.textContent = \">\";\r\n        imageNext.onclick = () =>{this.core.nextImage();};\r\n        this.imageNext = imageNext;\r\n        let songPrev = document.createElement(\"div\");\r\n        songPrev.textContent = \"<\";\r\n        this.songPrev = songPrev;\r\n        songPrev.onclick = () =>{this.core.previousSong();};\r\n        let songNext = document.createElement(\"div\");\r\n        songNext.textContent = \">\";\r\n        songNext.onclick = () =>{this.core.nextSong();};\r\n        this.songNext = songNext;\r\n\r\n        let songList = document.createElement(\"div\");\r\n        songList.textContent = \"SONGS\";\r\n        songList.onclick = () =>{this.core.toggleSongList();};\r\n        this.songList = songList;\r\n        let imageList = document.createElement(\"div\");\r\n        imageList.textContent = \"IMAGES\";\r\n        imageList.onclick = () =>{this.core.toggleImageList();};\r\n        this.imageList = imageList;\r\n\r\n        // Beat timer, x and y blur, millis timer\r\n        this.timer = document.createElement(\"div\");\r\n        this.timer.textContent = \"T=$0x00000\";\r\n\r\n        this.beatCount = document.createElement(\"div\");\r\n        this.beatCount.textContent = \"B=$0x0000\";\r\n\r\n        this.xBlur = document.createElement(\"div\");\r\n        this.xBlur.textContent = \"X=$0x00\";\r\n\r\n        this.yBlur = document.createElement(\"div\");\r\n        this.yBlur.textContent = \"Y=$0x00\";\r\n\r\n        // Config stuff\r\n        this.settingsToggle = document.createElement(\"div\");\r\n        this.settingsToggle.innerHTML = '&#xe900;'; // COG\r\n        this.settingsToggle.className = 'hues-icon';\r\n        this.settingsToggle.onclick = () => {\r\n            this.core.window.toggle();\r\n        };\r\n\r\n        this.hideToggle = document.createElement(\"div\");\r\n        this.hideToggle.innerHTML = \"&#x25BC;\";\r\n        this.hideToggle.onclick = () => {\r\n            this.toggleHide();\r\n        };\r\n\r\n        this.listContainer = document.createElement(\"div\");\r\n        this.visualiserContainer = document.createElement(\"div\");\r\n\r\n        this.addCoreCallback(\"newsong\", this.newSong.bind(this));\r\n        this.addCoreCallback(\"newimage\", this.newImage.bind(this));\r\n        this.addCoreCallback(\"newcolour\", this.newColour.bind(this));\r\n        this.addCoreCallback(\"blurupdate\", this.blurUpdated.bind(this));\r\n        this.addCoreCallback(\"time\", this.updateTime.bind(this));\r\n        this.addCoreCallback(\"invert\", this.invert.bind(this));\r\n        this.resizeHandler = this.resize.bind(this);\r\n    }\r\n\r\n    connectCore(core) {\r\n        this.core = core;\r\n        this.root.style.visibility = \"visible\";\r\n        if(core.resourceManager.hasUI) {\r\n            this.listContainer.appendChild(core.resourceManager.listView);\r\n        }\r\n        this.visualiserContainer.appendChild(this.core.visualiser);\r\n\r\n        this.callbacks.forEach(function(callback) {\r\n            core.addEventListener(callback.name, callback.func);\r\n        });\r\n        window.addEventListener('resize', this.resizeHandler);\r\n        this.resizeHandler();\r\n    }\r\n\r\n    disconnect() {\r\n        this.callbacks.forEach(callback => {\r\n            this.core.removeEventListener(callback.name, callback.func);\r\n        });\r\n        this.core = null;\r\n        this.root.style.visibility = \"hidden\";\r\n        while (this.listContainer.firstElementChild) {\r\n            this.listContainer.removeChild(this.listContainer.firstElementChild);\r\n        }\r\n        while (this.visualiserContainer.firstElementChild) {\r\n            this.visualiserContainer.removeChild(this.visualiserContainer.firstElementChild);\r\n        }\r\n        window.removeEventListener('resize', this.resizeHandler);\r\n    }\r\n\r\n    // ONLY FOR CHANGING UI, NOT FOR \"HIDE\" FEATURE\r\n    show() {\r\n        this.root.style.visibility = \"visible\";\r\n    }\r\n\r\n    // ONLY FOR CHANGING UI, NOT FOR \"HIDE\" FEATURE\r\n    hide() {\r\n        this.root.style.visibility = \"hidden\";\r\n    }\r\n\r\n    toggleHide() {\r\n        this.hidden = !this.hidden;\r\n        if(this.hidden) {\r\n            this.root.classList.add(\"hues-ui--hidden\");\r\n        } else {\r\n            this.root.classList.remove(\"hues-ui--hidden\");\r\n        }\r\n    }\r\n\r\n    resize() {}\r\n    updateVolume(vol) {}\r\n\r\n    newSong(song) {\r\n        if(!song) {\r\n            return;\r\n        }\r\n\r\n        this.songLink.textContent = song.title.toUpperCase();\r\n        this.songLink.href = song.source;\r\n    }\r\n\r\n    newImage(image) {\r\n        if(!image) {\r\n            return;\r\n        }\r\n\r\n        let name = image.fullname ? image.fullname : image.name;\r\n\r\n        this.imageLink.textContent = name.toUpperCase();\r\n        this.imageLink.href = image.source ? image.source : \"\";\r\n    }\r\n\r\n    newColour(colour) {\r\n        this.hueName.textContent = colour.n.toUpperCase();\r\n    }\r\n\r\n    blurUpdated(x, y) {\r\n        x = Math.floor(x * 0xFF);\r\n        y = Math.floor(y * 0xFF);\r\n        this.xBlur.textContent = \"X=\" + this.intToHex(x, 2);\r\n        this.yBlur.textContent = \"Y=\" + this.intToHex(y, 2);\r\n    }\r\n\r\n    updateTime(time) {\r\n        time = Math.floor(time * 1000);\r\n        this.timer.textContent = \"T=\" + this.intToHex(time, 5);\r\n    }\r\n\r\n    intToHex(num, pad) {\r\n        let str = Math.abs(num).toString(16);\r\n        while (str.length < pad)\r\n            str = \"0\" + str;\r\n        let prefix = num < 0 ? \"-\" : \"$\";\r\n        return prefix + \"0x\" + str;\r\n    }\r\n\r\n    invert(invert) {\r\n        if (invert) {\r\n            this.root.classList.add(\"inverted\");\r\n        } else {\r\n            this.root.classList.remove(\"inverted\");\r\n        }\r\n    }\r\n}\r\n\r\n/*\r\n Individual UIs ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n*/\r\n\r\nclass RetroUI extends HuesUI {\r\n    constructor(parent, name) {\r\n        super(parent, name ? name : \"RetroUI\");\r\n    }\r\n\r\n    initUI() {\r\n        super.initUI();\r\n\r\n        let container = document.createElement(\"div\");\r\n        container.className = \"hues-r-container\";\r\n        this.root.appendChild(container);\r\n        this.container = container;\r\n\r\n        this.mode = document.createElement(\"div\");\r\n        container.appendChild(this.mode);\r\n        container.appendChild(this.imageName);\r\n        container.appendChild(this.timer);\r\n        container.appendChild(this.beatCount);\r\n        container.appendChild(this.xBlur);\r\n        container.appendChild(this.yBlur);\r\n\r\n        this.colourIndex = document.createElement(\"div\");\r\n        this.colourIndex.textContent = \"C=$0x00\";\r\n        container.appendChild(this.colourIndex);\r\n\r\n        this.version = document.createElement(\"div\");\r\n        container.appendChild(this.version);\r\n\r\n        container.appendChild(this.hueName);\r\n        container.appendChild(this.songName);\r\n\r\n        this.beatBar = document.createElement(\"div\");\r\n        container.appendChild(this.beatBar);\r\n\r\n        this.controls = document.createElement(\"div\");\r\n        this.controls.className = \"hues-r-controls\";\r\n\r\n        let imageMode = document.createElement(\"div\");\r\n        this.imageModeManual = document.createElement(\"div\");\r\n        this.imageModeManual.textContent = \"NORMAL\";\r\n        this.imageModeManual.onclick = () => {\r\n            this.core.setIsFullAuto(false);\r\n        };\r\n        this.imageModeManual.className = \"hues-r-manualmode hues-r-button\";\r\n        this.imageModeAuto = document.createElement(\"div\");\r\n        this.imageModeAuto.textContent = \"FULL AUTO\";\r\n        this.imageModeAuto.onclick = () => {\r\n            this.core.setIsFullAuto(true);\r\n        };\r\n        this.imageModeAuto.className = \"hues-r-automode hues-r-button\";\r\n        imageMode.appendChild(this.imageModeManual);\r\n        imageMode.appendChild(this.imageModeAuto);\r\n\r\n        this.imagePrev.className = \"hues-r-button\";\r\n        this.imageNext.className = \"hues-r-button\";\r\n        this.songPrev.className = \"hues-r-button\";\r\n        this.songNext.className = \"hues-r-button\";\r\n        this.controls.appendChild(this.imagePrev);\r\n        this.controls.appendChild(imageMode);\r\n        this.controls.appendChild(this.imageNext);\r\n\r\n        this.songList.className = \"hues-r-songs hues-r-button\";\r\n        this.controls.appendChild(this.songPrev);\r\n        this.controls.appendChild(this.songList);\r\n        this.controls.appendChild(this.songNext);\r\n\r\n        this.root.appendChild(this.controls);\r\n\r\n        let subControl = document.createElement(\"div\");\r\n        subControl.className = \"hues-r-subcontrols\";\r\n        subControl.appendChild(this.settingsToggle);\r\n        this.imageList.textContent = \"C\";\r\n        subControl.appendChild(this.imageList);\r\n        subControl.appendChild(this.hideToggle);\r\n        this.subControls = subControl;\r\n\r\n        this.root.appendChild(subControl);\r\n\r\n        this.hideRestore = document.createElement(\"div\");\r\n        this.hideRestore.className = \"hues-r-hiderestore\";\r\n        this.hideRestore.innerHTML = \"&#x25B2;\";\r\n        this.hideRestore.onclick = () => {\r\n            this.toggleHide();\r\n        };\r\n        this.root.appendChild(this.hideRestore);\r\n\r\n        this.listContainer.className = \"hues-r-listcontainer\";\r\n        this.root.appendChild(this.listContainer);\r\n\r\n        this.visualiserContainer.className = \"hues-r-visualisercontainer\";\r\n        this.root.appendChild(this.visualiserContainer);\r\n\r\n        this.addCoreCallback(\"beat\", this.beat.bind(this));\r\n        this.addCoreCallback(\"newmode\", this.newMode.bind(this));\r\n    }\r\n\r\n    toggleHide() {\r\n        this.hidden = !this.hidden;\r\n        if(this.hidden) {\r\n            this.subControls.classList.add(\"hues-ui--hidden\");\r\n            this.controls.classList.add(\"hues-ui--hidden\");\r\n            this.container.classList.add(\"hues-ui--hidden\");\r\n            this.hideRestore.classList.add(\"hues-ui--hidden\");\r\n        } else {\r\n            this.subControls.classList.remove(\"hues-ui--hidden\");\r\n            this.controls.classList.remove(\"hues-ui--hidden\");\r\n            this.container.classList.remove(\"hues-ui--hidden\");\r\n            this.hideRestore.classList.remove(\"hues-ui--hidden\");\r\n        }\r\n    }\r\n\r\n    connectCore(core) {\r\n        super.connectCore(core);\r\n\r\n        this.version.textContent = \"V=$\" + core.versionHex;\r\n    }\r\n\r\n    newMode(isAuto) {\r\n        this.mode.textContent = \"M=\" + (isAuto ? \"FULL AUTO\" : \"NORMAL\");\r\n    }\r\n\r\n    newImage(image) {\r\n        if(!image) {\r\n            return;\r\n        }\r\n\r\n        this.imageLink.textContent = \"I=\" + image.name.toUpperCase();\r\n        this.imageLink.href = image.source;\r\n    }\r\n\r\n    newColour(colour) {\r\n        super.newColour(colour);\r\n\r\n        this.colourIndex.textContent = \"C=\" + this.intToHex(this.core.colourIndex, 2);\r\n    }\r\n\r\n    beat(beats, index) {\r\n        let rest = beats.slice(1);\r\n        this.beatBar.textContent = \">>\" + rest;\r\n        this.beatCount.textContent = \"B=\" + this.intToHex(index, 4);\r\n    }\r\n\r\n    resize() {\r\n        this.core.visualiser.width = this.visualiserContainer.offsetWidth;\r\n        this.core.resizeVisualiser();\r\n    }\r\n}\r\n\r\nclass MinimalUI extends RetroUI {\r\n    constructor(parent, name) {\r\n        super(parent, name ? name : \"MinimalUI\");\r\n    }\r\n\r\n    initUI() {\r\n        super.initUI();\r\n\r\n        this.root.removeChild(this.controls);\r\n        this.root.removeChild(this.subControls);\r\n        this.container.removeChild(this.beatBar);\r\n        this.container.innerHTML = \"\";\r\n        this.container.appendChild(this.beatBar);\r\n    }\r\n}\r\n\r\nclass WeedUI extends RetroUI {\r\n    constructor(parent, name) {\r\n        super(parent, name ? name : \"WeedUI\");\r\n\r\n        this.xVariance = 10;\r\n        this.yVariance = 20;\r\n    }\r\n\r\n    initUI() {\r\n        super.initUI();\r\n\r\n        this.container.removeChild(this.beatBar);\r\n\r\n        this.controls.className = \"hues-w-controls\";\r\n        this.subControls.className = \"hues-w-subcontrols\";\r\n\r\n        let beatBar = document.createElement(\"div\");\r\n        beatBar.className = \"hues-w-beatbar\";\r\n        this.root.appendChild(beatBar);\r\n        this.beatBar = beatBar;\r\n\r\n        let beatLeft = document.createElement(\"div\");\r\n        beatLeft.className = \"hues-w-beatleft\";\r\n        beatBar.appendChild(beatLeft);\r\n        this.beatLeft = beatLeft;\r\n\r\n        let beatRight = document.createElement(\"div\");\r\n        beatRight.className = \"hues-w-beatright\";\r\n        beatBar.appendChild(beatRight);\r\n        this.beatRight = beatRight;\r\n\r\n        this.imageModeManual.textContent = \"ONE\";\r\n        this.imageModeAuto.textContent = \"MANY\";\r\n\r\n        this.visualiserContainer.className += \" hues-w-visualisercontainer\";\r\n    }\r\n\r\n    toggleHide() {\r\n        super.toggleHide(this);\r\n        if(this.hidden) {\r\n            this.beatBar.classList.add(\"hues-ui--hidden\");\r\n        } else {\r\n            this.beatBar.classList.remove(\"hues-ui--hidden\");\r\n        }\r\n    }\r\n\r\n    beat(beats, index) {\r\n        let rest = beats.slice(1);\r\n\r\n        this.beatLeft.textContent = rest;\r\n        this.beatRight.textContent = rest;\r\n\r\n        this.beatCount.textContent = \"B=\" + this.intToHex(index, 4);\r\n\r\n        if([\"x\", \"o\", \"X\", \"O\"].indexOf(beats[0]) != -1) {\r\n            let beatCenter = document.createElement(\"div\");\r\n            beatCenter.className = \"hues-w-beataccent\";\r\n            let rot = this.round10(15 - Math.random() * 30);\r\n            let x = this.round10(- this.xVariance / 2 + Math.random() * this.xVariance);\r\n            let y = this.round10(30 - this.yVariance / 2 + Math.random() * this.yVariance);\r\n            let transform = \"rotate(\" + rot + \"deg) translate(\" + x + \"px, \" + y + \"px)\";\r\n            beatCenter.style.MozTransform    = transform;\r\n            beatCenter.style.webkitTransform = transform;\r\n            beatCenter.style.transform       = transform;\r\n            beatCenter.textContent = beats[0].toUpperCase();\r\n            this.root.appendChild(beatCenter);\r\n            window.setTimeout(this.removeBeat.bind(this, beatCenter), 1500);\r\n        }\r\n    }\r\n\r\n    round10(num) {\r\n        return Math.round(num * 10) / 10;\r\n    }\r\n\r\n    removeBeat(element) {\r\n        this.root.removeChild(element);\r\n    }\r\n}\r\n\r\nclass ModernUI extends HuesUI {\r\n    constructor(parent, name) {\r\n        super(parent, name ? name : \"ModernUI\");\r\n\r\n        this.textSize_normal = 0;\r\n        this.textSize_small = 0;\r\n        this.songLink_size = 0;\r\n        this.imageLink_size = 0;\r\n\r\n        this.currentBeat = \".\";\r\n\r\n        this.hidden = 0; // we have a 3 stage hide\r\n    }\r\n\r\n    initUI() {\r\n        super.initUI();\r\n\r\n        this.imageName.className = \"hues-m-imagename\";\r\n        this.songName.className = \"hues-m-songtitle\";\r\n\r\n        let controls = document.createElement(\"div\");\r\n        controls.className = \"hues-m-controls\";\r\n        this.root.appendChild(controls);\r\n        this.controls = controls;\r\n\r\n        controls.appendChild(this.imageName);\r\n        controls.appendChild(this.songName);\r\n\r\n        let leftBox = document.createElement(\"div\");\r\n        leftBox.className = \"hues-m-leftbox\";\r\n        controls.appendChild(leftBox);\r\n        this.leftBox = leftBox;\r\n\r\n        this.hueName.className = \"hues-m-huename\";\r\n        leftBox.appendChild(this.hueName);\r\n\r\n        let volCluster = document.createElement(\"div\");\r\n        volCluster.className = \"hues-m-vol-cluster\";\r\n        leftBox.appendChild(volCluster);\r\n\r\n        this.settingsToggle.className += \" hues-m-cog\";\r\n        volCluster.appendChild(this.settingsToggle);\r\n\r\n        this.hideToggle.className = \"hues-m-hide\";\r\n        volCluster.appendChild(this.hideToggle);\r\n\r\n        let volBar = document.createElement(\"div\");\r\n        volBar.className = \"hues-m-vol-bar\";\r\n        this.volBar = volBar;\r\n        volCluster.appendChild(volBar);\r\n\r\n        let label = document.createElement(\"div\");\r\n        label.textContent = \"VOL\";\r\n        label.className = \"hues-m-vol-label\";\r\n        label.onclick = () => {\r\n            this.core.soundManager.toggleMute();\r\n        };\r\n        volBar.appendChild(label);\r\n        this.volLabel = label;\r\n\r\n        this.infoToggle = document.createElement(\"div\");\r\n        this.infoToggle.innerHTML = '?';\r\n        this.infoToggle.className = \"hues-m-question\";\r\n        this.infoToggle.onclick = () => {\r\n            this.core.window.selectTab(\"INFO\");\r\n        };\r\n        volCluster.appendChild(this.infoToggle);\r\n\r\n        let input = document.createElement(\"input\");\r\n        input.type = \"range\";\r\n        input.min = 0;\r\n        input.max = 1;\r\n        input.step = 0.1;\r\n        volBar.appendChild(input);\r\n        this.volInput = input;\r\n        input.oninput = () => {\r\n            this.core.soundManager.setVolume(parseFloat(input.value));\r\n        };\r\n\r\n        let rightBox = document.createElement(\"div\");\r\n        rightBox.className = \"hues-m-rightbox\";\r\n        controls.appendChild(rightBox);\r\n        this.rightBox = rightBox;\r\n\r\n        //Song/image controls\r\n        let songs = document.createElement(\"div\");\r\n        songs.className = \"hues-m-controlblock\";\r\n        this.songBlock = songs;\r\n        this.songList.className = \"hues-m-songbutton\";\r\n\r\n        let songControls = document.createElement(\"div\");\r\n        songControls.className = \"hues-m-controlbuttons\";\r\n        this.songPrev.className = \"hues-m-prevbutton\";\r\n        this.songNext.className = \"hues-m-nextbutton\";\r\n        this.songShuffle = document.createElement(\"div\");\r\n        this.songShuffle.innerHTML = '&#xe903;'; // SHUFFLE\r\n        this.songShuffle.className = \"hues-m-actbutton hues-icon\";\r\n        this.songShuffle.onclick = () => {this.core.randomSong();};\r\n        songs.appendChild(this.songList);\r\n        songControls.appendChild(this.songPrev);\r\n        songControls.appendChild(this.songShuffle);\r\n        songControls.appendChild(this.songNext);\r\n        songs.appendChild(songControls);\r\n        rightBox.appendChild(songs);\r\n\r\n        let images = document.createElement(\"div\");\r\n        images.className = \"hues-m-controlblock\";\r\n        this.imageList.className = \"hues-m-songbutton\";\r\n        this.imageBlock = images;\r\n\r\n        let imageControls = document.createElement(\"div\");\r\n        imageControls.className = \"hues-m-controlbuttons\";\r\n\r\n        this.imageMode = document.createElement(\"div\");\r\n        this.imageMode.innerHTML = \"&#xe901;\"; // PLAY\r\n        this.imageMode.className = \"hues-m-actbutton hues-icon\";\r\n        this.imageMode.onclick = () => {this.core.toggleFullAuto();};\r\n        this.imagePrev.className = \"hues-m-prevbutton\";\r\n        this.imageNext.className = \"hues-m-nextbutton\";\r\n        images.appendChild(this.imageList);\r\n        imageControls.appendChild(this.imagePrev);\r\n        imageControls.appendChild(this.imageMode);\r\n        imageControls.appendChild(this.imageNext);\r\n        images.appendChild(imageControls);\r\n        rightBox.appendChild(images);\r\n\r\n        let leftInfo = document.createElement(\"div\");\r\n        leftInfo.className = \"hues-m-leftinfo\";\r\n        let rightInfo = document.createElement(\"div\");\r\n        rightInfo.className = \"hues-m-rightinfo\";\r\n        leftInfo.appendChild(this.xBlur);\r\n        leftInfo.appendChild(this.yBlur);\r\n        rightInfo.appendChild(this.timer);\r\n        rightInfo.appendChild(this.beatCount);\r\n        this.rightInfo = rightInfo;\r\n        this.leftInfo = leftInfo;\r\n        controls.appendChild(leftInfo);\r\n        controls.appendChild(rightInfo);\r\n\r\n        this.visualiserContainer.className = \"hues-m-visualisercontainer\";\r\n        controls.appendChild(this.visualiserContainer);\r\n\r\n        let beatBar = document.createElement(\"div\");\r\n        beatBar.className = \"hues-m-beatbar\";\r\n        this.root.appendChild(beatBar);\r\n        this.beatBar = beatBar;\r\n\r\n        let beatLeft = document.createElement(\"div\");\r\n        beatLeft.className = \"hues-m-beatleft\";\r\n        beatBar.appendChild(beatLeft);\r\n        this.beatLeft = beatLeft;\r\n\r\n        let beatRight = document.createElement(\"div\");\r\n        beatRight.className = \"hues-m-beatright\";\r\n        beatBar.appendChild(beatRight);\r\n        this.beatRight = beatRight;\r\n\r\n        let beatCenter = document.createElement(\"div\");\r\n        beatCenter.className = \"hues-m-beatcenter\";\r\n        this.root.appendChild(beatCenter);\r\n        this.beatCenter = beatCenter;\r\n\r\n        this.hideRestore = document.createElement(\"div\");\r\n        this.hideRestore.className = \"hues-m-hiderestore\";\r\n        this.hideRestore.onclick = () => {\r\n            this.toggleHide();\r\n        };\r\n        this.root.appendChild(this.hideRestore);\r\n\r\n        this.listContainer.className = \"hues-m-listcontainer\";\r\n        this.root.appendChild(this.listContainer);\r\n\r\n        this.addCoreCallback(\"beat\", this.beat.bind(this));\r\n        this.addCoreCallback(\"newmode\", this.newMode.bind(this));\r\n    }\r\n\r\n    toggleHide() {\r\n        // classList is new-ish, but if you have web audio you'll have this\r\n        this.beatBar.classList.remove(\"hues-ui--hidden\");\r\n        this.beatCenter.classList.remove(\"hues-ui--hidden\");\r\n        this.controls.classList.remove(\"hues-ui--hidden\");\r\n        this.hideRestore.classList.remove(\"hues-ui--hidden\");\r\n        switch(this.hidden) {\r\n            case 1:\r\n                this.beatBar.classList.add(\"hues-ui--hidden\");\r\n                this.beatCenter.classList.add(\"hues-ui--hidden\");\r\n                /* falls through */\r\n            case 0:\r\n                this.controls.classList.add(\"hues-ui--hidden\");\r\n                this.hideRestore.classList.add(\"hues-ui--hidden\");\r\n        }\r\n        this.hidden = (this.hidden+1) % 3;\r\n    }\r\n\r\n    updateVolume(vol) {\r\n        this.volInput.value = vol;\r\n        if(vol === 0) {\r\n            this.volLabel.textContent = \"(VOL)\";\r\n        } else {\r\n            this.volLabel.textContent = \"VOL\";\r\n        }\r\n    }\r\n\r\n    newMode (isAuto) {\r\n        if(isAuto) {\r\n            this.imageMode.innerHTML = '&#xe902;'; // PAUSE;\r\n        } else {\r\n            this.imageMode.innerHTML = \"&#xe901;\"; // PLAY\r\n        }\r\n    }\r\n\r\n    beat(beats, index) {\r\n        this.currentBeat = beats[0];\r\n        let rest = beats.slice(1);\r\n\r\n        this.beatLeft.textContent = rest;\r\n        this.beatRight.textContent = rest;\r\n\r\n\r\n        if (this.currentBeat != \".\") {\r\n            while (this.beatCenter.firstElementChild) {\r\n                this.beatCenter.removeChild(this.beatCenter.firstElementChild);\r\n            }\r\n            let span = this.beatCenter.ownerDocument.createElement(\"span\");\r\n            span.textContent = this.currentBeat;\r\n            this.beatCenter.appendChild(span);\r\n        }\r\n        this.beatCount.textContent = \"B=\" + this.intToHex(index, 4);\r\n    }\r\n\r\n    // get the width of a single character in the link box for a given classname\r\n    textWidth(className) {\r\n        // Could be song or image link, don't care\r\n        let el = this.songLink;\r\n        let oldContent = el.innerHTML;\r\n\r\n        // offsetWidth is rounded, divide by 100\r\n        let text = \"\";\r\n        for(let i = 0; i < 100; i++) {\r\n            text += \"&nbsp;\";\r\n        }\r\n        el.innerHTML = text;\r\n        // We override this just after so don't bother to restore it\r\n        el.className = className;\r\n        let size = el.offsetWidth / 100;\r\n\r\n        el.innerHTML = oldContent;\r\n\r\n        return size;\r\n    }\r\n\r\n    resize() {\r\n        this.textSize_normal = this.textWidth(\"\");\r\n        this.textSize_small = this.textWidth(\"small\");\r\n        this.songLink_size = this.songName.clientWidth;\r\n        this.imageLink_size = this.imageName.clientWidth;\r\n\r\n        this.resizeSong();\r\n        this.resizeImage();\r\n        this.core.visualiser.width = this.controls.offsetWidth;\r\n        this.core.resizeVisualiser();\r\n    }\r\n\r\n    resizeElement(el, parentSize) {\r\n        let chars = el.textContent.length;\r\n        if (chars * this.textSize_normal < parentSize) {\r\n            el.className = \"\";\r\n        } else if(chars * this.textSize_small < parentSize) {\r\n            el.className = \"small\";\r\n        } else {\r\n            el.className = \"x-small\";\r\n        }\r\n    }\r\n\r\n    resizeSong() {\r\n        this.resizeElement(this.songLink, this.songLink_size);\r\n    }\r\n\r\n    resizeImage() {\r\n        this.resizeElement(this.imageLink, this.imageLink_size);\r\n    }\r\n\r\n    newSong(song) {\r\n        super.newSong(song);\r\n\r\n        if(!song) {\r\n            return;\r\n        }\r\n\r\n        this.resizeSong();\r\n    }\r\n\r\n    newImage(image) {\r\n        super.newImage(image);\r\n\r\n        if(!image) {\r\n            return;\r\n        }\r\n\r\n        this.resizeImage();\r\n    }\r\n}\r\n\r\nclass XmasUI extends ModernUI {\r\n    constructor(parent, name) {\r\n        super(parent, name ? name : \"XmasUI\");\r\n        this.initSnow();\r\n\r\n         // This will cache our inverted lights images\r\n        this.invert(true);\r\n\r\n        this.controls.removeChild(this.leftBox);\r\n        this.controls.removeChild(this.rightBox);\r\n        this.controls.removeChild(this.rightInfo);\r\n        this.controls.removeChild(this.leftInfo);\r\n\r\n        this.leftBox = null;\r\n        this.rightBox = null;\r\n        this.hueName = null;\r\n        this.xBlur = null;\r\n        this.yBlur = null;\r\n        this.timer = null;\r\n\r\n        this.controls.className += \" hues-x-controls\";\r\n        this.beatBar.className += \" hues-x-beatbar\";\r\n\r\n        this.lights = [];\r\n\r\n        let wires = document.createElement(\"div\");\r\n        wires.className = \"hues-x-wires\";\r\n\r\n        let left = document.createElement(\"div\");\r\n        left.className = \"hues-x-wiresleft\";\r\n        xleft.forEach(function(l, i, a) {\r\n            let light = this.newLight(l, left);\r\n            light.style.transform = \"rotate(\" + l.angle + \"deg)\";\r\n            light.style.left = l.x + \"px\";\r\n            light.style.top = l.y + \"px\";\r\n            this.lights.push(light);\r\n        }, this);\r\n\r\n        let right = document.createElement(\"div\");\r\n        right.className = \"hues-x-wiresright\";\r\n        xright.forEach(function(l, i, a) {\r\n            let light = this.newLight(l, right);\r\n            light.style.transform = \"rotate(\" + (-l.angle) + \"deg)\";\r\n            light.style.right = l.x + \"px\";\r\n            light.style.top = l.y + \"px\";\r\n            this.lights.push(light);\r\n        }, this);\r\n\r\n        let bottomHelper = document.createElement(\"div\");\r\n        bottomHelper.className = \"hues-x-wiresbottomhelper\";\r\n        let bottom = document.createElement(\"div\");\r\n        bottom.className = \"hues-x-wiresbottom\";\r\n        xbottom.forEach(function(l, i, a) {\r\n            let light = this.newLight(l, bottom);\r\n            light.style.transform = \"rotate(\" + l.angle + \"deg)\";\r\n            light.style.left = l.x + \"px\";\r\n            light.style.bottom = l.y + \"px\";\r\n            this.lights.push(light);\r\n        }, this);\r\n\r\n        wires.appendChild(left);\r\n        wires.appendChild(right);\r\n        bottomHelper.appendChild(bottom);\r\n        wires.appendChild(bottomHelper);\r\n        this.root.appendChild(wires);\r\n\r\n        this.visualiserContainer.className = \"hues-x-visualisercontainer\";\r\n        this.controls.removeChild(this.visualiserContainer);\r\n        this.beatBar.appendChild(this.visualiserContainer);\r\n    }\r\n\r\n    invert(invert) {\r\n        super.invert(invert);\r\n\r\n        if(invert) {\r\n            this.snowContext.fillStyle = \"rgba(0, 0, 0, 0.8)\";\r\n        } else {\r\n            this.snowContext.fillStyle = \"rgba(255, 255, 255, 0.8)\";\r\n        }\r\n    }\r\n\r\n    connectCore(core) {\r\n        super.connectCore(core);\r\n        this.startSnow();\r\n    }\r\n\r\n    disconnect() {\r\n        this.stopSnow();\r\n        super.disconnect();\r\n    }\r\n\r\n    lightOn(light) {\r\n        light.on.className = \"hues-x-lighton\";\r\n        light.off.className = \"hues-x-lightoff\";\r\n    }\r\n\r\n    lightOff(light) {\r\n        light.on.className = \"hues-x-lighton off\";\r\n        light.off.className = \"hues-x-lightoff off\";\r\n    }\r\n\r\n    lightFadeOut(light) {\r\n        light.on.className = \"hues-x-lighton hues-x-fade off\";\r\n        light.off.className = \"hues-x-lightoff hues-x-fade off\";\r\n    }\r\n\r\n    lightRecolour(light) {\r\n        let hue = Math.floor(Math.random() * 7) * -56;\r\n        light.on.style.backgroundPosition = hue + \"px 0\";\r\n        light.off.style.backgroundPosition = hue + \"px 0\";\r\n    }\r\n\r\n    randomLight(light) {\r\n        if(Math.random() >= 0.5) {\r\n            this.lightOn(light);\r\n        } else {\r\n            this.lightOff(light);\r\n        }\r\n    }\r\n\r\n    newLight(l, parent) {\r\n        let light = document.createElement(\"div\");\r\n        light.className = \"hues-x-light\";\r\n        let bulb = document.createElement(\"div\");\r\n        let on = document.createElement(\"div\");\r\n        let off = document.createElement(\"div\");\r\n        bulb.appendChild(on);\r\n        bulb.appendChild(off);\r\n        light.appendChild(bulb);\r\n        parent.appendChild(light);\r\n        light.on = on;\r\n        light.off = off;\r\n        light.bulb = bulb;\r\n        this.randomLight(light);\r\n        this.lightRecolour(light);\r\n        return light;\r\n    }\r\n\r\n    beat(beats, index) {\r\n        super.beat(beats, index);\r\n        if(this.currentBeat != \".\") {\r\n            this.lights.forEach(function(light, i, a) {\r\n                switch(this.currentBeat) {\r\n                    case \":\":\r\n                        this.lightOn(light);\r\n                        this.lightRecolour(light);\r\n                        break;\r\n                    case \"+\":\r\n                        this.lightFadeOut(light);\r\n                        break;\r\n                    default:\r\n                        this.randomLight(light);\r\n                }\r\n            }, this);\r\n        }\r\n    }\r\n\r\n    initSnow() {\r\n        this.snowCanvas = document.createElement(\"canvas\");\r\n        this.snowContext = this.snowCanvas.getContext(\"2d\");\r\n        this.snowCanvas.width = 1280;\r\n        this.snowCanvas.height = 720;\r\n        this.snowCanvas.style.display = \"none\";\r\n        this.snowCanvas.className = \"hues-canvas hues-x-snow\";\r\n\r\n        this.root.appendChild(this.snowCanvas);\r\n\r\n        this.snowing = false;\r\n        this.maxSnow = 30;\r\n        this.snowAngle = 0;\r\n        this.lastSnow = 0;\r\n        this.snowflakes = [];\r\n\r\n        this.addCoreCallback(\"frame\", this.drawSnow.bind(this));\r\n    }\r\n\r\n    // From http://thecodeplayer.com/walkthrough/html5-canvas-snow-effect\r\n\r\n    startSnow() {\r\n        this.snowing = true;\r\n        this.snowCanvas.style.display = \"block\";\r\n        let height = this.snowCanvas.height;\r\n        let width = this.snowCanvas.width;\r\n        this.snowAngle = 0;\r\n        this.snowflakes = [];\r\n        for(let i = 0; i < this.maxSnow; i++) {\r\n            this.snowflakes.push({\r\n                x: Math.random()*width, //x-coordinate\r\n                y: Math.random()*height, //y-coordinate\r\n                r: Math.random()*4+1, //radius\r\n                d: Math.random()*25 //density\r\n            });\r\n        }\r\n        this.lastSnow = Date.now() / 1000;\r\n    }\r\n\r\n    stopSnow() {\r\n        this.snowing = false;\r\n        this.snowCanvas.style.display = \"none\";\r\n    }\r\n\r\n    drawSnow() {\r\n        let width = this.snowCanvas.width;\r\n        let height = this.snowCanvas.height;\r\n        let now = Date.now() / 1000;\r\n        let delta = this.lastSnow - now;\r\n        this.lastSnow = now;\r\n        this.snowContext.clearRect(0, 0, width, height);\r\n\r\n        this.snowContext.beginPath();\r\n        for(let i = 0; i < this.maxSnow; i++) {\r\n            let flake = this.snowflakes[i];\r\n            this.snowContext.moveTo(flake.x, flake.y);\r\n            this.snowContext.arc(flake.x, flake.y, flake.r, 0, Math.PI * 2, true);\r\n        }\r\n        this.snowContext.fill();\r\n\r\n        this.snowAngle += delta / 6;\r\n        for(let i = 0; i < this.maxSnow; i++) {\r\n            let flake = this.snowflakes[i];\r\n            //Updating X and Y coordinates\r\n            //We will add 1 to the cos function to prevent negative values which will lead flakes to move upwards\r\n            //Every particle has its own density which can be used to make the downward movement different for each flake\r\n            //Lets make it more random by adding in the radius\r\n            flake.y += Math.cos(this.snowAngle + flake.d) + 1 + flake.r / 2;\r\n            flake.x += Math.sin(this.snowAngle) * 2;\r\n\r\n            //Sending flakes back from the top when it exits\r\n            //Lets make it a bit more organic and let flakes enter from the left and right also.\r\n            if(flake.x > width + 5 || flake.x < -5 || flake.y > height) {\r\n                if(i % 3 > 0) {//66.67% of the flakes\r\n                    this.snowflakes[i] = {x: Math.random() * width, y: -10, r: flake.r, d: flake.d};\r\n                }\r\n                else {\r\n                    //If the flake is exitting from the right\r\n                    if(Math.sin(this.snowAngle) > 0) {\r\n                        //Enter from the left\r\n                        this.snowflakes[i] = {x: -5, y: Math.random() * height, r: flake.r, d: flake.d};\r\n                    }\r\n                    else {\r\n                        //Enter from the right\r\n                        this.snowflakes[i] = {x: width+5, y: Math.random() * height, r: flake.r, d: flake.d};\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    resize() {\r\n        super.resize();\r\n\r\n        let ratio = window.innerWidth / window.innerHeight;\r\n        // cleared on resize\r\n        let savedFill = this.snowContext.fillStyle;\r\n        this.snowCanvas.width = Math.ceil(720 * ratio);\r\n        this.snowContext.fillStyle = savedFill;\r\n    }\r\n\r\n    newColour(colour) {}\r\n    blurUpdated(x, y) {}\r\n    updateTime(time) {}\r\n}\r\n\r\nclass HalloweenUI extends ModernUI {\r\n    constructor(parent, name) {\r\n        super(parent, name ? name : \"HalloweenUI\");\r\n        // This will cache our inverted tombstone image\r\n        this.invert(true);\r\n    }\r\n\r\n    initUI() {\r\n        super.initUI();\r\n\r\n        this.controls.className += \" hues-h-controls\";\r\n        this.beatBar.className += \" hues-h-beatbar\";\r\n        this.leftBox.className += \" hues-h-leftbox\";\r\n        this.rightBox.className += \" hues-h-rightbox\";\r\n        this.volBar.className += \" hues-h-vol-bar\";\r\n\r\n        this.beatLeft.className += \" hues-h-text\";\r\n        this.beatRight.className += \" hues-h-text\";\r\n        this.beatCenter.className += \" hues-h-text\";\r\n        this.songShuffle.className += \" hues-h-text\";\r\n        this.songNext.className += \" hues-h-text\";\r\n        this.songPrev.className += \" hues-h-text\";\r\n        this.songList.className += \" hues-h-text\";\r\n        this.songName.className += \" hues-h-text\";\r\n        this.imageMode.className += \" hues-h-text\";\r\n        this.imageNext.className += \" hues-h-text\";\r\n        this.imagePrev.className += \" hues-h-text\";\r\n        this.imageList.className += \" hues-h-text\";\r\n        this.imageName.className += \" hues-h-text\";\r\n        this.hueName.className += \" hues-h-text\";\r\n\r\n        this.settingsToggle.className += \" hues-h-text\";\r\n        this.hideToggle.className += \" hues-h-text\";\r\n        this.infoToggle.className += \" hues-h-text\";\r\n        this.volLabel.className += \" hues-h-text\";\r\n\r\n        this.timer.className = \"hues-h-textfade\";\r\n        this.beatCount.className = \"hues-h-textfade\";\r\n        this.xBlur.className = \"hues-h-textfade\";\r\n        this.yBlur.className = \"hues-h-textfade\";\r\n\r\n        let leftBoxTomb = document.createElement(\"div\");\r\n        leftBoxTomb.className = \"hues-h-tombstone\";\r\n        this.leftBox.appendChild(leftBoxTomb);\r\n\r\n        let songTomb = document.createElement(\"div\");\r\n        songTomb.className = \"hues-h-tombstone\";\r\n        this.songBlock.insertBefore(songTomb,this.songBlock.firstChild);\r\n\r\n        let imageTomb = document.createElement(\"div\");\r\n        imageTomb.className = \"hues-h-tombstone\";\r\n        this.imageBlock.insertBefore(imageTomb,this.imageBlock.firstChild);\r\n\r\n        let topLeft = document.createElement(\"div\");\r\n        topLeft.className = \"hues-h-topleft\";\r\n        let topRight = document.createElement(\"div\");\r\n        topRight.className = \"hues-h-topright\";\r\n        let bottomRight = document.createElement(\"div\");\r\n        bottomRight.className = \"hues-h-bottomright\";\r\n\r\n        this.root.appendChild(topLeft);\r\n        this.root.appendChild(topRight);\r\n        this.root.appendChild(bottomRight);\r\n\r\n        let leftHand = document.createElement(\"div\");\r\n        leftHand.className = \"hues-h-left-hand\";\r\n        this.beatBar.appendChild(leftHand);\r\n        let rightHand = document.createElement(\"div\");\r\n        rightHand.className = \"hues-h-right-hand\";\r\n        this.beatBar.appendChild(rightHand);\r\n\r\n        this.vignette = document.createElement(\"div\");\r\n        this.vignette.className = \"hues-h-vignette\";\r\n        this.root.appendChild(this.vignette);\r\n    }\r\n\r\n    beat(beats, index) {\r\n        super.beat(beats, index);\r\n\r\n        if (this.currentBeat != \".\") {\r\n            let eyes = this.beatCenter.ownerDocument.createElement(\"div\");\r\n            eyes.className = \"hues-m-beatcenter hues-h-eyes\";\r\n            this.beatCenter.appendChild(eyes);\r\n        }\r\n    }\r\n\r\n    connectCore(core) {\r\n        super.connectCore(core);\r\n\r\n        this.core.preloader.classList.add(\"hues-h-text\");\r\n    }\r\n\r\n    disconnect() {\r\n        this.core.preloader.classList.remove(\"hues-h-text\");\r\n\r\n        super.disconnect();\r\n    }\r\n}\r\n\r\n// Positions and angles for the Xmas lights\r\nlet xleft = [\r\n    {\"angle\": 122.529582194, \"x\": 19.4, \"y\": -19.35},\r\n    {\"angle\": 92.5309436511, \"x\": 25.4, \"y\": 38.7},\r\n    {\"angle\": 107.530202659, \"x\": 39.4, \"y\": 107.75},\r\n    {\"angle\": 77.5309700777, \"x\": 20.75, \"y\": 184.8},\r\n    {\"angle\": 77.5309700777, \"x\": 32.3, \"y\": 249.8},\r\n    {\"angle\": 107.530202659, \"x\": 40.45, \"y\": 327.9},\r\n    {\"angle\": 88.3307935055, \"x\": 35, \"y\": 410.9},\r\n    {\"angle\": 107.530202659, \"x\": 54.35, \"y\": 490.95},\r\n    {\"angle\": 74.9981580491, \"x\": 28.15, \"y\": 573.8},\r\n    {\"angle\": 89.9973772074, \"x\": 23.45, \"y\": 675.35},\r\n    {\"angle\": 107.530202659, \"x\": 21.65, \"y\": 762.6},\r\n    {\"angle\": 107.530202659, \"x\": 15.8, \"y\": 842.75},\r\n    {\"angle\": 92.5309436511, \"x\": 36.55, \"y\": 905.7},\r\n    {\"angle\": 88.3307935055, \"x\": 31.1, \"y\": 988.7},\r\n    {\"angle\": 107.530202659, \"x\": 50.45, \"y\": 1068.75},\r\n    {\"angle\": 74.9981580491, \"x\": 45.75, \"y\": 1158.5},\r\n    {\"angle\": 88.3307935055, \"x\": 35.85, \"y\": 1238.55}\r\n];\r\nlet xright = [\r\n    {\"angle\": 120.001009518, \"x\": 33.3, \"y\": -29.75},\r\n    {\"angle\": 90.0026227926, \"x\": 35.35, \"y\": 53.65},\r\n    {\"angle\": 102.469029922, \"x\": 41.5, \"y\": 136.5},\r\n    {\"angle\": 91.6692064945, \"x\": 22.15, \"y\": 216.55},\r\n    {\"angle\": 72.4697973408, \"x\": 34.4, \"y\": 278.25},\r\n    {\"angle\": 102.469029922, \"x\": 45.75, \"y\": 361.85},\r\n    {\"angle\": 87.4699314665, \"x\": 26.65, \"y\": 426.35},\r\n    {\"angle\": 72.4697973408, \"x\": 41.6, \"y\": 502.15},\r\n    {\"angle\": 102.469029922, \"x\": 27.5, \"y\": 566},\r\n    {\"angle\": 72.4697973408, \"x\": 7.65, \"y\": 638.45},\r\n    {\"angle\": 102.469029922, \"x\": 11, \"y\": 721.25},\r\n    {\"angle\": 76.1887724128, \"x\": 7.65, \"y\": 792.7},\r\n    {\"angle\": 87.4690563489, \"x\": 36.15, \"y\": 850.35},\r\n    {\"angle\": 102.46813454, \"x\": 16.6, \"y\": 924.3},\r\n    {\"angle\": 72.4697973408, \"x\": 15.3, \"y\": 990.8},\r\n    {\"angle\": 76.1887724128, \"x\": 11.95, \"y\": 1062.25},\r\n    {\"angle\": 87.4690563489, \"x\": 40.45, \"y\": 1119.9},\r\n    {\"angle\": 102.46813454, \"x\": 20.9, \"y\": 1193.85}\r\n];\r\nlet xbottom = [\r\n    {\"angle\": 32.5804579323, \"x\": 110.35, \"y\": -12.1},\r\n    {\"angle\": 3.28979777069, \"x\": 168.05, \"y\": -5.55},\r\n    {\"angle\": 17.6989154099, \"x\": 238.35, \"y\": 7.7},\r\n    {\"angle\": -12.6587029361, \"x\": 314.8, \"y\": -10.4},\r\n    {\"angle\": -12.6587029361, \"x\": 379.4, \"y\": 1.05},\r\n    {\"angle\": 17.6989154099, \"x\": 457.75, \"y\": 9.4},\r\n    {\"angle\": 2.59102780115, \"x\": 540.6, \"y\": 3.75},\r\n    {\"angle\": 17.6989154099, \"x\": 620.35, \"y\": 22.7},\r\n    {\"angle\": -15.134241831, \"x\": 703, \"y\": -2.9},\r\n    {\"angle\": 2.30443717424, \"x\": 804.75, \"y\": -7.85},\r\n    {\"angle\": 17.6989154099, \"x\": 892.45, \"y\": -9.55},\r\n    {\"angle\": 17.6989154099, \"x\": 971.65, \"y\": -15.5},\r\n    {\"angle\": 3.28979777069, \"x\": 1035.2, \"y\": 4.35},\r\n    {\"angle\": 2.59102780115, \"x\": 1118, \"y\": 0.2},\r\n    {\"angle\": 17.6989154099, \"x\": 1198.05, \"y\": 18.95},\r\n    {\"angle\": -18.378894807, \"x\": 1288.2, \"y\": 14.2},\r\n    {\"angle\": -4.561224264, \"x\": 1367.9, \"y\": 4.6},\r\n    {\"angle\": 32.5804579323, \"x\": 1452.6, \"y\": -1.7},\r\n    {\"angle\": 3.28979777069, \"x\": 1511.45, \"y\": 4.45},\r\n    {\"angle\": 17.6989154099, \"x\": 1580.6, \"y\": 17.6},\r\n    {\"angle\": -12.6587029361, \"x\": 1656.6, \"y\": -0.95},\r\n    {\"angle\": -12.6587029361, \"x\": 1722.1, \"y\": 11.1},\r\n    {\"angle\": 17.6989154099, \"x\": 1800.5, \"y\": 18.8},\r\n    {\"angle\": 2.59102780115, \"x\": 1883.1, \"y\": 13},\r\n    {\"angle\": 17.6989154099, \"x\": 1963, \"y\": 32.6},\r\n    {\"angle\": -15.134241831, \"x\": 2045.8, \"y\": 7},\r\n    {\"angle\": 2.30443717424, \"x\": 2147.55, \"y\": 1.55},\r\n    {\"angle\": 17.6989154099, \"x\": 2234.1, \"y\": 0.4},\r\n    {\"angle\": 17.6989154099, \"x\": 2315, \"y\": -5.6},\r\n    {\"angle\": 3.28979777069, \"x\": 2377.8, \"y\": 14.5},\r\n    {\"angle\": 2.59102780115, \"x\": 2460.65, \"y\": 9.75},\r\n    {\"angle\": 17.6989154099, \"x\": 2540.2, \"y\": 28.5},\r\n    {\"angle\": -18.378894807, \"x\": 2627.55, \"y\": 24.9},\r\n    {\"angle\": -4.561224264, \"x\": 2710.4, \"y\": 14.4}\r\n];\r\n\r\nwindow.RetroUI = RetroUI;\r\nwindow.WeedUI = WeedUI;\r\nwindow.ModernUI = ModernUI;\r\nwindow.XmasUI = XmasUI;\r\nwindow.HalloweenUI = HalloweenUI;\r\nwindow.MinimalUI = MinimalUI;\r\n\r\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n(function(window, document) {\r\n\"use strict\";\r\n\r\nclass HuesWindow {\r\n    constructor(root, settings) {\r\n        this.eventListeners = {\r\n            /* callback windowshown(shown)\r\n             *\r\n             * When the window is shown, hidden or toggled this fires.\r\n             * 'shown' is true if the window was made visible, false otherwise\r\n             */\r\n            windowshown : [],\r\n            /* callback tabselected(tabName)\r\n             *\r\n             * The name of the tab that was selected\r\n             */\r\n            tabselected : []\r\n        };\r\n\r\n        this.hasUI = settings.enableWindow;\r\n\r\n        if(!this.hasUI)\r\n            return;\r\n\r\n        this.window = document.createElement(\"div\");\r\n        this.window.className = \"hues-win-helper\";\r\n        root.appendChild(this.window);\r\n\r\n        let actualWindow = document.createElement(\"div\");\r\n        actualWindow.className = \"hues-win\";\r\n        this.window.appendChild(actualWindow);\r\n\r\n        let closeButton = document.createElement(\"div\");\r\n        closeButton.className = \"hues-win__closebtn\";\r\n        closeButton.onclick = this.hide.bind(this);\r\n        actualWindow.appendChild(closeButton);\r\n\r\n        this.tabContainer = document.createElement(\"div\");\r\n        this.tabContainer.className = \"hues-win__tabs\";\r\n        actualWindow.appendChild(this.tabContainer);\r\n\r\n        this.contentContainer = document.createElement(\"div\");\r\n        this.contentContainer.className = \"hues-win__content\";\r\n        actualWindow.appendChild(this.contentContainer);\r\n\r\n        this.contents = [];\r\n        this.tabs = [];\r\n        this.tabNames = [];\r\n\r\n\r\n        if(settings.showWindow) {\r\n            this.show();\r\n        } else {\r\n            this.hide();\r\n        }\r\n    }\r\n\r\n    addTab(tabName, tabContent) {\r\n        if(!this.hasUI)\r\n            return;\r\n\r\n        let label = document.createElement(\"div\");\r\n        label.textContent = tabName;\r\n        label.className = \"tab-label\";\r\n        label.onclick = this.selectTab.bind(this, tabName);\r\n        this.tabContainer.appendChild(label);\r\n        this.tabs.push(label);\r\n        this.tabNames.push(tabName);\r\n\r\n        let content = document.createElement(\"div\");\r\n        content.className = \"tab-content\";\r\n        content.appendChild(tabContent);\r\n        this.contentContainer.appendChild(content);\r\n        this.contents.push(content);\r\n    }\r\n\r\n    selectTab(tabName, dontShowWin) {\r\n        if(!this.hasUI)\r\n            return;\r\n        if(!dontShowWin) {\r\n            this.show();\r\n        }\r\n        for(let i = 0; i < this.tabNames.length; i++) {\r\n            let name = this.tabNames[i];\r\n            if(tabName.toLowerCase() == name.toLowerCase()) {\r\n                this.contents[i].classList.add(\"tab-content--active\");\r\n                this.tabs[i].classList.add(\"tab-label--active\");\r\n                this.callEventListeners(\"tabselected\", name);\r\n            } else {\r\n                this.contents[i].classList.remove(\"tab-content--active\");\r\n                this.tabs[i].classList.remove(\"tab-label--active\");\r\n            }\r\n        }\r\n    }\r\n\r\n    hide() {\r\n        if(!this.hasUI)\r\n            return;\r\n\r\n        this.window.classList.add(\"hidden\");\r\n        this.callEventListeners(\"windowshown\", false);\r\n    }\r\n\r\n    show() {\r\n        if(!this.hasUI)\r\n            return;\r\n\r\n        this.window.classList.remove(\"hidden\");\r\n        this.callEventListeners(\"windowshown\", true);\r\n    }\r\n\r\n    toggle() {\r\n        if(!this.hasUI)\r\n            return;\r\n        if(this.window.classList.contains(\"hidden\")) {\r\n            this.show();\r\n        } else {\r\n            this.hide();\r\n        }\r\n    }\r\n\r\n    callEventListeners(ev) {\r\n        let args = Array.prototype.slice.call(arguments, 1);\r\n        this.eventListeners[ev].forEach(function(callback) {\r\n            callback.apply(null, args);\r\n        });\r\n    }\r\n\r\n    addEventListener(ev, callback) {\r\n        ev = ev.toLowerCase();\r\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\r\n            this.eventListeners[ev].push(callback);\r\n        } else {\r\n            throw Error(\"Unknown event: \" + ev);\r\n        }\r\n    }\r\n\r\n    removeEventListener(ev, callback) {\r\n        ev = ev.toLowerCase();\r\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\r\n            this.eventListeners[ev] = this.eventListeners[ev].filter(function(a) {\r\n                return (a !== callback);\r\n            });\r\n        } else {\r\n            throw Error(\"Unknown event: \" + ev);\r\n        }\r\n    }\r\n}\r\n\r\nwindow.HuesWindow = HuesWindow;\r\n\r\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n (function(window, document) {\r\n\"use strict\";\r\n\r\nlet TAB_SONGS = 0;\r\nlet TAB_IMAGES = 1;\r\n\r\n// For multiple Hues on one page\r\nlet unique = 0;\r\nlet getAndIncrementUnique = function() {\r\n    return unique++;\r\n};\r\n\r\nclass Resources {\r\n    constructor(core, huesWin) {\r\n        this.core = core;\r\n        this.hasUI = false;\r\n\r\n        this.resourcePacks = [];\r\n\r\n        this.allSongs = [];\r\n        this.allImages = [];\r\n        this.enabledSongs = [];\r\n        this.enabledImages = [];\r\n\r\n        this.progressState = [];\r\n        this.progressCallback = null;\r\n\r\n        // For songs/images\r\n        this.listView = null;\r\n        this.enabledSongList = null;\r\n        this.enabledImageList = null;\r\n        this.packView = {\r\n            pack: null,\r\n            name: null,\r\n            creator: null,\r\n            size: null,\r\n            desc: null,\r\n            songCount: null,\r\n            imageCount: null,\r\n            songList: null,\r\n            imageList: null,\r\n            packButtons: null,\r\n            totalSongs: null,\r\n            totalImages: null\r\n        };\r\n        this.packsView = {\r\n            respackList: null,\r\n            remoteList: null,\r\n            loadRemote: null,\r\n            progressBar: null,\r\n            progressStatus: null,\r\n            progressCurrent: null,\r\n            progressTop: null,\r\n            progressPercent: null\r\n        };\r\n        this.currentTab = TAB_SONGS;\r\n        this.unique = getAndIncrementUnique();\r\n        this.remotes = null;\r\n        this.fileInput = null;\r\n        this.fileParseQueue = [];\r\n        if(core.settings.enableWindow) {\r\n            this.initUI();\r\n            huesWin.addTab(\"RESOURCES\", this.root);\r\n        }\r\n    }\r\n\r\n    /* Uses HTTP HEAD requests to get the size of all the linked URLs\r\n       Returns an Promise.all which will resolve to an array of sizes */\r\n    getSizes(urls) {\r\n        let promises = [];\r\n\r\n        urls.forEach(url => {\r\n            let p = new Promise((resolve, reject) => {\r\n                let xhr = new XMLHttpRequest();\r\n                xhr.open(\"HEAD\", url, true);\r\n                xhr.onreadystatechange = function() {\r\n                    if (this.readyState == this.DONE) {\r\n                        let bytes = parseInt(xhr.getResponseHeader(\"Content-Length\"));\r\n                        resolve(bytes / 1024 / 1024);\r\n                    }\r\n                };\r\n                xhr.onerror = function() {\r\n                    reject(Error(req.status + \": Could not fetch respack at \" + url));\r\n                };\r\n                xhr.send();\r\n            }).catch(error => {\r\n                // Infinitely more user friendly than the error Same Origin gives\r\n                if(error.code == 1012) {\r\n                    throw Error(\"Respack at URL \" + url + \" is restricted. Check CORS.\");\r\n                } else {\r\n                    throw error;\r\n                }\r\n            });\r\n            promises.push(p);\r\n        });\r\n\r\n        return Promise.all(promises);\r\n    }\r\n\r\n    // Array of URLs to load, and a callback for when we're done\r\n    // Preserves order of URLs being loaded\r\n    addAll(urls, progressCallback) {\r\n        if(progressCallback) {\r\n            this.progressCallback = progressCallback;\r\n            this.progressState = Array.apply(null, Array(urls.length)).map(Number.prototype.valueOf,0);\r\n        }\r\n\r\n        let respackPromises = [];\r\n\r\n        let progressFunc = function(index, progress, pack) {\r\n                this.progressState[index] = progress;\r\n                this.updateProgress(pack);\r\n        };\r\n\r\n        for(let i = 0; i < urls.length; i++) {\r\n            let r = new Respack();\r\n            respackPromises.push(r.loadFromURL(urls[i], progressFunc.bind(this, i)));\r\n        }\r\n        // Start all the promises at once, but add in sequence\r\n        return respackPromises.reduce((sequence, packPromise) => {\r\n            return sequence.then(() => {\r\n                return packPromise;\r\n            }).then(pack => {\r\n                this.addPack(pack);\r\n            });\r\n        }, Promise.resolve());\r\n    }\r\n\r\n    updateProgress(pack) {\r\n        let total = 0;\r\n        for(let i = 0; i < this.progressState.length; i++) {\r\n            total += this.progressState[i];\r\n        }\r\n        total /= this.progressState.length;\r\n        this.progressCallback(total, pack);\r\n    }\r\n\r\n    addPack(pack) {\r\n        console.log(\"Added\", pack.name, \"to respacks\");\r\n        let id = this.resourcePacks.length;\r\n        this.resourcePacks.push(pack);\r\n        this.addResourcesToArrays(pack);\r\n        this.rebuildEnabled();\r\n        this.updateTotals();\r\n\r\n        let self = this;\r\n        this.appendListItem(\"respacks\", pack.name, \"res\" + id, this.packsView.respackList,\r\n            function() {\r\n                pack.enabled = this.checked;\r\n                self.rebuildEnabled();\r\n            }, function(id) {\r\n                this.selectPack(id);\r\n            }.bind(this, id)\r\n        );\r\n    }\r\n\r\n    addResourcesToArrays(pack) {\r\n        this.allImages = this.allImages.concat(pack.images);\r\n        this.allSongs = this.allSongs.concat(pack.songs);\r\n    }\r\n\r\n    rebuildArrays() {\r\n        this.allSongs = [];\r\n        this.allImages = [];\r\n        this.allAnimations = [];\r\n\r\n        for(let i = 0; i < this.resourcePacks.length; i++) {\r\n            this.addResourcesToArrays(this.resourcePacks[i]);\r\n        }\r\n    }\r\n\r\n    rebuildEnabled() {\r\n        this.enabledSongs = [];\r\n        this.enabledImages = [];\r\n\r\n        for(let i = 0; i < this.resourcePacks.length; i++) {\r\n            let pack = this.resourcePacks[i];\r\n            if (pack.enabled !== true) {\r\n                continue;\r\n            }\r\n            for(let j = 0; j < pack.songs.length; j++) {\r\n                let song = pack.songs[j];\r\n                if (song.enabled && this.enabledSongs.indexOf(song) == -1) {\r\n                    this.enabledSongs.push(song);\r\n                }\r\n            }\r\n            for(let j = 0; j < pack.images.length; j++) {\r\n                let image = pack.images[j];\r\n                if (image.enabled && this.enabledImages.indexOf(image) == -1) {\r\n                   this.enabledImages.push(image);\r\n                }\r\n            }\r\n        }\r\n        if(this.hasUI) {\r\n            let songList = this.enabledSongList;\r\n            while(songList.firstElementChild) {\r\n                songList.removeChild(songList.firstElementChild);\r\n            }\r\n            let imageList = this.enabledImageList;\r\n            while(imageList.firstElementChild) {\r\n                imageList.removeChild(imageList.firstElementChild);\r\n            }\r\n            for(let i = 0; i < this.enabledSongs.length; i++) {\r\n                let song = this.enabledSongs[i];\r\n                this.appendSimpleListItem(song.title, songList, function(index) {\r\n                    this.core.setSong(index);\r\n                }.bind(this, i));\r\n            }\r\n            for(let i = 0; i < this.enabledImages.length; i++) {\r\n                let image = this.enabledImages[i];\r\n                this.appendSimpleListItem(image.name, imageList, function(index) {\r\n                    this.core.setImage(index);\r\n                    this.core.setIsFullAuto(false);\r\n                }.bind(this, i));\r\n            }\r\n        }\r\n        this.updateTotals();\r\n    }\r\n\r\n    removePack(pack) {\r\n        let index = this.resourcePacks.indexOf(pack);\r\n        if (index != -1) {\r\n            this.resourcePacks.splice(index, 1);\r\n            this.rebuildArrays();\r\n            this.rebuildEnabled();\r\n        }\r\n    }\r\n\r\n    removeAllPacks() {\r\n        this.resourcePacks = [];\r\n        this.rebuildArrays();\r\n        this.rebuildEnabled();\r\n    }\r\n\r\n    getSongNames() {\r\n        let names = [];\r\n        for(let i = 0; i < this.allSongs.length; i++) {\r\n            names.push(this.allSongs[i]);\r\n        }\r\n        return names;\r\n    }\r\n\r\n    loadLocal() {\r\n        console.log(\"Loading local zip(s)\");\r\n\r\n        let files = this.fileInput.files;\r\n        let p = Promise.resolve();\r\n        for(let i = 0; i < files.length; i++) {\r\n            let r = new Respack();\r\n            /*jshint -W083 */\r\n            p = p.then(() => {\r\n                return r.loadFromBlob(files[i], (progress, respack) => {\r\n                    this.localProgress(progress, respack);\r\n                });\r\n            }).then(pack => {\r\n                this.addPack(pack);\r\n                this.localComplete();\r\n            });\r\n        }\r\n        return p.then(() => {\r\n            console.log(\"Local respack parsing complete\");\r\n        });\r\n    }\r\n\r\n    localProgress(progress, respack) {\r\n        if(!this.hasUI) {return;}\r\n        this.packsView.progressStatus.textContent = \"Processing...\";\r\n\r\n        this.packsView.progressBar.style.width = (progress * 100) + \"%\";\r\n        this.packsView.progressCurrent.textContent = respack.filesLoaded;\r\n        this.packsView.progressTop.textContent = respack.filesToLoad;\r\n        this.packsView.progressPercent.textContent = Math.round(progress * 100) + \"%\";\r\n    }\r\n\r\n    localComplete(progress) {\r\n        let progStat = this.packsView.progressStatus;\r\n        progStat.textContent = \"Complete\";\r\n        window.setTimeout(function() {progStat.textContent = \"Idle\";}, 2000);\r\n\r\n        this.packsView.progressBar.style.width = \"100%\";\r\n        this.packsView.progressCurrent.textContent = \"0b\";\r\n        this.packsView.progressTop.textContent = \"0b\";\r\n        this.packsView.progressPercent.textContent = \"0%\";\r\n    }\r\n\r\n    initUI() {\r\n        this.root = document.createElement(\"div\");\r\n        this.root.className = \"respacks\";\r\n\r\n        let packsContainer = document.createElement(\"div\");\r\n        packsContainer.className = \"respacks__manager\";\r\n\r\n        let packHeader = document.createElement(\"div\");\r\n        packHeader.textContent = \"Current respacks\";\r\n        packHeader.className = \"respacks__header\";\r\n        let packList = document.createElement(\"div\");\r\n        packList.className = \"resource-list\";\r\n        this.packsView.respackList = packList;\r\n        // so we don't use it out of scope in the next if\r\n        let remoteHeader = null;\r\n        let remoteList = null;\r\n        if(!this.core.settings.disableRemoteResources) {\r\n            remoteHeader = document.createElement(\"div\");\r\n            remoteHeader.textContent = \"Remote respacks\";\r\n            remoteHeader.className = \"respacks__header\";\r\n            remoteList = document.createElement(\"div\");\r\n            remoteList.className = \"resource-list resource-list--fill\";\r\n            packList.classList.add(\"resource-list--fill\");\r\n            this.appendSimpleListItem(\"Click to load the list\", remoteList,\r\n                this.loadRemotes.bind(this));\r\n            this.packsView.remoteList = remoteList;\r\n        }\r\n\r\n        let buttons = document.createElement(\"div\");\r\n        buttons.className = \"respacks-buttons\";\r\n        let loadRemote = document.createElement(\"div\");\r\n        loadRemote.className = \"hues-button hidden\";\r\n        loadRemote.textContent = \"LOAD REMOTE\";\r\n        loadRemote.onclick = this.loadCurrentRemote.bind(this);\r\n        let loadLocal = document.createElement(\"div\");\r\n        loadLocal.className = \"hues-button\";\r\n        loadLocal.textContent = \"LOAD ZIPS\";\r\n        loadLocal.onclick = () => {this.fileInput.click();};\r\n        buttons.appendChild(loadLocal);\r\n        buttons.appendChild(loadRemote);\r\n        this.packsView.loadRemote = loadRemote;\r\n\r\n        this.fileInput = document.createElement(\"input\");\r\n        this.fileInput.type =\"file\";\r\n        this.fileInput.accept=\"application/zip\";\r\n        this.fileInput.multiple = true;\r\n        this.fileInput.onchange = this.loadLocal.bind(this);\r\n\r\n        let progressContainer = document.createElement(\"div\");\r\n        progressContainer.className = \"progress-container respacks-bottom-container\";\r\n        let progressBar = document.createElement(\"div\");\r\n        progressBar.className = \"progress-bar\";\r\n        let progressFilled = document.createElement(\"span\");\r\n        progressFilled.className = \"progress-bar--filled\";\r\n        progressBar.appendChild(progressFilled);\r\n        let progressStatus = document.createElement(\"div\");\r\n        progressStatus.textContent = \"Idle\";\r\n\r\n        let progressTexts = document.createElement(\"div\");\r\n        progressTexts.className = \"stat-text\";\r\n        let progressCurrent = document.createElement(\"div\");\r\n        progressCurrent.textContent = \"0b\";\r\n        let progressTop = document.createElement(\"div\");\r\n        progressTop.textContent = \"0b\";\r\n        let progressPercent = document.createElement(\"div\");\r\n        progressPercent.textContent = \"0%\";\r\n        progressTexts.appendChild(progressCurrent);\r\n        progressTexts.appendChild(progressTop);\r\n        progressTexts.appendChild(progressPercent);\r\n\r\n        this.packsView.progressBar = progressFilled;\r\n        this.packsView.progressStatus = progressStatus;\r\n        this.packsView.progressCurrent = progressCurrent;\r\n        this.packsView.progressTop = progressTop;\r\n        this.packsView.progressPercent = progressPercent;\r\n        progressContainer.appendChild(progressStatus);\r\n        progressContainer.appendChild(progressBar);\r\n        progressContainer.appendChild(progressTexts);\r\n\r\n        packsContainer.appendChild(packHeader);\r\n        packsContainer.appendChild(packList);\r\n        if(!this.core.settings.disableRemoteResources) {\r\n            packsContainer.appendChild(remoteHeader);\r\n            packsContainer.appendChild(remoteList);\r\n        }\r\n        packsContainer.appendChild(buttons);\r\n        packsContainer.appendChild(progressContainer);\r\n\r\n        let indivView = document.createElement(\"div\");\r\n        indivView.className = \"respacks__display\";\r\n\r\n        let packName = document.createElement(\"div\");\r\n        packName.textContent = \"<select a respack>\";\r\n        packName.className = \"respacks__header\";\r\n        let packInfo = document.createElement(\"div\");\r\n        packInfo.className = \"stat-text\";\r\n        let packCreator = document.createElement(\"div\");\r\n        let packCreatorText = document.createElement(\"a\");\r\n        packCreatorText.className = \"unstyled-link\";\r\n        packCreatorText.textContent = \"<author>\";\r\n        packCreator.appendChild(packCreatorText);\r\n        packInfo.appendChild(packCreator);\r\n        let packSize = document.createElement(\"div\");\r\n        packSize.textContent = \"0b\";\r\n        packInfo.appendChild(packSize);\r\n        let packDesc = document.createElement(\"div\");\r\n        packDesc.className = \"respack-description\";\r\n        packDesc.textContent = \"<no description>\";\r\n\r\n        let tabContainer = document.createElement(\"div\");\r\n        tabContainer.className = \"respack-tab-container\";\r\n\r\n        let songCount = document.createElement(\"div\");\r\n        songCount.textContent = \"Songs:\";\r\n        songCount.className = \"respack-tab respack-tab--checked\";\r\n\r\n        let imageCount = document.createElement(\"div\");\r\n        imageCount.textContent = \"Images:\";\r\n        imageCount.className = \"respack-tab\";\r\n\r\n        let songList = document.createElement(\"div\");\r\n        songList.className = \"resource-list respack-tab__content respack-tab__content--checked\";\r\n        let imageList = document.createElement(\"div\");\r\n        imageList.className = \"resource-list respack-tab__content\";\r\n\r\n        songCount.onclick = () => {\r\n            songCount.classList.add(\"respack-tab--checked\");\r\n            imageCount.classList.remove(\"respack-tab--checked\");\r\n\r\n            songList.classList.add(\"respack-tab__content--checked\");\r\n            imageList.classList.remove(\"respack-tab__content--checked\");\r\n\r\n            this.currentTab = TAB_SONGS;\r\n        };\r\n\r\n        imageCount.onclick = () => {\r\n            imageCount.classList.add(\"respack-tab--checked\");\r\n            songCount.classList.remove(\"respack-tab--checked\");\r\n\r\n            imageList.classList.add(\"respack-tab__content--checked\");\r\n            songList.classList.remove(\"respack-tab__content--checked\");\r\n\r\n            this.currentTab = TAB_IMAGES;\r\n        };\r\n\r\n        let packButtons = document.createElement(\"div\");\r\n        packButtons.className = \"respacks-buttons respacks-buttons--fill invisible\";\r\n        let enableAll = document.createElement(\"div\");\r\n        enableAll.textContent = \"ENABLE ALL\";\r\n        enableAll.className = \"hues-button\";\r\n        enableAll.onclick = this.enableAll.bind(this);\r\n        let invert = document.createElement(\"div\");\r\n        invert.textContent = \"INVERT\";\r\n        invert.className = \"hues-button\";\r\n        invert.onclick = this.invert.bind(this);\r\n        let disableAll = document.createElement(\"div\");\r\n        disableAll.textContent = \"DISABLE ALL\";\r\n        disableAll.className = \"hues-button\";\r\n        disableAll.onclick = this.disableAll.bind(this);\r\n        packButtons.appendChild(enableAll);\r\n        packButtons.appendChild(invert);\r\n        packButtons.appendChild(disableAll);\r\n\r\n        let totalCounts = document.createElement(\"div\");\r\n        totalCounts.className = \"respacks-bottom-container\";\r\n\r\n        let totalSongsCont = document.createElement(\"div\");\r\n        totalSongsCont.className = \"respacks-count-container\";\r\n        let totalSongsLabel = document.createElement(\"span\");\r\n        totalSongsLabel.textContent = \"Total Songs:\";\r\n        let totalSongs = document.createElement(\"span\");\r\n        totalSongs.className = \"respacks-counts\";\r\n        totalSongsCont.appendChild(totalSongsLabel);\r\n        totalSongsCont.appendChild(totalSongs);\r\n\r\n        let totalImagesCont = document.createElement(\"div\");\r\n        totalImagesCont.className = \"respacks-count-container\";\r\n        let totalImagesLabel = document.createElement(\"span\");\r\n        totalImagesLabel.textContent = \"Total images:\";\r\n        let totalImages = document.createElement(\"span\");\r\n        totalImages.className = \"respacks-counts\";\r\n        totalImagesCont.appendChild(totalImagesLabel);\r\n        totalImagesCont.appendChild(totalImages);\r\n\r\n        totalCounts.appendChild(totalSongsCont);\r\n        totalCounts.appendChild(totalImagesCont);\r\n\r\n        this.packView.name = packName;\r\n        this.packView.creator = packCreatorText;\r\n        this.packView.size = packSize;\r\n        this.packView.desc = packDesc;\r\n        this.packView.songCount = songCount;\r\n        this.packView.imageCount = imageCount;\r\n        this.packView.songList = songList;\r\n        this.packView.imageList = imageList;\r\n        this.packView.packButtons = packButtons;\r\n        this.packView.totalSongs = totalSongs;\r\n        this.packView.totalImages = totalImages;\r\n\r\n        indivView.appendChild(packName);\r\n        indivView.appendChild(packInfo);\r\n        indivView.appendChild(packDesc);\r\n\r\n        tabContainer.appendChild(songCount);\r\n        tabContainer.appendChild(imageCount);\r\n        indivView.appendChild(tabContainer);\r\n        indivView.appendChild(songList);\r\n        indivView.appendChild(imageList);\r\n\r\n        indivView.appendChild(packButtons);\r\n        indivView.appendChild(totalCounts);\r\n\r\n        this.root.appendChild(packsContainer);\r\n        this.root.appendChild(indivView);\r\n\r\n        this.listView = document.createElement(\"div\");\r\n        this.enabledSongList = document.createElement(\"div\");\r\n        this.enabledSongList.className = \"resource-list respacks-enabledsongs hidden\";\r\n        this.enabledImageList = document.createElement(\"div\");\r\n        this.enabledImageList.className = \"resource-list respacks-enabledimages hidden\";\r\n\r\n        this.listView.appendChild(this.enabledSongList);\r\n        this.listView.appendChild(this.enabledImageList);\r\n\r\n        this.hasUI = true;\r\n    }\r\n\r\n    hideLists() {\r\n        if(!this.hasUI) {return;}\r\n        this.enabledSongList.classList.add(\"hidden\");\r\n        this.enabledImageList.classList.add(\"hidden\");\r\n    }\r\n\r\n    toggleVisible(me, other) {\r\n        if(!this.hasUI) {return;}\r\n        if(me.classList.contains(\"hidden\")) {\r\n            me.classList.remove(\"hidden\");\r\n        } else {\r\n            me.classList.add(\"hidden\");\r\n        }\r\n        other.classList.add(\"hidden\");\r\n    }\r\n\r\n    toggleSongList() {\r\n        this.toggleVisible(this.enabledSongList, this.enabledImageList);\r\n    }\r\n\r\n    toggleImageList() {\r\n        this.toggleVisible(this.enabledImageList, this.enabledSongList);\r\n    }\r\n\r\n    updateTotals() {\r\n        if(!this.hasUI) {return;}\r\n        this.packView.totalSongs.textContent =\r\n                this.enabledSongs.length + \"/\" + this.allSongs.length;\r\n        this.packView.totalImages.textContent =\r\n                this.enabledImages.length + \"/\" + this.allImages.length;\r\n    }\r\n\r\n    truncateNum(num) {\r\n        return Math.round(num * 100) / 100;\r\n    }\r\n\r\n    selectPack(id) {\r\n        let pack = this.resourcePacks[id];\r\n        this.packView.pack = pack;\r\n\r\n        this.packView.packButtons.classList.remove(\"invisible\");\r\n        this.packsView.loadRemote.classList.add(\"hidden\");\r\n\r\n        this.packView.name.textContent = pack.name;\r\n        this.packView.creator.textContent = pack.author;\r\n        this.packView.creator.href = pack.link ? pack.link : \"\";\r\n        let size = pack.size / 1024;\r\n        if(size < 512) {\r\n            this.packView.size.textContent = this.truncateNum(size) + \"kB\";\r\n        } else {\r\n            this.packView.size.textContent = this.truncateNum(size / 1024) + \"MB\";\r\n        }\r\n        this.packView.desc.textContent = pack.description;\r\n        this.packView.songCount.textContent = \"Songs: \" + pack.songs.length;\r\n        this.packView.imageCount.textContent = \"Images: \" + pack.images.length;\r\n\r\n        let songList = this.packView.songList;\r\n        let imageList = this.packView.imageList;\r\n        while (songList.firstElementChild) {\r\n            songList.removeChild(songList.firstElementChild);\r\n        }\r\n        while (imageList.firstElementChild) {\r\n            imageList.removeChild(imageList.firstElementChild);\r\n        }\r\n\r\n        for(let i = 0; i < pack.songs.length; i++) {\r\n            let song = pack.songs[i];\r\n            this.appendListItem(\"songs\", song.title, \"song\" + i, songList,\r\n                this.selectResourceCallback(song),\r\n                this.clickResourceCallback.bind(this, song, true),\r\n                song.enabled);\r\n        }\r\n\r\n        for(let i = 0; i < pack.images.length; i++) {\r\n            let image = pack.images[i];\r\n            this.appendListItem(\"images\", image.name, \"image\" + i, imageList,\r\n                this.selectResourceCallback(image),\r\n                this.clickResourceCallback.bind(this, image, false),\r\n                image.enabled);\r\n        }\r\n    }\r\n\r\n    selectResourceCallback(res) {\r\n        let self = this;\r\n        return function() {\r\n            res.enabled = this.checked;\r\n            self.rebuildEnabled();\r\n        };\r\n    }\r\n\r\n    clickResourceCallback(res, isSong) {\r\n        if(!res.enabled) {\r\n            res.enabled = true;\r\n            this.rebuildEnabled();\r\n            // rebuild display\r\n            this.selectPack(this.resourcePacks.indexOf(this.packView.pack));\r\n        }\r\n        if(isSong) {\r\n            this.core.setSong(this.enabledSongs.indexOf(res));\r\n        } else {\r\n            this.core.setImage(this.enabledImages.indexOf(res));\r\n            this.core.setIsFullAuto(false);\r\n        }\r\n    }\r\n\r\n    getEnabledTabContents() {\r\n        let pack = this.packView.pack;\r\n        if(!pack) {\r\n            return null;\r\n        }\r\n        if(this.currentTab == TAB_SONGS) {\r\n            return {arr: pack.songs,\r\n                    elName: \"song\"};\r\n        } else {\r\n            return {arr: pack.images,\r\n                    elName: \"image\"};\r\n        }\r\n    }\r\n\r\n    enableAll() {\r\n        let tab = this.getEnabledTabContents();\r\n        if(!tab)\r\n            return;\r\n        for(let i = 0; i < tab.arr.length; i++) {\r\n            tab.arr[i].enabled = true;\r\n            document.getElementById(tab.elName + i + \"-\" + this.unique).checked = true;\r\n        }\r\n        this.rebuildEnabled();\r\n    }\r\n\r\n    disableAll() {\r\n        let tab = this.getEnabledTabContents();\r\n        if(!tab)\r\n            return;\r\n        for(let i = 0; i < tab.arr.length; i++) {\r\n            tab.arr[i].enabled = false;\r\n            document.getElementById(tab.elName + i + \"-\" + this.unique).checked = false;\r\n        }\r\n        this.rebuildEnabled();\r\n    }\r\n\r\n    invert() {\r\n        let tab = this.getEnabledTabContents();\r\n        if(!tab)\r\n            return;\r\n        for(let i = 0; i < tab.arr.length; i++) {\r\n            tab.arr[i].enabled = !tab.arr[i].enabled;\r\n            document.getElementById(tab.elName + i + \"-\" + this.unique).checked = tab.arr[i].enabled;\r\n        }\r\n        this.rebuildEnabled();\r\n    }\r\n\r\n    appendListItem(name, value, id, root, oncheck, onclick, checked) {\r\n        if(!this.hasUI) {return;}\r\n        if(checked === undefined) {\r\n            checked = true;\r\n        }\r\n        let div = document.createElement(\"div\");\r\n        div.className = \"respacks-listitem\";\r\n        let checkbox = document.createElement(\"input\");\r\n        checkbox.type = \"checkbox\";\r\n        checkbox.name = name;\r\n        checkbox.value = value;\r\n        checkbox.id = id + \"-\" + this.unique;\r\n        checkbox.checked = checked;\r\n        checkbox.onclick = oncheck;\r\n        let checkStyler = document.createElement(\"label\");\r\n        checkStyler.htmlFor = checkbox.id;\r\n        let label = document.createElement(\"span\");\r\n        label.textContent = value;\r\n        label.onclick = onclick;\r\n        div.appendChild(checkbox);\r\n        div.appendChild(checkStyler);\r\n        div.appendChild(label);\r\n        root.appendChild(div);\r\n    }\r\n\r\n    loadRemotes() {\r\n        let remoteList = this.packsView.remoteList;\r\n        while(remoteList.firstElementChild) {\r\n            remoteList.removeChild(remoteList.firstElementChild);\r\n        }\r\n        let item = this.appendSimpleListItem(\"Loading...\", remoteList);\r\n\r\n        let req = new XMLHttpRequest();\r\n        req.open('GET', this.core.settings.packsURL, true);\r\n        req.responseType = 'json';\r\n        req.onload = () => {\r\n            if(!req.response) {\r\n                req.onerror();\r\n            }\r\n            this.remotes = req.response;\r\n            this.populateRemotes();\r\n        };\r\n        req.onerror = () => {\r\n            item.textContent = \"Could not load list! Click to try again\";\r\n            item.onclick = this.loadRemotes.bind(this);\r\n        };\r\n        req.send();\r\n    }\r\n\r\n    populateRemotes() {\r\n        let remoteList = this.packsView.remoteList;\r\n        while(remoteList.firstElementChild) {\r\n            remoteList.removeChild(remoteList.firstElementChild);\r\n        }\r\n        for(let i = 0; i < this.remotes.length; i++) {\r\n            this.remotes[i].loaded = false;\r\n            this.appendSimpleListItem(this.remotes[i].name, remoteList,\r\n                function(index) {\r\n                    this.selectRemotePack(index);\r\n                }.bind(this, i));\r\n        }\r\n    }\r\n\r\n    selectRemotePack(id) {\r\n        let pack = this.remotes[id];\r\n        this.packView.pack = pack;\r\n\r\n        this.packView.packButtons.classList.add(\"invisible\");\r\n        this.packsView.loadRemote.classList.remove(\"hidden\");\r\n        if(pack.loaded) {\r\n            this.packsView.loadRemote.classList.add(\"hues-button--loaded\");\r\n            this.packsView.loadRemote.textContent = \"LOADED\";\r\n        } else {\r\n            this.packsView.loadRemote.classList.remove(\"hues-button--loaded\");\r\n            this.packsView.loadRemote.textContent = \"LOAD REMOTE\";\r\n        }\r\n\r\n        this.packView.name.textContent = pack.name;\r\n        this.packView.creator.textContent = pack.author;\r\n        this.packView.creator.href = pack.link ? pack.link : \"\";\r\n        let size = pack.size / 1024;\r\n        if(size < 512) {\r\n            this.packView.size.textContent = this.truncateNum(size) + \"kB\";\r\n        } else {\r\n            this.packView.size.textContent = this.truncateNum(size / 1024) + \"MB\";\r\n        }\r\n        this.packView.desc.textContent = pack.description;\r\n        this.packView.songCount.textContent = \"Songs: \" + pack.songcount;\r\n        this.packView.imageCount.textContent = \"Images: \" + pack.imagecount;\r\n\r\n        let songList = this.packView.songList;\r\n        let imageList = this.packView.imageList;\r\n        while (songList.firstElementChild) {\r\n            songList.removeChild(songList.firstElementChild);\r\n        }\r\n        while (imageList.firstElementChild) {\r\n            imageList.removeChild(imageList.firstElementChild);\r\n        }\r\n\r\n        for(let i = 0; i < pack.songs.length; i++) {\r\n            let song = pack.songs[i];\r\n            this.appendSimpleListItem(song, songList);\r\n        }\r\n        let moreSongs = pack.songcount - pack.songs.length;\r\n        if(moreSongs > 0) {\r\n            let text = \"... and \" + moreSongs + \" more song\";\r\n            if(moreSongs > 1) {\r\n                text += \"s\";\r\n            }\r\n            this.appendSimpleListItem(text + \".\", songList);\r\n            this.appendSimpleListItem(\"Load the respack to show the rest!\", songList);\r\n        }\r\n\r\n        for(let i = 0; i < pack.images.length; i++) {\r\n            let image = pack.images[i];\r\n            this.appendSimpleListItem(image, imageList);\r\n        }\r\n        let moreImages = pack.imagecount - pack.images.length;\r\n        if(moreImages > 0) {\r\n            let text = \"... and \" + moreImages + \" more image\";\r\n            if(moreImages > 1) {\r\n                text += \"s\";\r\n            }\r\n            this.appendSimpleListItem(text + \".\", imageList);\r\n            this.appendSimpleListItem(\"Load the respack to show the rest!\", imageList);\r\n        }\r\n    }\r\n\r\n    loadCurrentRemote() {\r\n        let pack = this.packView.pack;\r\n\r\n        // Not actually a remote, ignore. How did you press this :<\r\n        if(pack.loaded === undefined || pack.loaded) {\r\n            return;\r\n        }\r\n\r\n        // TODO Error checking on failure\r\n        pack.loaded = true;\r\n        this.packsView.loadRemote.className = \"hues-button hues-button--loaded\";\r\n        this.packsView.loadRemote.textContent = \"LOADING\";\r\n        this.addAll([pack.url], (progress, respack) => {\r\n                this.remoteProgress(progress, respack);\r\n            }\r\n        ).then(this.remoteComplete.bind(this));\r\n    }\r\n\r\n    remoteProgress(progress, respack) {\r\n        if(progress < 0.5) {\r\n            this.packsView.progressStatus.textContent = \"Downloading...\";\r\n            this.packsView.progressCurrent.textContent = Math.round(respack.downloaded / 1024) + \"b\";\r\n            this.packsView.progressTop.textContent = Math.round(respack.size / 1024) + \"b\";\r\n            this.packsView.progressBar.style.width = (progress * 2 * 100) + \"%\";\r\n            this.packsView.progressPercent.textContent = Math.round(progress * 2 * 100) + \"%\";\r\n        } else {\r\n            this.packsView.progressStatus.textContent = \"Processing...\";\r\n            this.packsView.progressCurrent.textContent = respack.filesLoaded;\r\n            this.packsView.progressTop.textContent = respack.filesToLoad;\r\n            this.packsView.progressBar.style.width = ((progress - 0.5) * 2 * 100) + \"%\";\r\n            this.packsView.progressPercent.textContent = Math.round((progress - 0.5) * 2 * 100) + \"%\";\r\n        }\r\n    }\r\n\r\n    remoteComplete() {\r\n        let progStat = this.packsView.progressStatus;\r\n        progStat.textContent = \"Complete\";\r\n        window.setTimeout(function() {progStat.textContent = \"Idle\";}, 2000);\r\n        this.packsView.loadRemote.textContent = \"LOADED\";\r\n\r\n        this.packsView.progressBar.style.width = \"100%\";\r\n        this.packsView.progressCurrent.textContent = \"0b\";\r\n        this.packsView.progressTop.textContent = \"0b\";\r\n        this.packsView.progressPercent.textContent = \"0%\";\r\n    }\r\n\r\n    appendSimpleListItem(value, root, onclick) {\r\n        let div = document.createElement(\"div\");\r\n        div.className = \"respacks-listitem\";\r\n        let label = document.createElement(\"span\");\r\n        // Because we're using textContent, we replace with literal &\r\n        label.textContent = value.replace(/&amp;/g, '&');\r\n        label.onclick = onclick;\r\n        div.appendChild(label);\r\n        root.appendChild(div);\r\n        return label;\r\n    }\r\n}\r\n\r\nwindow.Resources = Resources;\r\n\r\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n (function(window, document) {\r\n\"use strict\";\r\n\r\nconst debugConsole = false;\r\nfunction debug() {\r\n    if(debugConsole) {\r\n        console.log.apply(window.console, arguments);\r\n    }\r\n}\r\n\r\nconst audioExtensions = new RegExp(\"\\\\.(mp3|ogg|wav)$\", \"i\");\r\nconst imageExtensions = new RegExp(\"\\\\.(png|gif|jpg|jpeg)$\", \"i\");\r\nconst animRegex = new RegExp(\"(.*?)_\\\\d+$\");\r\n\r\nclass Respack {\r\n    constructor() {\r\n        this.songs = [];\r\n        this.songQueue = [];\r\n        this.images = [];\r\n        this.imageQueue = [];\r\n\r\n        this.name = \"<no name>\";\r\n        this.author = \"<unknown>\";\r\n        this.description = \"<no description>\";\r\n        this.link = null;\r\n\r\n        this.size = -1;\r\n        this.downloaded = -1;\r\n        this.enabled = true;\r\n\r\n        this._xmlQueue = [];\r\n\r\n        this.totalFiles = -1;\r\n\r\n        // For zip parsing progress events\r\n        this.progressCallback = null;\r\n        this.filesToLoad = 0;\r\n        this.filesLoaded = 0;\r\n        this.loadedFromURL = false;\r\n    }\r\n\r\n    updateProgress(override) {\r\n        if(this.progressCallback) {\r\n            let percent = this.filesLoaded / this.filesToLoad;\r\n            if(this.loadedFromURL) {\r\n                percent = (percent / 2) + 0.5;\r\n            }\r\n            this.progressCallback(typeof override === \"number\" ? override : percent, this);\r\n        }\r\n    }\r\n\r\n    loadFromURL(url, progress) {\r\n        this.loadedFromURL = true;\r\n        if(progress) {\r\n            this.progressCallback = progress;\r\n        }\r\n\r\n        return this.getBlob(url)\r\n        .then(response => {\r\n            return this.loadFromBlob(response);\r\n        });\r\n    }\r\n\r\n    getBlob(url, progress) {\r\n        if(progress) {\r\n            this.progressCallback = progress;\r\n        }\r\n        return new Promise ((resolve, reject) => {\r\n            let req = new XMLHttpRequest();\r\n            req.open('GET', url, true);\r\n            req.responseType = 'blob';\r\n            req.onload = () => {\r\n                if(req.status == 200) {\r\n                    resolve(req.response);\r\n                } else {\r\n                    reject(Error(req.status + \": Could not fetch respack at \" + url));\r\n                }\r\n            };\r\n            req.onerror = function() {\r\n                reject(Error(req.status + \": Could not fetch respack at \" + url));\r\n            };\r\n            req.onprogress = event => {\r\n                if (event.lengthComputable) {\r\n                    this.size = event.total;\r\n                    this.downloaded = event.loaded;\r\n                    let percent = event.loaded / event.total;\r\n                    if(this.progressCallback) {\r\n                        this.progressCallback(percent / 2, this); // because of processing too\r\n                    }\r\n                }\r\n            };\r\n            req.send();\r\n        }).catch(error => {\r\n            // Infinitely more user friendly than the error Same Origin gives\r\n            if(error.code == 1012) {\r\n                throw Error(\"Respack at URL \" + url + \" is restricted. Check CORS.\");\r\n            } else {\r\n                throw error;\r\n            }\r\n        });\r\n    }\r\n\r\n    loadFromBlob(blob, progress) {\r\n        if(progress) {\r\n            this.progressCallback = progress;\r\n        }\r\n        // We don't get progress events for loading the zip, set 0 progress\r\n        this.updateProgress(this.loadedFromURL ? 0.5 : 0);\r\n        return new Promise((resolve, reject) => {\r\n            this.size = blob.size;\r\n            let file = new zip.fs.FS();\r\n            file.importBlob(blob,\r\n                () => {\r\n                    resolve(file);\r\n                },\r\n                error => {   // failure\r\n                    reject(Error(\"Respack error:\", error.toString()));\r\n                }\r\n            );\r\n        }).then(zip => {\r\n            return this.parseZip(zip);\r\n        }).then(() => {\r\n            return this;\r\n        });\r\n    }\r\n\r\n    parseZip(zip) {\r\n        let entries = zip.entries;\r\n\r\n        this.totalFiles = 0;\r\n        // Progress events\r\n        this.filesToLoad = 0;\r\n        this.filesLoaded = 0;\r\n\r\n        // Get everything started\r\n        for(let i = 0; i < entries.length; i++) {\r\n            if(!entries[i].directory && entries[i].name) {\r\n                this.totalFiles++;\r\n                this.parseFile(entries[i]);\r\n            }\r\n        }\r\n\r\n        return this.parseSongQueue()\r\n        .then(() => {\r\n            return this.parseImageQueue();\r\n        }).then(() => {\r\n            return this.parseXML();\r\n        }).then(() => {\r\n            // Cleanup\r\n            this._xmlQueue = [];\r\n            console.log(\"Loaded\", this.name, \"successfully with\", this.songs.length,\r\n                        \"songs and\", this.images.length, \"images.\");\r\n        });\r\n    }\r\n\r\n    parseFile(file) {\r\n        let name = file.name;\r\n        if (name.match(audioExtensions)) {\r\n            this.songQueue.push(this.parseSong(file));\r\n            this.filesToLoad++;\r\n        } else if (name.match(imageExtensions)) {\r\n            this.imageQueue.push(this.parseImage(file));\r\n            this.filesToLoad++;\r\n        } else if(name.toLowerCase().endsWith(\".xml\")){\r\n            this._xmlQueue.push(this.loadXML(file));\r\n        }\r\n    }\r\n\r\n    parseSong(file) {\r\n        let name = file.name.replace(audioExtensions, \"\");\r\n        debug(\"parsing song: \" + name);\r\n        if (this.containsSong(name)) {\r\n            let oldSong = this.getSong(name);\r\n            debug(\"WARNING: Song\", name, \"already exists! Conflict with\", name, \"and\", oldSong.name);\r\n        } else {\r\n            let newSong = {\"name\":name,\r\n                           \"title\":null,\r\n                           \"rhythm\":null,\r\n                           \"source\":null,\r\n                           //\"crc\":this.quickCRC(file), TODO\r\n                           \"sound\":null,\r\n                           \"enabled\":true,\r\n                           \"filename\":file.name,\r\n                           \"charsPerBeat\": null};\r\n            let extension = file.name.split('.').pop().toLowerCase();\r\n            let mime = \"\";\r\n            switch(extension) {\r\n                case \"mp3\":\r\n                    mime = \"audio/mpeg3\";\r\n                    break;\r\n                case \"ogg\":\r\n                    mime = \"audio/ogg\";\r\n                    break;\r\n                case \"wav\":\r\n                    mime = \"audio/wav\";\r\n                    break;\r\n                default:\r\n                    mime = \"application/octet-stream\";\r\n            }\r\n            this.songs.push(newSong);\r\n            return new Promise((resolve, reject) => {\r\n                file.getBlob(mime, sound => {\r\n                    resolve(sound);\r\n                });\r\n            }).then(blob => {\r\n                return new Promise((resolve, reject) => {\r\n                    // Because blobs are crap\r\n                    let fr = new FileReader();\r\n                    fr.onload = () => {\r\n                        resolve(fr.result);\r\n                    };\r\n                    fr.readAsArrayBuffer(blob);\r\n                });\r\n            }).then(sound => {\r\n                newSong.sound = sound;\r\n                this.filesLoaded++;\r\n                this.updateProgress();\r\n            });\r\n        }\r\n    }\r\n\r\n    parseSongQueue() {\r\n        return this.songQueue.reduce((sequence, songPromise) => {\r\n            return sequence.then(() => {\r\n                // Maintain order\r\n                return songPromise;\r\n            });\r\n        }, Promise.resolve());\r\n    }\r\n\r\n    parseImage(file) {\r\n        let match;\r\n        let name = file.name.replace(imageExtensions, \"\");\r\n        let img;\r\n\r\n        // Animation\r\n        if((match = name.match(new RegExp(\"^(.*)_(\\\\d+)$\")))) {\r\n            img = this.getImage(match[1]);\r\n            if(!img) { // make a fresh one\r\n                img = {\"name\":match[1],\r\n                        \"fullname\":match[1],\r\n                        \"align\":\"center\",\r\n                        //\"crc\":this.quickCRC(file),\r\n                        \"bitmaps\":[],\r\n                        \"frameDurations\":[33],\r\n                        \"source\":null,\r\n                        \"enabled\":true,\r\n                        \"animated\":true,\r\n                        \"beatsPerAnim\": null};\r\n                this.images.push(img);\r\n            }\r\n        // Normal image\r\n        } else if (!this.containsImage(name)) {\r\n            img = {\"name\":name,\r\n                    \"fullname\":name,\r\n                    \"bitmap\":null,\r\n                    \"align\":\"center\",\r\n                    //\"crc\":this.quickCRC(file),\r\n                    \"source\":null,\r\n                    \"enabled\":true,\r\n                    \"filename\":file.name,\r\n                    \"animated\":false};\r\n            this.images.push(img);\r\n        } else {\r\n            let existing = this.getImage(name);\r\n            console.log(\"WARNING: Image\", name, \"already exists! Conflict with\", file.name, \"and\", existing.name);\r\n            return;\r\n        }\r\n\r\n        return this.loadImage(file, img);\r\n    }\r\n\r\n    loadImage(imgFile, imageObj) {\r\n        let extension = imgFile.name.split('.').pop().toLowerCase();\r\n        let mime = \"\";\r\n        switch(extension) {\r\n            case \"png\":\r\n                mime = \"image/png\";\r\n                break;\r\n            case \"gif\":\r\n                mime = \"image/gif\";\r\n                break;\r\n            case \"jpg\":\r\n            case \"jpeg\":\r\n                mime = \"image/jpeg\";\r\n                break;\r\n            default:\r\n                mime = \"application/octet-stream\";\r\n        }\r\n        return new Promise((resolve, reject) => {\r\n            imgFile.getData64URI(mime, resolve);\r\n        }).then(bitmap => {\r\n            this.filesLoaded++;\r\n            this.updateProgress();\r\n            return {bitmap: bitmap, img: imageObj};\r\n        });\r\n    }\r\n\r\n    parseImageQueue() {\r\n        return this.imageQueue.reduce((sequence, imagePromise) => {\r\n            return sequence.then(() => {\r\n                // Maintain order\r\n                return imagePromise;\r\n            }).then(response => {\r\n                // Don't crash if the respack had duplicate images\r\n                if(!response)\r\n                    return;\r\n                let newImg = new Image();\r\n                newImg.src = response.bitmap;\r\n                if (response.img.animated) {\r\n                    response.img.bitmaps.push(newImg);\r\n                } else {\r\n                    response.img.bitmap = newImg;\r\n                }\r\n            });\r\n        }, Promise.resolve());\r\n    }\r\n\r\n    loadXML(file) {\r\n        return new Promise((resolve, reject) => {\r\n            file.getText(text => {\r\n                //XML parser will complain about a bare '&', but some respacks use &amp\r\n                text = text.replace(/&amp;/g, '&');\r\n                text = text.replace(/&/g, '&amp;');\r\n                let parser = new DOMParser();\r\n                let dom = parser.parseFromString(text, \"text/xml\");\r\n                resolve(dom);\r\n            });\r\n        });\r\n    }\r\n\r\n    parseXML() {\r\n        for(let i = 0; i < this._xmlQueue.length; i++) {\r\n            this._xmlQueue[i] = this._xmlQueue[i].then(dom => {\r\n                switch(dom.documentElement.nodeName) {\r\n                    case \"songs\":\r\n                        if(this.songs.length > 0)\r\n                            this.parseSongFile(dom);\r\n                        break;\r\n                    case \"images\":\r\n                        if(this.images.length > 0)\r\n                            this.parseImageFile(dom);\r\n                        break;\r\n                    case \"info\":\r\n                        this.parseInfoFile(dom);\r\n                        break;\r\n                    default:\r\n                        console.log(\"XML found with no songs, images or info\");\r\n                        break;\r\n                }\r\n            });\r\n        }\r\n        return Promise.all(this._xmlQueue);\r\n    }\r\n\r\n    parseSongFile(dom) {\r\n        debug(\" - Parsing songFile\");\r\n\r\n        let newSongs = [];\r\n        let el = dom.documentElement.firstElementChild;\r\n        for(; el; el = el.nextElementSibling) {\r\n            let song = this.getSong(el.attributes[0].value);\r\n            if(song) {\r\n                song.title = el.getTag(\"title\");\r\n                if(!song.title) {\r\n                    song.title = \"<no name>\";\r\n                    debug(\"  WARNING!\", song.name, \"has no title!\");\r\n                }\r\n\r\n                song.rhythm = el.getTag(\"rhythm\");\r\n                if(!song.rhythm) {\r\n                    song.rhythm = \"..no..rhythm..\";\r\n                    debug(\"  WARNING!!\", song.name, \"has no rhythm!!\");\r\n                }\r\n\r\n                song.buildupName = el.getTag(\"buildup\");\r\n                if(song.buildupName) {\r\n                    debug(\"  Finding a buildup '\" + song.buildupName + \"' for \", song.name);\r\n                    let build = this.getSong(song.buildupName);\r\n                    if(build) {\r\n                        song.buildup = build.sound;\r\n                        song.buildupPlayed = false;\r\n                        // get rid of the junk\r\n                        this.songs.splice(this.songs.indexOf(build), 1);\r\n                    } else {\r\n                        debug(\"  WARNING!\", \"Didn't find a buildup '\" + song.buildupName + \"'!\");\r\n                    }\r\n                }\r\n\r\n                song.buildupRhythm = el.getTag(\"buildupRhythm\");\r\n                song.independentBuild = el.getTag(\"independentBuild\");\r\n                song.source = el.getTag(\"source\");\r\n                song.charsPerBeat = parseFloat(el.getTag(\"charsPerBeat\"));\r\n\r\n                // Because PackShit breaks everything\r\n                if(this.name == \"PackShit\") {\r\n                    song.forceTrim  = true;\r\n                }\r\n                newSongs.push(song);\r\n                debug(\"  [I] \" + song.name, \": '\" + song.title + \"' added to songs\");\r\n            } else {\r\n                debug(\"  WARNING!\", \"songs.xml: <song> element\",\r\n                    + el.attributes[0].value + \"- no song found\");\r\n            }\r\n        }\r\n        for(let i = 0; i < this.songs.length; i++) {\r\n            if(newSongs.indexOf(this.songs[i]) == -1) {\r\n                debug(\"  WARNING!\", \"We have a file for\", this.songs[i].name, \"but no information for it\");\r\n            }\r\n        }\r\n        this.songs = newSongs;\r\n    }\r\n\r\n    parseInfoFile(dom) {\r\n        debug(\" - Parsing infoFile\");\r\n\r\n        let info = dom.documentElement;\r\n\r\n        // self reference strings to avoid changing strings twice in future\r\n        this.name = info.getTag(\"name\", this.name);\r\n        this.author = info.getTag(\"author\", this.author);\r\n        this.description = info.getTag(\"description\", this.description);\r\n        this.link = info.getTag(\"link\", this.link);\r\n    }\r\n\r\n    parseImageFile(dom) {\r\n        debug(\" - Parsing imagefile\");\r\n\r\n        let newImages = [];\r\n        let el = dom.documentElement.firstElementChild;\r\n        for(; el; el = el.nextElementSibling) {\r\n            let image = this.getImage(el.attributes[0].value);\r\n            if(image) {\r\n                image.fullname = el.getTag(\"fullname\");\r\n                if(!image.fullname) {\r\n                    debug(\"  WARNING!\", image.name, \"has no full name!\");\r\n                }\r\n                image.source = el.getTag(\"source\");\r\n                // self reference defaults to avoid changing strings twice in future\r\n                image.align = el.getTag(\"align\", image.align);\r\n                image.beatsPerAnim = parseFloat(el.getTag(\"beatsPerAnim\"));\r\n                image.syncOffset = parseFloat(el.getTag(\"syncOffset\"));\r\n                let frameDur = el.getTag(\"frameDuration\");\r\n                if(frameDur) {\r\n                    image.frameDurations = [];\r\n                    let strSplit = frameDur.split(\",\");\r\n                    for(let j = 0; j < strSplit.length; j++) {\r\n                        image.frameDurations.push(parseInt(strSplit[j]));\r\n                    }\r\n                    while (image.frameDurations.length < image.bitmaps.length) {\r\n                        image.frameDurations.push(image.frameDurations[image.frameDurations.length - 1]);\r\n                    }\r\n                    debug(\"Frame durations:\", image.frameDurations);\r\n                }\r\n                debug(\"  [I] \" + image.name, \":\", image.fullname, \"added to images\");\r\n                if (image.bitmap || image.bitmaps) {\r\n                    newImages.push(image);\r\n                }\r\n                else {\r\n                    debug(\"  WARNING!!\", \"Image\", image.name, \"has no bitmap nor animation frames!\");\r\n                }\r\n            } else {\r\n                debug(\"  WARNING!\", \"images.xml: no image '\" + el.attributes[0].value + \"' found\");\r\n            }\r\n        }\r\n        for(let i = 0; i < this.images.length; i++) {\r\n            let image = this.images[i];\r\n            // Add all images with no info\r\n            if(newImages.indexOf(image) == -1) {\r\n                newImages.push(image);\r\n            }\r\n        }\r\n        newImages.sort(function(a, b) {\r\n            return a.name.localeCompare(b.name);\r\n        });\r\n        this.images = newImages;\r\n    }\r\n\r\n    containsSong(name) {\r\n        return this.getSong(name) !== null;\r\n    }\r\n\r\n    containsImage(name) {\r\n        return this.getImage(name) !== null;\r\n    }\r\n\r\n    getSong(name) {\r\n        for(let i = 0; i < this.songs.length; i++) {\r\n            if (name == this.songs[i].name) {\r\n                return this.songs[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getImage(name) {\r\n        for(let i = 0; i < this.images.length; i++) {\r\n            if (name == this.images[i].name) {\r\n                return this.images[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\nwindow.Respack = Respack;\r\n\r\n// Save some chars\r\nElement.prototype.getTag = function(tag, def) {\r\n    let t = this.getElementsByTagName(tag)[0];\r\n    return t ? t.textContent : (def ? def : null);\r\n};\r\n\r\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n(function(window, document) {\r\n\"use strict\";\r\n\r\nclass SoundManager {\r\n    constructor(core) {\r\n        // Perhaps this will do more later\r\n        this.eventListeners = {\r\n            /* callback seek()\r\n            *\r\n            * Called when the audio has been seeked - reset time determined transforms\r\n            */\r\n            seek : []\r\n        };\r\n\r\n        this.core = core;\r\n        this.playing = false;\r\n        this.playbackRate = 1;\r\n        this.song = null;\r\n\r\n        this.initPromise = null;\r\n        this.lockedPromise = null;\r\n        this.locked = true;\r\n\r\n        /* Lower level audio and timing info */\r\n        this.context = null; // Audio context, Web Audio API\r\n        this.oggSupport = false;\r\n        this.buildSource = null;\r\n        this.loopSource = null;\r\n        this.buildup = null;\r\n        this.loop = null;\r\n        this.startTime = 0;  // File start time - 0 is loop start, not build start\r\n        this.buildLength = 0;\r\n        this.loopLength = 0; // For calculating beat lengths\r\n\r\n        // Volume\r\n        this.gainNode = null;\r\n        this.mute = false;\r\n        this.lastVol = 1;\r\n\r\n        // Visualiser\r\n        this.vReady = false;\r\n        this.vBars = 0;\r\n        this.vTotalBars = 0;\r\n        this.splitter = null;\r\n        this.analysers = [];\r\n        this.analyserArrays = [];\r\n        this.logArrays = [];\r\n        this.binCutoffs = [];\r\n        this.linBins = 0;\r\n        this.logBins = 0;\r\n        this.maxBinLin = 0;\r\n    }\r\n\r\n    callEventListeners(ev) {\r\n        let args = Array.prototype.slice.call(arguments, 1);\r\n        this.eventListeners[ev].forEach(function(callback) {\r\n            callback.apply(null, args);\r\n        });\r\n    }\r\n\r\n    addEventListener(ev, callback) {\r\n        ev = ev.toLowerCase();\r\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\r\n            this.eventListeners[ev].push(callback);\r\n        } else {\r\n            throw Error(\"Unknown event: \" + ev);\r\n        }\r\n    }\r\n\r\n    removeEventListener(ev, callback) {\r\n        ev = ev.toLowerCase();\r\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\r\n            this.eventListeners[ev] = this.eventListeners[ev].filter(function(a) {\r\n                return (a !== callback);\r\n            });\r\n        } else {\r\n            throw Error(\"Unknown event: \" + ev);\r\n        }\r\n    }\r\n\r\n    init() {\r\n        if(!this.initPromise) {\r\n            this.initPromise = new Promise((resolve, reject) => {\r\n                // Check Web Audio API Support\r\n                try {\r\n                    // More info at http://caniuse.com/#feat=audio-api\r\n                    window.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n                    // These don't always exist\r\n                    AudioContext.prototype.suspend = AudioContext.prototype.suspend || (() => {return Promise.resolve();});\r\n                    AudioContext.prototype.resume = AudioContext.prototype.resume || (() => {return Promise.resolve();});\r\n\r\n                    this.context = new window.AudioContext();\r\n                    this.gainNode = this.context.createGain();\r\n                    this.gainNode.connect(this.context.destination);\r\n                } catch(e) {\r\n                    reject(Error(\"Web Audio API not supported in this browser.\"));\r\n                    return;\r\n                }\r\n                resolve();\r\n            }).then(() => {\r\n                // check for .ogg support - if not, we'll have to load the ogg decoder\r\n                return new Promise((resolve, reject) => {\r\n                    this.context.decodeAudioData(miniOgg, success => {\r\n                            this.oggSupport = true;\r\n                            resolve();\r\n                        }, error => {\r\n                            this.oggSupport = false;\r\n                            resolve();\r\n                    });\r\n                });\r\n            }).then(() => {\r\n                return new Promise((resolve, reject) => {\r\n                    // See if our audio decoder is working\r\n                    let audioWorker;\r\n                    try {\r\n                        audioWorker = this.createWorker();\r\n                    } catch(e) {\r\n                        console.log(e);\r\n                        reject(Error(\"Audio Worker cannot be started - correct path set in defaults?\"));\r\n                        return;\r\n                    }\r\n                    let pingListener = event => {\r\n                        audioWorker.terminate();\r\n                        resolve();\r\n                    };\r\n                    audioWorker.addEventListener('message', pingListener, false);\r\n                    audioWorker.addEventListener('error', () => {\r\n                        reject(Error(\"Audio Worker cannot be started - correct path set in defaults?\"));\r\n                    }, false);\r\n                    audioWorker.postMessage({ping:true, ogg:this.oggSupport});\r\n                });\r\n            }).then(() => {\r\n                this.locked = this.context.state != \"running\";\r\n            });\r\n        }\r\n        return this.initPromise;\r\n    }\r\n\r\n    unlock() {\r\n        if(this.lockedPromise) {\r\n            return this.lockedPromise;\r\n        }\r\n        this.lockedPromise = new Promise((resolve, reject) => {\r\n            // iOS and other some mobile browsers - unlock the context as\r\n            // it starts in a suspended state\r\n            let unlocker = () => {\r\n                // create empty buffer\r\n                let buffer = this.context.createBuffer(1, 1, 22050);\r\n                let source =  this.context.createBufferSource();\r\n                source.buffer = buffer;\r\n\r\n                // connect to output (your speakers)\r\n                source.connect( this.context.destination);\r\n\r\n                // play the file\r\n                source.start(0);\r\n\r\n                window.removeEventListener('touchend', unlocker);\r\n                window.removeEventListener('click', unlocker);\r\n                this.core.clearMessage();\r\n                resolve();\r\n            };\r\n            window.addEventListener('touchend', unlocker, false);\r\n            window.addEventListener('click', unlocker, false);\r\n        });\r\n        return this.lockedPromise;\r\n    }\r\n\r\n    playSong(song, playBuild, forcePlay) {\r\n        let p = Promise.resolve();\r\n        // Editor forces play on audio updates\r\n        if(this.song == song && !forcePlay) {\r\n            return p;\r\n        }\r\n        this.stop();\r\n        this.song = song;\r\n        if(!song || (!song.sound)) { // null song\r\n            return p;\r\n        }\r\n\r\n        // if there's a fadeout happening from AutoSong, kill it\r\n        this.gainNode.gain.cancelScheduledValues(0);\r\n        // Reset original volume\r\n        this.setVolume(this.lastVol);\r\n        if(this.mute) {\r\n            this.setMute(true);\r\n        }\r\n\r\n        p = p.then(() => {\r\n            return this.loadSong(song);\r\n        }).then(buffers => {\r\n            // To prevent race condition if you press \"next\" twice fast\r\n            if(song != this.song) {\r\n                return Promise.reject(\"Song changed between load and play - this message can be ignored\");\r\n            }\r\n\r\n            this.buildup = buffers.buildup;\r\n            this.buildLength = this.buildup ? this.buildup.duration : 0;\r\n            this.loop = buffers.loop;\r\n            this.loopLength = this.loop.duration;\r\n\r\n            // This fixes sync issues on Firefox and slow machines.\r\n            return this.context.suspend();\r\n        }).then(() => {\r\n            if(playBuild) {\r\n                this.seek(-this.buildLength, true);\r\n            } else {\r\n                this.seek(0, true);\r\n            }\r\n\r\n            return this.context.resume();\r\n        }).then(() => {\r\n            this.playing = true;\r\n        });\r\n        return p;\r\n    }\r\n\r\n    stop(dontDeleteBuffers) {\r\n        if (this.playing) {\r\n            if(this.buildSource) {\r\n                this.buildSource.stop(0);\r\n                this.buildSource.disconnect();\r\n                this.buildSource = null;\r\n                if(!dontDeleteBuffers)\r\n                    this.buildup = null;\r\n            }\r\n            // arg required for mobile webkit\r\n            this.loopSource.stop(0);\r\n             // TODO needed?\r\n            this.loopSource.disconnect();\r\n            this.loopSource = null;\r\n            if(!dontDeleteBuffers)\r\n                this.loop = null;\r\n            this.vReady = false;\r\n            this.playing = false;\r\n            this.startTime = 0;\r\n        }\r\n    }\r\n\r\n    setRate(rate) {\r\n        // Double speed is more than enough. Famous last words?\r\n        rate = Math.max(Math.min(rate, 2), 0.25);\r\n\r\n        let time = this.clampedTime;\r\n        this.playbackRate = rate;\r\n        this.seek(time);\r\n    }\r\n\r\n    seek(time, noPlayingUpdate) {\r\n        if(!this.song) {\r\n            return;\r\n        }\r\n\r\n        this.callEventListeners(\"seek\");\r\n\r\n        //console.log(\"Seeking to \" + time);\r\n        // Clamp the blighter\r\n        time = Math.min(Math.max(time, -this.buildLength), this.loopLength);\r\n\r\n        this.stop(true);\r\n\r\n        if(!this.loop) {\r\n            return;\r\n        }\r\n\r\n        this.loopSource = this.context.createBufferSource();\r\n        this.loopSource.buffer = this.loop;\r\n        this.loopSource.playbackRate.value = this.playbackRate;\r\n        this.loopSource.loop = true;\r\n        this.loopSource.loopStart = 0;\r\n        this.loopSource.loopEnd = this.loopLength;\r\n        this.loopSource.connect(this.gainNode);\r\n\r\n        if(time < 0 && this.buildup) {\r\n            this.buildSource = this.context.createBufferSource();\r\n            this.buildSource.buffer = this.buildup;\r\n            this.buildSource.playbackRate.value = this.playbackRate;\r\n            this.buildSource.connect(this.gainNode);\r\n            this.buildSource.start(0, this.buildLength + time);\r\n            this.loopSource.start(this.context.currentTime - (time / this.playbackRate));\r\n        } else {\r\n            this.loopSource.start(0, time);\r\n        }\r\n\r\n        this.startTime = this.context.currentTime - (time / this.playbackRate);\r\n        if(!noPlayingUpdate) {\r\n            this.playing = true;\r\n        }\r\n        this.initVisualiser();\r\n        this.core.recalcBeatIndex();\r\n    }\r\n\r\n    // In seconds, relative to the loop start\r\n    get currentTime() {\r\n        if(!this.playing) {\r\n            return 0;\r\n        }\r\n        return (this.context.currentTime - this.startTime) * this.playbackRate;\r\n    }\r\n\r\n    get clampedTime() {\r\n        let time = this.currentTime;\r\n\r\n        if(time > 0) {\r\n            time %= this.loopLength;\r\n        }\r\n        return time;\r\n    }\r\n\r\n    loadSong(song) {\r\n        if(song._loadPromise) {\r\n            /* Caused when moving back/forwards rapidly.\r\n               The sound is still loading. We reject this promise, and the already\r\n               running decode will finish and resolve instead.\r\n               NOTE: If anything but playSong calls loadSong, this idea is broken. */\r\n            return Promise.reject(\"Song changed between load and play - this message can be ignored\");\r\n        }\r\n\r\n        let buffers = {loop: null, buildup: null};\r\n\r\n        let promises = [this.loadBuffer(song, \"sound\").then(buffer => {\r\n            buffers.loop = buffer;\r\n        })];\r\n        if(song.buildup) {\r\n            promises.push(this.loadBuffer(song, \"buildup\").then(buffer => {\r\n                buffers.buildup = buffer;\r\n            }));\r\n        } else {\r\n            this.buildLength = 0;\r\n        }\r\n        song._loadPromise = Promise.all(promises)\r\n        .then(() => {\r\n            song._loadPromise = null;\r\n            return buffers;\r\n        });\r\n        return song._loadPromise;\r\n    }\r\n\r\n    loadBuffer(song, soundName) {\r\n        let buffer = song[soundName];\r\n\r\n        // Is this an ogg file?\r\n        let view = new Uint8Array(buffer);\r\n        // Signature for ogg file: OggS\r\n        if(this.oggSupport && view[0] == 0x4F && view[1] == 0x67 && view[2] == 0x67 && view[3] == 0x53) {\r\n            // As we don't control decodeAudioData, we cannot do fast transfers and must copy\r\n            let backup = buffer.slice(0);\r\n            return new Promise((resolve, reject) => {\r\n                this.context.decodeAudioData(buffer, result => {\r\n                        resolve(result);\r\n                    }, error => {\r\n                        reject(Error(\"decodeAudioData failed to load track\"));\r\n                });\r\n            }).then(result => {\r\n                // restore copied buffer\r\n                song[soundName] = backup;\r\n                return result;\r\n            });\r\n        } else { // Use our JS decoder\r\n            return new Promise((resolve, reject) => {\r\n                let audioWorker = this.createWorker();\r\n\r\n                audioWorker.addEventListener('error', () => {\r\n                    reject(Error(\"Audio Worker failed to convert track\"));\r\n                }, false);\r\n\r\n                audioWorker.addEventListener('message', e => {\r\n                    let decoded = e.data;\r\n                    audioWorker.terminate();\r\n\r\n                    // restore transferred buffer\r\n                    song[soundName] = decoded.arrayBuffer;\r\n                    if(decoded.error) {\r\n                        reject(new Error(decoded.error));\r\n                        return;\r\n                    }\r\n                    // Convert to real audio buffer\r\n                    let audio = this.audioBufFromRaw(decoded.rawAudio);\r\n                    resolve(audio);\r\n                }, false);\r\n\r\n                // transfer the buffer to save time\r\n                audioWorker.postMessage({buffer: buffer, ogg: this.oggSupport}, [buffer]);\r\n            });\r\n       }\r\n\r\n    }\r\n\r\n    // Converts continuous PCM array to Web Audio API friendly format\r\n    audioBufFromRaw(raw) {\r\n        let buffer = raw.array;\r\n        let channels = raw.channels;\r\n        let samples = buffer.length/channels;\r\n        let audioBuf = this.context.createBuffer(channels, samples, raw.sampleRate);\r\n        for(let i = 0; i < channels; i++) {\r\n            // Offset is in bytes, length is in elements\r\n            let channel = new Float32Array(buffer.buffer , i * samples * 4, samples);\r\n            // Most browsers\r\n            if(typeof audioBuf.copyToChannel === \"function\") {\r\n                audioBuf.copyToChannel(channel, i, 0);\r\n            } else { // Safari, Edge sometimes\r\n                audioBuf.getChannelData(i).set(channel);\r\n            }\r\n        }\r\n        return audioBuf;\r\n    }\r\n\r\n    createWorker() {\r\n        return new Worker(this.core.settings.workersPath + 'audio-worker.js');\r\n    }\r\n\r\n    initVisualiser(bars) {\r\n        // When restarting the visualiser\r\n        if(!bars) {\r\n            bars = this.vTotalBars;\r\n        }\r\n        this.vReady = false;\r\n        this.vTotalBars = bars;\r\n        for(let i = 0; i < this.analysers.length; i++) {\r\n            this.analysers[i].disconnect();\r\n        }\r\n        if(this.splitter) {\r\n            this.splitter.disconnect();\r\n            this.splitter = null;\r\n        }\r\n        this.analysers = [];\r\n        this.analyserArrays = [];\r\n        this.logArrays = [];\r\n        this.binCutoffs = [];\r\n\r\n        this.linBins = 0;\r\n        this.logBins = 0;\r\n        this.maxBinLin = 0;\r\n\r\n        this.attachVisualiser();\r\n    }\r\n\r\n    attachVisualiser() {\r\n        if(!this.playing || this.vReady) {\r\n            return;\r\n        }\r\n\r\n        // Get our info from the loop\r\n        let channels = this.loopSource.channelCount;\r\n        // In case channel counts change, this is changed each time\r\n        this.splitter = this.context.createChannelSplitter(channels);\r\n        // Connect to the gainNode so we get buildup stuff too\r\n        this.loopSource.connect(this.splitter);\r\n        if(this.buildSource) {\r\n            this.buildSource.connect(this.splitter);\r\n        }\r\n        // Split display up into each channel\r\n        this.vBars = Math.floor(this.vTotalBars/channels);\r\n\r\n        for(let i = 0; i < channels; i++) {\r\n            let analyser = this.context.createAnalyser();\r\n            // big fft buffers are new-ish\r\n            try {\r\n                analyser.fftSize = 8192;\r\n            } catch(err) {\r\n                analyser.fftSize = 2048;\r\n            }\r\n            // Chosen because they look nice, no maths behind it\r\n            analyser.smoothingTimeConstant = 0.6;\r\n            analyser.minDecibels = -70;\r\n            analyser.maxDecibels = -25;\r\n            this.analyserArrays.push(new Uint8Array(analyser.frequencyBinCount));\r\n            analyser.getByteTimeDomainData(this.analyserArrays[i]);\r\n            this.splitter.connect(analyser, i);\r\n            this.analysers.push(analyser);\r\n            this.logArrays.push(new Uint8Array(this.vBars));\r\n        }\r\n        let binCount = this.analysers[0].frequencyBinCount;\r\n        let binWidth = this.loopSource.buffer.sampleRate / binCount;\r\n        // first 2kHz are linear\r\n        this.maxBinLin = Math.floor(2000/binWidth);\r\n        // Don't stretch the first 2kHz, it looks awful\r\n        this.linBins = Math.min(this.maxBinLin, Math.floor(this.vBars/2));\r\n        // Only go up to 22KHz\r\n        let maxBinLog = Math.floor(22000/binWidth);\r\n        let logBins = this.vBars - this.linBins;\r\n\r\n        let logLow = Math.log2(2000);\r\n        let logDiff = Math.log2(22000) - logLow;\r\n        for(let i = 0; i < logBins; i++) {\r\n            let cutoff = i * (logDiff/logBins) + logLow;\r\n            let freqCutoff = Math.pow(2, cutoff);\r\n            let binCutoff = Math.floor(freqCutoff / binWidth);\r\n            this.binCutoffs.push(binCutoff);\r\n        }\r\n        this.vReady = true;\r\n    }\r\n\r\n    sumArray(array, low, high) {\r\n        let total = 0;\r\n        for(let i = low; i <= high; i++) {\r\n            total += array[i];\r\n        }\r\n        return total/(high-low+1);\r\n    }\r\n\r\n    getVisualiserData() {\r\n        if(!this.vReady) {\r\n            return null;\r\n        }\r\n        for(let a = 0; a < this.analyserArrays.length; a++) {\r\n            let data = this.analyserArrays[a];\r\n            let result = this.logArrays[a];\r\n            this.analysers[a].getByteFrequencyData(data);\r\n\r\n            for(let i = 0; i < this.linBins; i++) {\r\n                let scaled = Math.round(i * this.maxBinLin / this.linBins);\r\n                result[i] = data[scaled];\r\n            }\r\n            result[this.linBins] = data[this.binCutoffs[0]];\r\n            for(let i = this.linBins+1; i < this.vBars; i++) {\r\n                let cutoff = i - this.linBins;\r\n                result[i] = this.sumArray(data, this.binCutoffs[cutoff-1],\r\n                                                this.binCutoffs[cutoff]);\r\n            }\r\n        }\r\n        return this.logArrays;\r\n    }\r\n\r\n    setMute(mute) {\r\n        if(!this.mute && mute) { // muting\r\n            this.lastVol = this.gainNode.gain.value;\r\n        }\r\n        if(mute) {\r\n            this.gainNode.gain.value = 0;\r\n        } else {\r\n            this.gainNode.gain.value = this.lastVol;\r\n        }\r\n        this.core.userInterface.updateVolume(this.gainNode.gain.value);\r\n        this.mute = mute;\r\n        return mute;\r\n    }\r\n\r\n    toggleMute() {\r\n        return this.setMute(!this.mute);\r\n    }\r\n\r\n    decreaseVolume() {\r\n        this.setMute(false);\r\n        let val = Math.max(this.gainNode.gain.value - 0.1, 0);\r\n        this.setVolume(val);\r\n    }\r\n\r\n    increaseVolume() {\r\n        this.setMute(false);\r\n        let val = Math.min(this.gainNode.gain.value + 0.1, 1);\r\n        this.setVolume(val);\r\n    }\r\n\r\n    setVolume(vol) {\r\n        this.gainNode.gain.value = vol;\r\n        this.lastVol = vol;\r\n        this.core.userInterface.updateVolume(vol);\r\n    }\r\n\r\n    fadeOut(callback) {\r\n        if(!this.mute) {\r\n            // Firefox hackery\r\n            this.gainNode.gain.setValueAtTime(this.lastVol, this.context.currentTime);\r\n            this.gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 2);\r\n        }\r\n        setTimeout(callback, 2000);\r\n    }\r\n}\r\n\r\nlet miniOggRaw =\r\n\"T2dnUwACAAAAAAAAAADFYgAAAAAAAMLKRdwBHgF2b3JiaXMAAAAAAUSsAAAA\" +\r\n\"AAAAgLsAAAAAAAC4AU9nZ1MAAAAAAAAAAAAAxWIAAAEAAACcKCV2Dzv/////\" +\r\n\"////////////MgN2b3JiaXMrAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAx\" +\r\n\"MjAyMDMgKE9tbmlwcmVzZW50KQAAAAABBXZvcmJpcx9CQ1YBAAABABhjVClG\" +\r\n\"mVLSSokZc5QxRplikkqJpYQWQkidcxRTqTnXnGusubUghBAaU1ApBZlSjlJp\" +\r\n\"GWOQKQWZUhBLSSV0EjonnWMQW0nB1phri0G2HIQNmlJMKcSUUopCCBlTjCnF\" +\r\n\"lFJKQgcldA465hxTjkooQbicc6u1lpZji6l0kkrnJGRMQkgphZJKB6VTTkJI\" +\r\n\"NZbWUikdc1JSakHoIIQQQrYghA2C0JBVAAABAMBAEBqyCgBQAAAQiqEYigKE\" +\r\n\"hqwCADIAAASgKI7iKI4jOZJjSRYQGrIKAAACABAAAMBwFEmRFMmxJEvSLEvT\" +\r\n\"RFFVfdU2VVX2dV3XdV3XdSA0ZBUAAAEAQEinmaUaIMIMZBgIDVkFACAAAABG\" +\r\n\"KMIQA0JDVgEAAAEAAGIoOYgmtOZ8c46DZjloKsXmdHAi1eZJbirm5pxzzjkn\" +\r\n\"m3PGOOecc4pyZjFoJrTmnHMSg2YpaCa05pxznsTmQWuqtOacc8Y5p4NxRhjn\" +\r\n\"nHOatOZBajbW5pxzFrSmOWouxeaccyLl5kltLtXmnHPOOeecc84555xzqhen\" +\r\n\"c3BOOOecc6L25lpuQhfnnHM+Gad7c0I455xzzjnnnHPOOeecc4LQkFUAABAA\" +\r\n\"AEEYNoZxpyBIn6OBGEWIacikB92jwyRoDHIKqUejo5FS6iCUVMZJKZ0gNGQV\" +\r\n\"AAAIAAAhhBRSSCGFFFJIIYUUUoghhhhiyCmnnIIKKqmkoooyyiyzzDLLLLPM\" +\r\n\"Muuws8467DDEEEMMrbQSS0211VhjrbnnnGsO0lpprbXWSimllFJKKQgNWQUA\" +\r\n\"gAAAEAgZZJBBRiGFFFKIIaaccsopqKACQkNWAQCAAAACAAAAPMlzREd0REd0\" +\r\n\"REd0REd0RMdzPEeUREmUREm0TMvUTE8VVdWVXVvWZd32bWEXdt33dd/3dePX\" +\r\n\"hWFZlmVZlmVZlmVZlmVZlmVZgtCQVQAACAAAgBBCCCGFFFJIIaUYY8wx56CT\" +\r\n\"UEIgNGQVAAAIACAAAADAURzFcSRHciTJkixJkzRLszzN0zxN9ERRFE3TVEVX\" +\r\n\"dEXdtEXZlE3XdE3ZdFVZtV1Ztm3Z1m1flm3f933f933f933f933f93UdCA1Z\" +\r\n\"BQBIAADoSI6kSIqkSI7jOJIkAaEhqwAAGQAAAQAoiqM4juNIkiRJlqRJnuVZ\" +\r\n\"omZqpmd6qqgCoSGrAABAAAABAAAAAAAomuIppuIpouI5oiNKomVaoqZqriib\" +\r\n\"suu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6LhAasgoAkAAA\" +\r\n\"0JEcyZEcSZEUSZEcyQFCQ1YBADIAAAIAcAzHkBTJsSxL0zzN0zxN9ERP9ExP\" +\r\n\"FV3RBUJDVgEAgAAAAgAAAAAAMCTDUixHczRJlFRLtVRNtVRLFVVPVVVVVVVV\" +\r\n\"VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVNU3TNE0gNGQlAAAEAMBijcHl\" +\r\n\"ICElJeXeEMIQk54xJiG1XiEEkZLeMQYVg54yogxy3kLjEIMeCA1ZEQBEAQAA\" +\r\n\"xiDHEHPIOUepkxI556h0lBrnHKWOUmcpxZhizSiV2FKsjXOOUketo5RiLC12\" +\r\n\"lFKNqcYCAAACHAAAAiyEQkNWBABRAACEMUgppBRijDmnnEOMKeeYc4Yx5hxz\" +\r\n\"jjnnoHRSKuecdE5KxBhzjjmnnHNSOieVc05KJ6EAAIAABwCAAAuh0JAVAUCc\" +\r\n\"AIBBkjxP8jRRlDRPFEVTdF1RNF3X8jzV9ExTVT3RVFVTVW3ZVFVZljzPND3T\" +\r\n\"VFXPNFXVVFVZNlVVlkVV1W3TdXXbdFXdlm3b911bFnZRVW3dVF3bN1XX9l3Z\" +\r\n\"9n1Z1nVj8jxV9UzTdT3TdGXVdW1bdV1d90xTlk3XlWXTdW3blWVdd2XZ9zXT\" +\r\n\"dF3TVWXZdF3ZdmVXt11Z9n3TdYXflWVfV2VZGHZd94Vb15XldF3dV2VXN1ZZ\" +\r\n\"9n1b14Xh1nVhmTxPVT3TdF3PNF1XdV1fV13X1jXTlGXTdW3ZVF1ZdmXZ911X\" +\r\n\"1nXPNGXZdF3bNl1Xll1Z9n1XlnXddF1fV2VZ+FVX9nVZ15Xh1m3hN13X91VZ\" +\r\n\"9oVXlnXh1nVhuXVdGD5V9X1TdoXhdGXf14XfWW5dOJbRdX1hlW3hWGVZOX7h\" +\r\n\"WJbd95VldF1fWG3ZGFZZFoZf+J3l9n3jeHVdGW7d58y67wzH76T7ytPVbWOZ\" +\r\n\"fd1ZZl93juEYOr/w46mqr5uuKwynLAu/7evGs/u+soyu6/uqLAu/KtvCseu+\" +\r\n\"8/y+sCyj7PrCasvCsNq2Mdy+biy/cBzLa+vKMeu+UbZ1fF94CsPzdHVdeWZd\" +\r\n\"x/Z1dONHOH7KAACAAQcAgAATykChISsCgDgBAI8kiaJkWaIoWZYoiqbouqJo\" +\r\n\"uq6kaaapaZ5pWppnmqZpqrIpmq4saZppWp5mmpqnmaZomq5rmqasiqYpy6Zq\" +\r\n\"yrJpmrLsurJtu65s26JpyrJpmrJsmqYsu7Kr267s6rqkWaapeZ5pap5nmqZq\" +\r\n\"yrJpmq6reZ5qep5oqp4oqqpqqqqtqqosW55nmproqaYniqpqqqatmqoqy6aq\" +\r\n\"2rJpqrZsqqptu6rs+rJt67ppqrJtqqYtm6pq267s6rIs27ovaZppap5nmprn\" +\r\n\"maZpmrJsmqorW56nmp4oqqrmiaZqqqosm6aqypbnmaoniqrqiZ5rmqoqy6Zq\" +\r\n\"2qppmrZsqqotm6Yqy65t+77ryrJuqqpsm6pq66ZqyrJsy77vyqruiqYpy6aq\" +\r\n\"2rJpqrIt27Lvy7Ks+6JpyrJpqrJtqqouy7JtG7Ns+7pomrJtqqYtm6oq27It\" +\r\n\"+7os27rvyq5vq6qs67It+7ru+q5w67owvLJs+6qs+ror27pv6zLb9n1E05Rl\" +\r\n\"UzVt21RVWXZl2fZl2/Z90TRtW1VVWzZN1bZlWfZ9WbZtYTRN2TZVVdZN1bRt\" +\r\n\"WZZtYbZl4XZl2bdlW/Z115V1X9d949dl3ea6su3Lsq37qqv6tu77wnDrrvAK\" +\r\n\"AAAYcAAACDChDBQashIAiAIAAIxhjDEIjVLOOQehUco55yBkzkEIIZXMOQgh\" +\r\n\"lJI5B6GUlDLnIJSSUgihlJRaCyGUlFJrBQAAFDgAAATYoCmxOEChISsBgFQA\" +\r\n\"AIPjWJbnmaJq2rJjSZ4niqqpqrbtSJbniaJpqqptW54niqapqq7r65rniaJp\" +\r\n\"qqrr6rpomqapqq7ruroumqKpqqrrurKum6aqqq4ru7Ls66aqqqrryq4s+8Kq\" +\r\n\"uq4ry7Jt68Kwqq7ryrJs27Zv3Lqu677v+8KRreu6LvzCMQxHAQDgCQ4AQAU2\" +\r\n\"rI5wUjQWWGjISgAgAwCAMAYhgxBCBiGEkFJKIaWUEgAAMOAAABBgQhkoNGRF\" +\r\n\"ABAnAAAYQymklFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSCmllFJKKaWU\" +\r\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSqmklFJKKaWU\" +\r\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWU\" +\r\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWU\" +\r\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWU\" +\r\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWU\" +\r\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimVUkoppZRS\" +\r\n\"SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRS\" +\r\n\"SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFIKAJCKcACQejCh\" +\r\n\"DBQashIASAUAAIxRSinGnIMQMeYYY9BJKClizDnGHJSSUuUchBBSaS23yjkI\" +\r\n\"IaTUUm2Zc1JaizHmGDPnpKQUW805h1JSi7HmmmvupLRWa64151paqzXXnHPN\" +\r\n\"ubQWa64515xzyzHXnHPOOecYc84555xzzgUA4DQ4AIAe2LA6wknRWGChISsB\" +\r\n\"gFQAAAIZpRhzzjnoEFKMOecchBAihRhzzjkIIVSMOeccdBBCqBhzzDkIIYSQ\" +\r\n\"OecchBBCCCFzDjroIIQQQgcdhBBCCKGUzkEIIYQQSighhBBCCCGEEDoIIYQQ\" +\r\n\"QgghhBBCCCGEUkoIIYQQQgmhlFAAAGCBAwBAgA2rI5wUjQUWGrISAAACAIAc\" +\r\n\"lqBSzoRBjkGPDUHKUTMNQkw50ZliTmozFVOQORCddBIZakHZXjILAACAIAAg\" +\r\n\"wAQQGCAo+EIIiDEAAEGIzBAJhVWwwKAMGhzmAcADRIREAJCYoEi7uIAuA1zQ\" +\r\n\"xV0HQghCEIJYHEABCTg44YYn3vCEG5ygU1TqIAAAAAAADADgAQDgoAAiIpqr\" +\r\n\"sLjAyNDY4OjwCAAAAAAAFgD4AAA4PoCIiOYqLC4wMjQ2ODo8AgAAAAAAAAAA\" +\r\n\"gICAAAAAAABAAAAAgIBPZ2dTAAQBAAAAAAAAAMViAAACAAAA22A/JwIBAQAK\";\r\n\r\n// write the bytes of the string to an ArrayBuffer\r\nlet miniOggBin = atob(miniOggRaw);\r\nlet miniOgg = new ArrayBuffer(miniOggBin.length);\r\nlet view = new Uint8Array(miniOgg);\r\nfor (var i = 0; i < miniOggBin.length; i++) {\r\n    view[i] = miniOggBin.charCodeAt(i);\r\n}\r\n\r\nwindow.SoundManager = SoundManager;\r\n\r\n})(window, document);","// String Scoring Algorithm 0.1.22 | (c) 2009-2015 Joshaven Potter <yourtech@gmail.com>\n// MIT License: http://opensource.org/licenses/MIT | https://github.com/joshaven/string_score\nString.prototype.score=function(e,f){if(this===e)return 1;if(\"\"===e)return 0;var d=0,a,g=this.toLowerCase(),n=this.length,h=e.toLowerCase(),k=e.length,b;a=0;var l=1,m,c;f&&(m=1-f);if(f)for(c=0;c<k;c+=1)b=g.indexOf(h[c],a),-1===b?l+=m:(a===b?a=.7:(a=.1,\" \"===this[b-1]&&(a+=.8)),this[b]===e[c]&&(a+=.1),d+=a,a=b+1);else for(c=0;c<k;c+=1){b=g.indexOf(h[c],a);if(-1===b)return 0;a===b?a=.7:(a=.1,\" \"===this[b-1]&&(a+=.8));this[b]===e[c]&&(a+=.1);d+=a;a=b+1}d=.5*(d/n+d/k)/l;h[0]===g[0]&&.85>d&&(d+=.15);return d};\n"]}